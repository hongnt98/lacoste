/* Discount Ninja v2 */
var discountNinja;if(window.location.search.indexOf("frame_token")>-1&&window!==window.top)throw new Error("Limoni Apps DiscountNinja V2 has detected it is running in the Shopify Admin theme editor. Aborting script.");if(typeof discountNinja!="undefined"||typeof discountNinja_Script_Loading!="undefined")discountNinja.Logging.LogVerbose("Aborting load of script because it is already loaded");else{var discountNinja_Script_Loading=!0,discountNinja_Script_Core={Shop:"",Version:"5.1.16",TriggerPromotion:function(n){try{var t=jQuery(n).attr("data-limoniapps-discountninja-token");t!==null&&t!==undefined&&t!==""&&(discountNinja.Logging.LogVerbose("Triggering promotion with token "+t),discountNinja.Token.SetTokenInLocalStorage(t),discountNinja.Token.SetCartTokenInLocalStorage(t),discountNinja.Token.SetNonAutomaticTokenInSession(t),discountNinja_Script_Core.Start())}catch(i){discountNinja.Logging.LogError("Core.Exception in TriggerPromotion",i,!0)}},Start:function(n){function t(){try{discountNinja.TestMode.HandleQueryParameter();discountNinja.Logging.HandleQueryParameter()}catch(n){discountNinja.Logging.LogError("Core.HandleDiscountNinjaQueryParameters",n,!0)}}function i(n){try{var t=0,i=null,r=function(){t++;typeof jQuery!="undefined"&&typeof jQuery.isReady=="boolean"&&(discountNinja_Script_Core.DOMHasLoaded=discountNinja_Script_Core.DOMHasLoaded||jQuery.isReady);discountNinja_Script_Core.DOMHasLoaded||t===50?(i!==null&&clearTimeout(i),t===50&&discountNinja.Logging.LogError("Core.Waiting for DOM to load - Timed out",!0),discountNinja.Logging.LogVerbose("Waiting for DOM to load - DONE"),typeof n=="function"&&n!==null&&n()):i=setTimeout(function(){r()},100)};r()}catch(u){discountNinja.Logging.LogError("Core.WaitForDom",u,!0)}}function r(){try{discountNinja.Logging.StartTimer();discountNinja.Trigger.IntializeTimeOnPageCounter();discountNinja.Trigger.TrackScrollPercentage();discountNinja.Promotion.PrimaryPromotion=null;discountNinja.Settings.Settings=null;discountNinja.Logging.LogVerbose("Request updated cart");discountNinja.Cart.Shopify.UpdateCart();discountNinja_Script_Core.RegisterDiscountButtonClickEvents();discountNinja.ProductData.Save();discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout();discountNinja.Logging.LogVerbose("Getting promotion info");discountNinja.Logging.ShowTimeElapsed("Loading promotion info");discountNinja.Promotion.LoadApplicablePromotions(function(){i(function(){discountNinja.Cart.Shopify.UpdateCart(discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Checkout.Shopify.InjectLoadingCheckoutPopUp();discountNinja.PromotionFlow.StartFlow()}))})},discountNinja.PromotionFlow.StopFlow)}catch(n){discountNinja.Logging.LogError("Core.StartInternal",n,!0)}}try{if(discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(),t(),discountNinja.TestMode.TestModeOutputIssue=!1,n&&discountNinja.Logging.LogToConsole("information","\n\n"+discountNinja.Utilities.GetEmoji(128640)+" This forward-thinking shop uses Discount Ninja (an app by Limoni Apps) to drive more sales by showing discounted prices on the product page, the collection page and the cart page.\nScript version: v"+discountNinja_Script_Core.Version+"\nLearn more at https://apps.shopify.com/discount-url?ref="+discountNinja_Script_Core.Shop+"\n\n\n","green",!0),discountNinja.Logging.LogVerbose("Loaded at '"+Date.now().toString()+"' - Version: "+discountNinja_Script_Core.Version),!discountNinja.Environment.Shopify.IsCartPage()&&!discountNinja.Environment.Shopify.IsProductPage()&&!discountNinja.Environment.Shopify.IsCollectionPage()&&!discountNinja.Environment.Shopify.IsHomePage()&&!discountNinja.Environment.Shopify.IsBlogPost()&&!discountNinja.Environment.Shopify.IsCustomPage()){discountNinja.Logging.LogVerbose("Not on home, product, collection or cart page. Aborting script.");return}XMLHttpRequest.prototype.send=discountNinja.XmlHttpRequest.CreateSendInterceptor("readystatechange",discountNinja.XmlHttpRequest.HandleSend,XMLHttpRequest.prototype.send);window.fetch=discountNinja.XmlHttpRequest.CreateFetchInterceptor(discountNinja.XmlHttpRequest.HandleFetch,window.fetch);LimoniAppsLoadJQuery(LimoniAppsLoadJQueryNotify(LimoniAppsLoadOuiBounce(LimoniAppsLoadFontAwesome(LimoniAppsLoadMoment(LimoniAppsLoadMomentFormat(LimoniAppsLoadMomentTimezone(discountNinja.LiquidData.WaitForLiquidAsset(r))))))))}catch(u){discountNinja.Logging.LogError("Core.Start",u,!0)}},RegisterDiscountButtonClickEvents:function(){function n(){try{jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).off("click")})}catch(n){discountNinja.Logging.LogError("Core.UnRegisterDiscountButtonClickEvents",n,!0)}}try{discountNinja.Logging.LogVerbose("Registering event handler for discount buttons");n();jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).on("click",function(n){discountNinja.Logging.LogVerbose("Promotion triggered via discount button");discountNinja_Script_Core.TriggerPromotion(n.currentTarget)})})}catch(t){discountNinja.Logging.LogError("Core.RegisterDiscountButtonClickEvents",t,!0)}},CheckoutCurrentVariant:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){var f=discountNinja.Environment.Shopify.VariantId(),t=discountNinja.DiscountCode.GetDiscountCode(),i=jQuery('form input[name="quantity"]'),n=1;i!==null&&i.length===1&&(n=i.val());(n===undefined||n==="undefined"||n===null||isNaN(n))&&(n=1);var u=t===undefined||t===null||t===""?"":"?discount="+t,r=discountNinja.QueryParameter.Get("locale"),e=r===undefined?"":u===""?"?locale="+r:"&locale="+r;window.location.assign("/cart/"+f+":"+n+u+e)}}catch(o){discountNinja.Logging.LogError("Core.CheckoutCurrentVariant",o,!0)}}},discountNinja_Script_Notification={AnimateOnReminderIntervalHandle:-1,DelayIntervalHandle:-1,GetClass:function(){return"limoniapps-notify-default"},GetStyle:function(n){try{return n?n.NotificationSettings.Style:""}catch(t){return discountNinja.Logging.LogError("Notification.GetStyle",t,!0),""}},GetText:function(n,t,i){try{return discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(n,t),i)}catch(r){return discountNinja.Logging.LogError("Notification.GetHeader",r,!0),""}},GetHtml:function(n,t){try{if(!t)return"";var r=discountNinja.Settings.Settings.NotificationSettings,u=discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(r.TimerFooter,null,null):"",i=r.Html;return i=i.replace("{{HEADER}}",discountNinja_Script_Notification.GetText(r.Header,null,null)),i=i.replace("{{BODY}}",n),i=i.replace("{{FOOTER}}",discountNinja_Script_Notification.GetText(r.Footer,null,null)),i=i.replace("{{TIMER_FOOTER}}",u),i.replace("{{TOKEN}}",t.Token)}catch(f){return discountNinja.Logging.LogError("Notification.GetHtml",f,!0),""}},Hide:function(n){try{discountNinja.Logging.LogVerbose("Hiding notification");var t=jQuery("."+discountNinja_Script_Notification.GetClass());t&&(discountNinja_Script_Notification.ApplyAnimation(t,discountNinja.Settings.Settings.NotificationSettings.AnimationExit),setTimeout(function(){t.hide()},800));n&&discountNinja_Script_Notification.SetHiddenInSession(!0);discountNinja.Logging.LogVerbose("Notification hidden")}catch(i){discountNinja.Logging.LogError("Notification.Hide",i,!0)}},ToggleMinMaximize:function(){try{var n=discountNinja_Script_Notification.GetMinMaximizeStatus(),t=n==="minimized";t?discountNinja_Script_Notification.Maximize():discountNinja_Script_Notification.Minimize()}catch(i){discountNinja.Logging.LogError("Notification.ToggleMinMaximize",i,!0)}},Minimize:function(){var t,n,i,r,u;try{if(discountNinja_Script_Notification.GetMinMaximizeStatus()==="minimized")return;discountNinja.Logging.LogVerbose("Minimize notification");discountNinja_Script_Notification.SetMinMaximizeStatus("minimized");t=discountNinja.Utilities.IsMobilePhone();n=jQuery("."+discountNinja_Script_Notification.GetClass());n&&(jQuery(n).attr("data-original-width",jQuery(n).css("width")),jQuery(n).attr("data-original-bottom",jQuery(n).css("bottom")),jQuery(n).attr("data-original-top",jQuery(n).css("top")),jQuery(n).attr("data-original-left",jQuery(n).css("left")),jQuery(n).attr("data-original-right",jQuery(n).css("right")),jQuery(n).css("white-space","nowrap"),t?jQuery(n).css("width","0px"):jQuery(n).css("width","200px"),i=jQuery(n).outerHeight(),r=t?(i-20)*-1+"px":(i-40)*-1+"px",discountNinja.Settings.Settings.NotificationSettings.PlacementVertical==="top"?jQuery(n).css("top",r.toString()):jQuery(n).css("bottom",r.toString()),u="20px",discountNinja.Settings.Settings.NotificationSettings.PlacementHorizontal==="left"?jQuery(n).css("left",u.toString()):jQuery(n).css("right",u.toString()),jQuery(n).find(".limoniapps-minimize-min").hide(),jQuery(n).find(".limoniapps-minimize-max").show())}catch(f){discountNinja.Logging.LogError("Notification.Minimize",f,!0)}},Maximize:function(){try{if(discountNinja_Script_Notification.GetMinMaximizeStatus()==="maximized")return;discountNinja.Logging.LogVerbose("Maximize notification");discountNinja_Script_Notification.SetMinMaximizeStatus("maximized");var n=jQuery("."+discountNinja_Script_Notification.GetClass());n&&(jQuery(n).css("width",jQuery(n).attr("data-original-width")),discountNinja.Settings.Settings.NotificationSettings.PlacementVertical==="top"?jQuery(n).css("top",jQuery(n).attr("data-original-top")):jQuery(n).css("bottom",jQuery(n).attr("data-original-bottom")),discountNinja.Settings.Settings.NotificationSettings.PlacementHorizontal==="left"?jQuery(n).css("left",jQuery(n).attr("data-original-left")):jQuery(n).css("right",jQuery(n).attr("data-original-right")),jQuery(n).find(".limoniapps-minimize-max").hide(),jQuery(n).find(".limoniapps-minimize-min").show(),discountNinja_Script_Notification.ActAfterDelay(),setTimeout(function(){jQuery(n).css("white-space","unset")},200))}catch(t){discountNinja.Logging.LogError("Notification.Maximize",t,!0)}},Clear:function(){discountNinja.Cache.SessionRemove("notificationinfo-data")},Remove:function(n){var i,r,t;try{for(i=discountNinja_Script_Notification.GetFromCache(),r=[],t=0;t<i.length;t++)i[t].Token!==n&&r.push(i[t]);r.length===0&&discountNinja_Script_Notification.Hide();discountNinja_Script_Notification.SaveToCache(r)}catch(u){discountNinja.Logging.LogError("Notification.Remove",u,!0)}},GetFromCache:function(){try{var n=discountNinja.Cache.SessionGet("notificationinfo-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountNinja.Logging.LogError("Notification.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountNinja.Cache.SessionSet("notificationinfo-data",JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("Notification.SaveToCache",t,!0)}},Add:function(n,t){var i,r;try{for(n||discountNinja.Logging.LogError("Notification.Add","Expected token",!1),i=discountNinja_Script_Notification.GetFromCache(),r=0;r<i.length;r++)if(i[r]&&i[r].Token===n)return;i.push({Token:n,ProductInfo:t,Animated:!1});discountNinja_Script_Notification.SaveToCache(i)}catch(u){discountNinja.Logging.LogError("Notification.Add",u,!0)}},ClearAnimation:function(n){try{var t=discountNinja.Settings.Settings.NotificationSettings;n.removeClass(t.AnimationEnter);n.removeClass(t.AnimationOnReminder);n.removeClass(t.AnimationExit);n.removeClass("animated shake flash bounce rotateIn")}catch(i){discountNinja.Logging.LogError("Notification.ClearAnimation",i,!0)}},ApplyAnimation:function(n,t,i){try{discountNinja_Script_Notification.ClearAnimation(n);n.addClass(t);i&&n.css("animation-iteration-count",i)}catch(r){discountNinja.Logging.LogError("Notification.ApplyAnimation",r,!0)}},ActAfterDelay:function(){try{var n=discountNinja.Settings.Settings.NotificationSettings;n.MinimizeButton&&n.Delay&&n.Delay>0&&(clearInterval(discountNinja_Script_Notification.DelayIntervalHandle),discountNinja_Script_Notification.DelayIntervalHandle=setTimeout(function(){var t=discountNinja_Script_Notification.GetUserToggledMinMaximize()==="true";t?discountNinja.Logging.LogVerbose("Not hiding/minimizing notification because it was toggled by the user"):n.HideMode==="hide"?discountNinja_Script_Notification.Hide(!0):n.HideMode==="minimize"&&discountNinja_Script_Notification.Minimize()},n.Delay))}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t,!0)}},HighlightNewPromotions:function(n){function t(n){try{setTimeout(function(){for(var i,t=0;t<n.length;t++)i=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-promotion-token="'+n[t]+'"]'),discountNinja_Script_Notification.ApplyAnimation(i,"animated shake",1)},500);setTimeout(function(){for(var i,t=0;t<n.length;t++)i=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-promotion-token="'+n[t]+'"]'),discountNinja_Script_Notification.ApplyAnimation(i,"animated flash",3)},1500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewPromotions.HighlightNewPromotions",t,!0)}}function i(){try{var t=discountNinja.Settings.Settings.NotificationSettings;t.OfferCounterAnimate&&n.length>0&&(discountNinja_Script_Notification.Maximize(),setTimeout(function(){discountNinja_Script_Notification.ApplyAnimation(jQuery("."+discountNinja_Script_Notification.GetClass()+" .limoniapps-offercount"),"animated bounce",2)},500))}catch(i){discountNinja.Logging.LogError("Notification.HighlightNewPromotions.AnimateCounter",i,!0)}}try{setTimeout(function(){t(n);i(n)},1500)}catch(r){discountNinja.Logging.LogError("Notification.HighlightNewPromotions",r,!0)}},Show:function(){function e(n,t){function i(){var t=jQuery("."+discountNinja_Script_Notification.GetClass());discountNinja_Script_Notification.ApplyAnimation(t,n)}discountNinja_Script_Notification.AnimateOnReminderIntervalHandle=setTimeout(function(){i();e(n,t)},t)}function l(n,t){try{return t.NotificationSettings.BackgroundColor&&(n=n.replace(/(background-color:)([^;])*(;)/,"background-color:"+t.NotificationSettings.BackgroundColor+";")),n}catch(i){return discountNinja.Logging.LogError("Notification.ApplyPromotionSettings",i,!0),n}}function a(n,t,i,r){var u,f,o,s;try{u=discountNinja.Settings.Settings.NotificationSettings;f=discountNinja_Script_Notification.GetShownInSession();n=l(n,t);u.HorizontalOffset||u.VerticalOffset?jQuery.notify({icon:"",title:"",message:""},{allow_dismiss:u.CloseButton,type:"limoniapps-discountninja",placement:{from:u.PlacementVertical||"bottom",align:u.PlacementHorizontal||"top"},offset:{x:u.HorizontalOffset||0,y:u.VerticalOffset||0},delay:0,template:n,animate:{enter:f?"":u.AnimationEnter,exit:""},onClose:function(){discountNinja_Script_Notification.Hide(!0)},onClosed:function(){discountNinja_Script_Notification.SetDismissedInSession(!0)}}):jQuery.notify({icon:"",title:"",message:""},{allow_dismiss:u.CloseButton,type:"limoniapps-discountninja",placement:{from:u.PlacementVertical||"bottom",align:u.PlacementHorizontal||"top"},delay:0,template:n,animate:{enter:f?"":u.AnimationEnter,exit:""},onClose:function(){discountNinja_Script_Notification.Hide(!0)},onClosed:function(){discountNinja_Script_Notification.SetDismissedInSession(!0)}});u.MinimizeButton&&(o=jQuery("."+discountNinja_Script_Notification.GetClass()),jQuery(o).click(function(){discountNinja_Script_Notification.SetUserToggledMinMaximize(!0);discountNinja_Script_Notification.ToggleMinMaximize()}));f&&(s=discountNinja_Script_Notification.GetMinMaximizeStatus(),s==="minimized"&&discountNinja_Script_Notification.Minimize());discountNinja_Script_Notification.ActAfterDelay();discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden");discountNinja_Script_Notification.HighlightNewPromotions(r);discountNinja_Script_Notification.SetShownInSession(!0);discountNinja_Script_Notification.SetShownOnDevice(!0);u.AnimationOnReminder&&(clearInterval(discountNinja_Script_Notification.AnimateOnReminderIntervalHandle),e(u.AnimationOnReminder,u.ReminderDuration))}catch(h){return discountNinja.Logging.LogError("Notification.ShowInternalAfterEnsuringDependencies",h,!0),!1}}function v(){var n,t;try{for(n=discountNinja_Script_Notification.GetFromCache(),t=0;t<n.length;t++)n[t].Animated=!0;discountNinja_Script_Notification.SaveToCache(n)}catch(i){discountNinja.Logging.LogError("Notification.MarkNotificationsAsAnimated",i,!0)}}function y(n,t,i,r,u){var h,f,s,e,o;try{if(n===null||n==="<ul><\/ul>")return;if(discountNinja.Logging.LogVerbose("Showing notification"),discountNinja_Script_Notification.GetDismissedInSession()){discountNinja.Logging.LogVerbose("Notification was dismissed during the session, canceling show");return}if(h=jQuery("."+discountNinja_Script_Notification.GetClass()).length>0,h){if(jQuery(".limoniapps-notify-default .limoniapps-message-body").html(t),discountNinja.Logging.LogVerbose("Notification already exists, updating message"),f=jQuery("."+discountNinja_Script_Notification.GetClass()),jQuery(f).find("[data-promotion-token]").each(function(){var t=jQuery(this).attr("data-promotion-token"),n=discountNinja.Promotion.GetPromotionByToken(t),i=discountNinja.DiscountLevel.GetCurrentDiscountLevel(n),r=discountNinja.DiscountLevel.GetPercentageAmountFromDiscountLevel(i);discountNinja.ShortCode.RefreshResolvedPlaceholders(this,n,r)}),discountNinja.Logging.LogVerbose("Notification already exists, ensuring it is visible"),discountNinja_Script_Notification.ClearAnimation(f),jQuery(f).show(),discountNinja_Script_Notification.Maximize(),s=[],e=discountNinja_Script_Notification.GetFromCache(),e){for(o=0;o<e.length;o++)s.push(e[o].Token);discountNinja_Script_Notification.HighlightNewPromotions(s)}setTimeout(function(){jQuery(f).show();discountNinja_Script_Notification.Maximize();setTimeout(function(){jQuery(f).show()},500)},500);return}return discountNinja.Logging.LogVerbose("Notification does not exist, creating message"),LimoniAppsLoadJQueryNotify(function(){a(n,r,u,i)}),!0}catch(c){return discountNinja.Logging.LogError("Notification.ShowInternal",c,!0),!1}}var n,u,c;try{if(discountNinja_Script_Notification.GetHiddenInSession()==="true")return;if(n=discountNinja_Script_Notification.GetFromCache(),!n||n.length===0)return;var r=null,t=n.length>1?"<ul>":"",o=[];for(u=0;u<n.length;u++){r=n[u];var i=discountNinja.Promotion.GetPromotionByToken(r.Token),p=discountNinja.DiscountLevel.GetCurrentDiscountLevel(i),f=discountNinja.DiscountLevel.GetPercentageAmountFromDiscountLevel(p),s='data-promotion-token="'+r.Token+'"',h=discountNinja_Script_Notification.GetText(i.NotificationSettings.Body,i,f);t=n.length>1?t+"<li "+s+">"+h+"<\/li>":t+'<span style="display:block;" '+s+">"+h+"<\/span>";r.Animated===!1&&o.push(r.Token)}n.length>1&&(t=t+"<\/ul>");v();c=discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja_Script_Notification.GetHtml(t,i,f));y(c,t,o,i,f)}catch(w){discountNinja.Logging.LogError("Notification.Show",w,!0)}},GetUserToggledMinMaximize:function(){return discountNinja.Cache.SessionGet("notification-usertoggled")},SetUserToggledMinMaximize:function(n){discountNinja.Cache.SessionSet("notification-usertoggled",n)},GetMinMaximizeStatus:function(){return discountNinja.Cache.SessionGet("notification-minmaximizestatus")},SetMinMaximizeStatus:function(n){discountNinja.Cache.SessionSet("notification-minmaximizestatus",n)},GetShownInSession:function(){return discountNinja.Cache.SessionGet("notification-displayed-insession")},SetShownInSession:function(n){discountNinja.Cache.SessionSet("notification-displayed-insession",n)},GetShownOnDevice:function(){return discountNinja.Cache.LocalGet("notification-displayed-ondevice")},SetShownOnDevice:function(n){discountNinja.Cache.LocalSet("notification-displayed-ondevice",n)},GetDismissedInSession:function(){return discountNinja.Cache.SessionGet("notification-dismissed-insession")},SetDismissedInSession:function(n){discountNinja.Cache.SessionSet("notification-dismissed",n)},GetHiddenInSession:function(){return discountNinja.Cache.SessionGet("notification-hidden-insession")},SetHiddenInSession:function(n){discountNinja.Cache.SessionSet("notification-hidden-insession",n)}},discountNinja_Script_PopUp={GetId:function(){return"LimoniApps-DiscountNinja-Popup"},Hide:function(){try{jQuery("#LimoniApps-DiscountNinja-Popup").css("display","none")}catch(n){discountNinja.Logging.LogError("PopUp.Hide",n,!0)}},InjectHtml:function(n,t){function f(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i}var r,i,u;try{if(jQuery("#"+discountNinja_Script_PopUp.GetId()).length>0){discountNinja.ShortCode.RefreshResolvedPlaceholders(jQuery("#"+discountNinja_Script_PopUp.GetId()),n,t);return}r=discountNinja.Utilities.IsMobilePhone()?n.PopUpSettings.MobileSize:n.PopUpSettings.Size;i=n.PopUpSettings.Html;i=i.replace("{{HEADER}}",discountNinja.TextSettings.GetText(n.PopUpSettings.Header,n));i=i.replace("{{BODY}}",discountNinja.TextSettings.GetText(n.PopUpSettings.Body,n));i=i.replace("{{FOOTER}}",discountNinja.TextSettings.GetText(n.PopUpSettings.Footer,n));i=i.replace("{{SIZE}}",r);i=i.replace("{{BUTTONPLACEMENT}}",r==="fullscreen"?"inside":n.PopUpSettings.ButtonPlacement);i=discountNinja.ShortCode.ReplaceAllPlaceHolders(n,i,t);u=f(i);document.body.insertBefore(u,document.body.childNodes[0])}catch(e){discountNinja.Logging.LogError("PopUp.InjectPopUpHtml",e,!0)}},Show:function(n,t){function r(n){try{discountNinja.Promotion.SetPromotionAccepted(n.Token,n.Frequency,"false");discountNinja_Script_PopUp.Hide(n.Token);discountNinja.Promotion.Stop()}catch(t){discountNinja.Logging.LogError("PopUp.Cancel",t,!0)}}function e(n,t){try{discountNinja_Script_PopUp.Hide(n.Token);discountNinja.PromotionFlow.AcceptPromotion(n,t);discountNinja.PromotionFlow.ShowNotifications(n)}catch(i){discountNinja.Logging.LogError("PopUp.Accept",i,!0)}}function u(n,t){discountNinja.Cache.LocalSet("popup-displayed-"+n,t)}function o(n,t){discountNinja.Cache.SessionSet("popup-displayed-"+n,t)}function s(n){n.PopUpSettings.Frequency==="onceperdevice"?u(n.Token,"shown"):(u(n.Token,""),o(n.Token,"shown"))}function h(n,t,i){jQuery(n).removeClass(i.Animation);jQuery(n).addClass(t)}var f,i;try{f=n.Token;discountNinja.Logging.ShowTimeElapsed("Show pop-up");discountNinja.Logging.LogVerbose("Showing pop-up");discountNinja.DiscountCode.Remove(f);discountNinja.Promotion.RemoveFromCache(n);i=jQuery("#"+discountNinja_Script_PopUp.GetId());i.find('.limoniapps-close[data-notify="dismiss"]').click(function(){r(n)});i.find(".limoniapps-lnk-dismiss").click(function(){r(n)});i.find('.limoniapps-action-btn[data-action="apply"]').click(function(){e(n,t)});discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden");h(i.find(".limoniapps-content"),n.PopUpSettings.Animation,n.PopUpSettings);i.css("display","");s(n);discountNinja_Script_PopUp.PopUpDisplayed=!0}catch(c){discountNinja.Logging.LogError("PopUp.Show",c,!0)}}},discountNinja_Script_StickyBar={AnimateOnReminderIntervalHandle:-1,CycleIntervalHandle:-1,CurrentLevelForPromotion:[],GetId:function(){return"limoniapps-discountninja-stickybar-wrapper"},SlideBodyDownLastExecuted:null,SlideBodyDown:function(){function r(){var n=discountNinja_Script_StickyBar.SlideBodyDownLastExecuted,t=!0;return n!==null&&new Date-n<50&&(t=!1),discountNinja_Script_StickyBar.SlideBodyDownLastExecuted=new Date,t}var n,t,i;try{if(discountNinja.Logging.LogVerbose("Resizing"),!r())return;if(discountNinja.Logging.LogVerbose("Resizing - can execute"),discountNinja.Settings.Settings===null)return;n=discountNinja.Settings.Settings.StickyBarSettings;n.PlacementVertical==="top"||n.PlacementVertical==="top_page_sticky"?(discountNinja.Logging.LogVerbose("Applying margin to sticky bar since it is positioned on the top"),t=discountNinja_Script_StickyBar.GetId(),i=jQuery("#"+t).outerHeight(),discountNinja_Script_StickyBar.AddTopMarginToElements(i)):discountNinja.Logging.LogVerbose("No margin applied to sticky bar since it is positioned on the bottom")}catch(u){discountNinja.Logging.LogError("StickyBar.SlideBodyDown",u,!0)}},TopMarginDesktopElements:function(){try{var n=[];return n.push(".limoniapps-discountninja-header-desktop"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginDesktopElements",t,!0),[]}},TopMarginMobileElements:function(){try{var n=[];return n.push(".limoniapps-discountninja-header-mobile"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginMobileElements",t,!0),[]}},TopMarginIncludeClasses:function(){try{var n=[];return n.push("limoniapps-discountninja-topmargin"),n.push("limoniapps-discountninja-header"),n.push("limoniapps-discounturl-header"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginIncludeClasses",t,!0),[]}},TopMarginElements:function(){try{var n=[];return n.push("body"),n.push("#shopify-section-header .header__wrapper, #shopify-section-header header"),n.push("#fsb_background, #qab_bar, #spb-information-bar"),n.push(".privy-tab-container"),n.push(".limoniapps-discountninja-topmargin, .limoniapps-discountninja-header, .limoniapps-discounturl-header"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginElements",t,!0),[]}},TopMarginExcludeClasses:function(){try{var n=[];return n.push("limoniapps-discountninja-header-ignore"),n.push("limoniapps-discountninja-topmargin-ignore"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginExcludeElements",t,!0),[]}},TopMarginExcludeElements:function(){try{var n=[];return n.push(".limoniapps-discountninja-header-ignore"),n.push(".limoniapps-discountninja-topmargin-ignore"),n.push("#shopify-section-header .header__wrapper"),n.push("#shopify-section-header .header-wrapper"),n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginExcludeElements",t,!0),[]}},AddTopMarginToElements:function(n){function r(n,t){try{discountNinja.Logging.LogVerbose("Applying top margin "+t+"px to element "+discountNinja.Utilities.GetElementId(n));discountNinja.Utilities.AppendToStyle(n,"margin-top",t.toString()+"px !important");discountNinja.Utilities.AppendToStyle(n,"background-position","0% "+t.toString()+"px !important")}catch(i){discountNinja.Logging.LogError("StickyBar.ApplyTopMarginToElementStyle",i,!0)}}function u(n,t){var e,o,i,s,h,u,c,l,f,a,v,y;try{if(jQuery(n).length===0)return;for(e=discountNinja_Script_StickyBar.TopMarginExcludeClasses(),o=!1,i=0;i<e.length;i++)if(jQuery(n).hasClass(e[i])){o=!0;break}for(s=discountNinja_Script_StickyBar.TopMarginIncludeClasses(),h=!1,u=0;u<s.length;u++)if(jQuery(n).hasClass(s[u])){h=!0;break}for(c=discountNinja_Script_StickyBar.TopMarginExcludeElements(),l=!1,f=0;f<c.length;f++)if(jQuery(n).parents(c[f]).length>0){l=!0;break}if(o||!h&&l){discountNinja.Logging.LogVerbose("Skipping element because it (or one of its parents) is marked to ignore");return}if(a=jQuery(n).attr("data-original-body-margin-top")!==undefined,a)discountNinja.Logging.LogVerbose("Updating top margin of "+t+"px to element "+discountNinja.Utilities.GetElementId(n)),v=parseInt(jQuery(n).attr("data-original-body-margin-top")),y=v+t,r(n,y);else{discountNinja.Logging.LogVerbose("Adding top margin "+t+"px to element "+discountNinja.Utilities.GetElementId(n));var p=parseInt(jQuery(n).css("margin-top")),w=jQuery(n).css("background-position"),b=p+t;r(n,b);jQuery(n).attr("data-original-body-margin-top",p);jQuery(n).attr("data-original-body-background-position",w)}}catch(k){discountNinja.Logging.LogError("StickyBar.ShowTopMarginToElement",k,!0)}}var t,i;try{for(t=discountNinja_Script_StickyBar.TopMarginElements(),t=discountNinja.Utilities.IsMobilePhone()?t.concat(discountNinja_Script_StickyBar.TopMarginMobileElements()):t.concat(discountNinja_Script_StickyBar.TopMarginDesktopElements()),i=0;i<t.length;i++)jQuery(t[i]).each(function(){u(t[i],n)})}catch(f){discountNinja.Logging.LogError("StickyBar.AddTopMarginToElements",f,!0)}},RemoveTopMarginFromElements:function(){function i(n){var u,t,i;try{if(jQuery(n).length===0)return;try{discountNinja.Logging.LogVerbose("Removing top margin from element "+(n==="body"?"body":jQuery(n).attr("id")))}catch(r){u=0}t=parseInt(jQuery(n).attr("data-original-body-margin-top"));i=jQuery(n).attr("data-original-body-background-position");jQuery(n).css("margin-top",t.toString()+"px");jQuery(n).css("background-position",i)}catch(r){discountNinja.Logging.LogError("StickyBar.HideTopMarginFromElement",r,!0)}}var t,n;try{for(t=discountNinja_Script_StickyBar.TopMarginElements(),n=0;n<t.length;n++)jQuery(t[n]).each(function(){i(t[n])})}catch(r){discountNinja.Logging.LogError("StickyBar.RemoveTopMarginFromElements",r,!0)}},Hide:function(n){function t(n){try{var i=discountNinja_Script_StickyBar.GetId(),t=jQuery("#"+i);t.hide();jQuery(t).hasClass("limoniapps-stick-to-top")&&discountNinja_Script_StickyBar.RemoveTopMarginFromElements();n&&discountNinja_Script_StickyBar.SetHiddenInSession(!0);discountNinja.Logging.LogVerbose("Sticky bar hidden")}catch(r){discountNinja.Logging.LogError("StickyBar.HideInner",r,!0)}}try{discountNinja.Logging.LogVerbose("Hiding sticky bar");var i=discountNinja.Settings.Settings.StickyBarSettings;i.AnimationExit?(discountNinja_Script_StickyBar.ApplyAnimation(jQuery("#"+discountNinja_Script_StickyBar.GetId()),i.AnimationExit),setTimeout(function(){t(n)},800)):t(n)}catch(r){discountNinja.Logging.LogError("StickyBar.Hide",r,!0)}},Remove:function(n){var i,r,t;try{for(discountNinja.Logging.LogInformation("StickyBar.Remove for token "+n),i=discountNinja_Script_StickyBar.GetFromCache(),r=[],t=0;t<i.length;t++)i[t].Token!==n&&r.push(i[t]);discountNinja_Script_StickyBar.MessageCount=r.length;discountNinja_Script_StickyBar.SaveToCache(r);setTimeout(function(){discountNinja_Script_StickyBar.Show()},500)}catch(u){discountNinja.Logging.LogError("StickyBar.Remove",u,!0)}},Clear:function(){discountNinja.Logging.LogInformation("StickyBar.Clear called ");discountNinja_Script_StickyBar.MessageCount=0;discountNinja.Cache.SessionRemove("stickybar-data")},GetFromCache:function(){try{var n=discountNinja.Cache.SessionGet("stickybar-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountNinja.Logging.LogError("StickyBar.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountNinja.Cache.SessionSet("stickybar-data",JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("StickyBar.SaveToCache",t,!0)}},Add:function(n){var t,i;try{for(discountNinja.Logging.LogInformation("StickyBar.Add for token "+n),n||discountNinja.Logging.LogError("StickyBar.Add","Expected token",!1),t=discountNinja_Script_StickyBar.GetFromCache(),i=0;i<t.length;i++)if(t[i]&&t[i].Token===n)return;t.push({Token:n});discountNinja_Script_StickyBar.MessageCount=discountNinja_Script_StickyBar.MessageCount+1;discountNinja_Script_StickyBar.SaveToCache(t)}catch(r){discountNinja.Logging.LogError("StickyBar.Add",r,!0)}},CurrentMessageIndex:0,MessageCount:0,CycleMessage:function(n){function t(){try{discountNinja_Script_StickyBar.CurrentMessageIndex=discountNinja_Script_StickyBar.CurrentMessageIndex+1;discountNinja_Script_StickyBar.CycleMessage(!0)}catch(n){discountNinja.Logging.LogError("StickyBar.CycleMessage.CycleMessageInner",n,!0)}}try{discountNinja.Logging.LogVerbose("StickyBar.CycleMessage");discountNinja_Script_StickyBar.ShowMessage(n);var i=discountNinja.Settings.Settings.StickyBarSettings;if(discountNinja_Script_StickyBar.MessageCount<=1)return;discountNinja_Script_StickyBar.CycleIntervalHandle=setTimeout(function(){t()},i.CycleSettings.DurationMilliseconds)}catch(r){discountNinja.Logging.LogError("StickyBar.CycleMessage",r,!0)}},ApplyAnimation:function(n,t){var i=discountNinja.Settings.Settings.StickyBarSettings;jQuery(n).removeClass(i.AnimationEnter);jQuery(n).removeClass(i.AnimationOnGoal);jQuery(n).removeClass(i.AnimationOnReminder);jQuery(n).removeClass(i.AnimationExit);jQuery(n).removeClass(i.CycleSettings.AnimationOnCyle);jQuery(n).addClass(t)},ShowMessage:function(n){function v(n){try{var t=discountNinja.DiscountLevel.GetCurrentDiscountLevel(n),i=discountNinja.DiscountLevel.GetPercentageAmountFromDiscountLevel(t);return discountNinja.ShortCode.ReplaceAllPlaceHolders(n,discountNinja.TextSettings.GetText(n.StickyBarSettings.Body,n),i)}catch(r){return discountNinja.Logging.LogError("StickyBar.GetBodyMessage",r,!0),""}}function c(n){try{var t=discountNinja.DiscountLevel.GetCurrentDiscountLevel(n),i=discountNinja.DiscountLevel.GetPercentageAmountFromDiscountLevel(t);return discountNinja.Timer.IsTimerStarted()?discountNinja.ShortCode.ReplaceAllPlaceHolders(n,discountNinja.TextSettings.GetText(n.StickyBarSettings.TimerFooter,n),i):""}catch(r){return discountNinja.Logging.LogError("StickyBar.GetTimerFooterMessage",r,!0),""}}function y(n){var t=n.split(" ");return t[0]+" "+t[1]}function p(n){var t=n.split(" ");return t.length===3?t[0]+" "+t[2]:t[0]+" "+t[1]}function w(n){var t=jQuery(".limoniapps-sticky-topbar .limoniapps-content");discountNinja_Script_StickyBar.ApplyAnimation(t,n)}function l(){if(t.StickyBarSettings.AnimationOnGoal){var i=!1,n=discountNinja.DiscountLevel.GetCurrentDiscountLevel(t),r=discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token];i=r!==undefined?r<n:n>0;i&&(discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token]=n,w(discountNinja.Settings.Settings.StickyBarSettings.AnimationOnGoal))}}function s(n){discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Change messages");var t=v(n),i=c(n);jQuery(d).html(t);jQuery(g).html(i)}var u,a,i,t,e,o,h;try{if(discountNinja_Script_StickyBar.CurrentMessageIndex>=discountNinja_Script_StickyBar.MessageCount&&(discountNinja_Script_StickyBar.CurrentMessageIndex=0),u=discountNinja_Script_StickyBar.CurrentMessageIndex,discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Index: "+u),a=discountNinja_Script_StickyBar.GetFromCache(),i=a[u],!i){discountNinja.Logging.LogError("StickyBar.ShowMessage","Notification "+u+" not found",!0);return}t=discountNinja.Promotion.GetPromotionByToken(i.Token);discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Token: "+t.Token);var b=discountNinja.Settings.Settings.StickyBarSettings,k=discountNinja_Script_StickyBar.GetId(),f=jQuery("#"+k),r=jQuery(f).find(".limoniapps-info"),d=jQuery(f).find(".limoniapps-message.limoniapps-message-body"),g=jQuery(f).find(".limoniapps-message.limoniapps-message-timerfooter");return jQuery(f).find(".limoniapps-sticky-topbar").attr("data-token",t.Token),e=b.CycleSettings.AnimationOnCyle,n&&e&&discountNinja_Script_StickyBar.MessageCount>0?(o=p(e),h=y(e),h!==o?(discountNinja_Script_StickyBar.ApplyAnimation(r,h),setTimeout(function(){timerFooterMessage=c(t);s(t);jQuery(r).hide();setTimeout(function(){jQuery(r).show();discountNinja_Script_StickyBar.ApplyAnimation(r,o)},50);l()},500)):(s(t),discountNinja_Script_StickyBar.ApplyAnimation(r,o))):s(t),setTimeout(function(){discountNinja_Script_StickyBar.SlideBodyDown()},50),l(),discountNinja_Script_StickyBar.SetShownInSession(i.Token,!0),discountNinja_Script_StickyBar.SetShownOnDevice(i.Token,!0),!0}catch(nt){return discountNinja.Logging.LogError("StickyBar.ShowMessage",nt,!0),!1}},Show:function(){function u(n,t){setTimeout(function(){discountNinja_Script_StickyBar.ApplyAnimation(jQuery(".limoniapps-sticky-topbar .limoniapps-col-info"),n);u(n,t)},t)}function s(){return discountNinja.Cache.SessionGet("stickybar-displayed-insession")}function h(n){discountNinja.Cache.SessionSet("stickybar-displayed-insession",n)}function c(){var t,n,i;try{return t=discountNinja.Settings.Settings.StickyBarSettings,n=t.Html,n=n.replace("{{BODY}}",""),n=n.replace("{{HEIGHT}}",discountNinja.Utilities.IsMobilePhone()?t.MobileHeight:t.Height),i=discountNinja.Promotion.PrimaryPromotion,i&&i.StickyBarSettings.BackgroundColor&&(n=n.replace(/(background-color:)([^;])*(;)/,"background-color:"+i.StickyBarSettings.BackgroundColor+";")),n}catch(r){return discountNinja.Logging.LogError("StickyBar.GetEmptyHtml",r,!0),""}}var f,e;try{if(discountNinja_Script_StickyBar.GetHiddenInSession()==="true")return;if(discountNinja_Script_StickyBar.MessageCount<=0){discountNinja_Script_StickyBar.Hide();return}var n=discountNinja.Settings.Settings.StickyBarSettings,i=discountNinja_Script_StickyBar.GetId(),r=jQuery("#"+i),t=jQuery(r).length===1;if(t)jQuery(r).removeClass(n.AnimationExit),jQuery(r).show();else{f="limoniapps-stick-to-"+n.PlacementVertical;e=s()==="true";h(!0);var l=!t&&!e&&n.AnimationEnter?" "+n.AnimationEnter:"",a=c(),o='<div id="'+i+'" class="'+f+l+'">'+a+"<\/div>";n.PlacementVertical==="top_header"?jQuery("#shopify-section-header").append(o):jQuery("body").prepend(o);n.CloseButton&&jQuery("#"+i).find('.limoniapps-close[data-notify="dismiss"]').click(function(){try{discountNinja_Script_StickyBar.SetDismissedInSession(!0);discountNinja_Script_StickyBar.Hide(!0)}catch(n){return discountNinja.Logging.LogError("StickyBar.Show.Dismiss",n,!0),!1}});n.Delay&&n.Delay>0&&setTimeout(function(){discountNinja_Script_StickyBar.Hide(!0)},n.Delay);discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden")}n=discountNinja.Settings.Settings.StickyBarSettings;n.CycleSettings.Mode==="cycle"&&discountNinja_Script_StickyBar.MessageCount>1?(clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),discountNinja_Script_StickyBar.CycleMessage(!t)):(discountNinja_Script_StickyBar.CurrentMessageIndex=0,discountNinja_Script_StickyBar.ShowMessage(!t));discountNinja.Settings.Settings.StickyBarSettings.AnimationOnReminder&&(clearInterval(discountNinja_Script_StickyBar.AnimateOnReminderIntervalHandle),u(discountNinja.Settings.Settings.StickyBarSettings.AnimationOnReminder,discountNinja.Settings.Settings.StickyBarSettings.ReminderDuration));jQuery(window).on("resize",function(){discountNinja_Script_StickyBar.SlideBodyDown()})}catch(v){return discountNinja.Logging.LogError("StickyBar.Show",v,!0),!1}},GetShownInSession:function(n){return discountNinja.Cache.SessionGet("stickybar-promotion-displayed-insession-"+n)},SetShownInSession:function(n,t){discountNinja.Cache.SessionSet("stickybar-promotion-displayed-insession-"+n,t)},GetShownOnDevice:function(n){return discountNinja.Cache.LocalGet("stickybar-displayed-ondevice-"+n)},SetShownOnDevice:function(n,t){discountNinja.Cache.LocalSet("stickybar-displayed-ondevice-"+n,t)},GetDismissedInSession:function(n){return discountNinja.Cache.SessionGet("stickybar-dismissed-insession-"+n)},SetDismissedInSession:function(n,t){discountNinja.Cache.SessionSet("stickybar-dismissed-insession-"+n,t)},GetHiddenInSession:function(){return discountNinja.Cache.SessionGet("stickybar-hidden-insession")},SetHiddenInSession:function(n){discountNinja.Cache.SessionSet("stickybar-hidden-insession",n)}},discountNinja_Script_Timer={TimeZone:null,Start:function(){function s(n){try{var t=n.match(/\{.*?\}/);return t!==null&&t.length>0?t[0]:null}catch(i){return discountNinja.Logging.LogError("Timer.GetJSONFromTimeString",i,!0),null}}function n(n,t){try{return discountNinja_Script_Timer.TimerLabels[n][t]}catch(i){return discountNinja.Logging.LogError("Timer.GetTimeLabel",i,!0),""}}function r(n,t,i,r,u,f,e,o,s,h,c){function v(n){return n<10?"0"+n:n}var l,a,y;try{return l="",a=!1,n>0&&(l=l+n+e,a=!0),t>0&&(c&&a&&(t=v(t)),l=l!==""?l+u+t+o:l+t+o,a=!0),i>0&&(c&&a&&(i=v(i)),l=l!==""?l+u+i+s:l+i+s,a=!0),r>0&&(c&&a&&(r=v(r)),l=l!==""?l+u+r+h:l+r+h),y=l.lastIndexOf(u),l.slice(0,y)+l.slice(y).replace(u,f)}catch(p){return discountNinja.Logging.LogError("Timer.TimeFormattingAsDuration",p,!0),""}}function h(t,i){try{var e=i.asSeconds(),f=t.TimerSettings.FormattingTemplateIn,o=s(moment.duration(i,"seconds").format('s [{"Days":]d[,"Hours":]h[,"Minutes":]m[,"Seconds":]s[}]')),u=JSON.parse(o);return f==="in_seconds"?moment.duration(e,"seconds").format("s ["+n(3,0)+"]"):f==="in_minutes"?moment.duration(e,"seconds").format("m ["+n(2,0)+"]"):f==="in_hours_minutes_and_seconds"?moment.duration(e,"seconds").format("h ["+n(1,0)+"][,] m ["+n(2,0)+"] ["+n(4,0)+"] s ["+n(3,0)+"]"):f==="in_hours_minutes_and_seconds_short"?moment.duration(e,"seconds").format("h ["+n(1,1)+"][,] m ["+n(2,1)+"] ["+n(4,0)+"] s ["+n(3,1)+"]"):f==="in_minutes_and_seconds"?moment.duration(e,"seconds").format("m ["+n(2,0)+"] ["+n(4,0)+"] s ["+n(3,0)+"]"):f==="in_minutes_and_seconds_short"?moment.duration(e,"seconds").format("m ["+n(2,1)+"] ["+n(4,0)+"] s ["+n(3,1)+"]"):f==="in_hours"?moment.duration(e,"seconds").format("h ["+n(1,0)+"]"):f==="in_days"?moment.duration(e,"seconds").format("d ["+n(0,0)+"]"):f==="in_duration"?moment.duration(i,"days").format("d ["+n(0,0)+"] h ["+n(1,0)+"] m ["+n(2,0)+"] s ["+n(3,0)+"]"):f==="in_duration_short"?moment.duration(i,"days").format("d ["+n(0,1)+"] h ["+n(1,1)+"] m ["+n(2,1)+"] s ["+n(3,1)+"]"):f==="in_durationcommaand"?r(u.Days,u.Hours,u.Minutes,u.Seconds,", "," "+n(4,0)+" "," "+n(0,0)," "+n(1,0)," "+n(2,0)," "+n(3,0)):f==="in_durationcommaand_short"?r(u.Days,u.Hours,u.Minutes,u.Seconds,", "," "+n(4,0)+" "," "+n(0,1)," "+n(1,1)," "+n(2,1)," "+n(3,1)):f==="in_durationwithcolon"?r(u.Days,u.Hours,u.Minutes,u.Seconds,":",":"," "+n(0,2)," "+n(1,2)," "+n(2,2)," "+n(3,2)):f==="in_durationwithspace"?r(u.Days,u.Hours,u.Minutes,u.Seconds," "," "," "+n(0,2)," "+n(1,2)," "+n(2,2)," "+n(3,2)):f==="in_durationwithcomma"?r(u.Days,u.Hours,u.Minutes,u.Seconds,", ",", "," "+n(0,2)," "+n(1,2)," "+n(2,2)," "+n(3,2)):f==="in_durationwithcolon_short"?r(u.Days,u.Hours,u.Minutes,u.Seconds,":",":","","","","",!0):""}catch(h){return discountNinja.Logging.LogError("Timer.TimeFormattingInternal",h,!0),LimoniAppsLoadMomentFormat(),""}}function c(){try{discountNinja.Logging.LogVerbose("Expiring timer");discountNinja_Script_Timer.IsTimerStarted()?(discountNinja_Script_Timer.SetTimerStarted(!1),i!==null&&i!==0&&clearInterval(i),discountNinja.Logging.LogVerbose("Timer stopped, restarting flow"),discountNinja.PromotionFlow.StartFlow()):discountNinja.Logging.LogVerbose("Timer was not started")}catch(n){discountNinja.Logging.LogError("Timer.Expire",n,!0)}}function f(n){var t=moment(n);return moment.duration(t.diff(moment().utc()))}function e(n,t){var r,i,u;try{r=f(t);r.asSeconds()>1?(i=h(n,r),i=i.replace(/(\d)/g,'<div class="limoniapps-discountninja-countdownclock-digit">$1<\/div>'),u=".limoniapps-discountninja-timer",jQuery(u).html('<div class="limoniapps-discountninja-countdownclock-container">'+i+"<\/div>")):c()}catch(e){discountNinja.Logging.LogError("Timer.UpdateTimer",e,!0)}}function l(n){function t(n){try{return n&&n!==""?[n,n,n]:null}catch(t){return discountNinja.Logging.LogError("Timer.ProcessCustomTimeLabels",t,!0),null}}try{var i=t(n.CustomDaysLabel)||["days","days","d"],r=t(n.CustomHoursLabel)||["hours","hrs","h"],u=t(n.CustomMinutesLabel)||["minutes","min","m"],f=t(n.CustomSecondsLabel)||["seconds","sec","s"],e=t(n.CustomAndLabel)||["and","&","&"];discountNinja_Script_Timer.TimerLabels=[i,r,u,f,e]}catch(o){discountNinja.Logging.LogError("Timer.ProcessTimerSettings",o,!0)}}var u,o,t,i;try{if(u=discountNinja.Promotion.PrimaryPromotion.TimerSettings?discountNinja.Promotion.PrimaryPromotion.TimerSettings.EndsAt:null,!u)return;if(o=f(u),o<=0)return;if(t=discountNinja.Settings.Settings,!t||!t.TimerSettings||!t.TimerSettings.Enabled||discountNinja.Promotion.PrimaryPromotion.Mode===null)return;l(t.TimerSettings);i!==null&&i!==0&&clearInterval(i);i=window.setInterval(function(){e(t,u)},1e3);e(t,u);discountNinja_Script_Timer.SetTimerStarted(!0);discountNinja.Logging.LogVerbose("Started timer")}catch(a){discountNinja.Logging.LogError("Timer.Start",a,!0)}},FormatDate:function(n,t){function r(n){return n?n.startOf("minute"):n}function u(){try{return LimoniAppsLoadMoment(function(){return LimoniAppsLoadMomentFormat(function(){LimoniAppsLoadMomentTimezone(function(){return discountNinja_Script_Timer.TimeZone===null&&(discountNinja_Script_Timer.TimeZone=moment.tz.guess(),discountNinja.Logging.LogVerbose("Assuming timezone is: "+discountNinja_Script_Timer.TimeZone)),discountNinja_Script_Timer.TimeZone})})})}catch(n){return discountNinja.Logging.LogError("Timer.GetTimeZone",n,!0),"America/Los_Angeles"}}function f(n){try{i=moment(n).utc();var f=u(),t=moment(i).tz(f);return i=typeof t=="undefined"||t===null?i:t,r(i)}catch(e){return discountNinja.Logging.LogError("Timer.GetMoment",e,!1),null}}try{var i=f(n);return t===null||t===""?"":i?i.format(t):""}catch(e){return discountNinja.Logging.LogError("Timer.FormatDate",e,!0),null}},Stop:function(){discountNinja_Script_Timer.SetTimerStarted(!1)},ShouldStartOn:function(n,t){return n?discountNinja.Settings.Settings.TimerSettings.Enabled?n.TimerMode===t:!1:!1},ShouldStartOnDisplay:function(n){return discountNinja_Script_Timer.ShouldStartOn(n,"displayed")},ShouldStartOnAccept:function(n){return discountNinja_Script_Timer.ShouldStartOn(n,"accepted")},ShouldStartOnGoalAchieved:function(n){return discountNinja_Script_Timer.ShouldStartOn(n,"goalachieved")},ShouldNotStart:function(n){return discountNinja_Script_Timer.ShouldStartOn(n,undefined)},IsTimerStarted:function(){return discountNinja.Cache.SessionGet("timer-started")==="true"},SetTimerStarted:function(n){discountNinja.Cache.SessionSet("timer-started",n)}},discountNinja_Script_Cache={Fallback:{},SupportsCacheLocal:function(){try{return localStorage.setItem("testSupportsCacheLocal","testSupportsCacheLocal"),localStorage.removeItem("testSupportsCacheLocal"),!0}catch(n){return!1}},SupportsCacheSession:function(){try{return sessionStorage.setItem("testSupportsCacheSession","testSupportsCacheSession"),sessionStorage.removeItem("testSupportsCacheSession"),!0}catch(n){return!1}},LocalRemove:function(n){try{discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.removeItem("limoniapps-discountninja-"+n):discountNinja_Script_Cache.SessionRemove(n)}catch(t){discountNinja.Logging.LogError("Cache.LocalRemove",'For key "'+n+'". Attempting CacheSessionRemove. '+t,!0);discountNinja_Script_Cache.SessionRemove(n)}},LocalGet:function(n){try{return discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.getItem("limoniapps-discountninja-"+n):discountNinja_Script_Cache.SessionGet(n)}catch(t){return discountNinja.Logging.LogError("Cache.LocalGet",'For key "'+n+'". Attempting CacheSessionGet. '+t,!0),discountNinja_Script_Cache.SessionGet(n)}},LocalSet:function(n,t){try{discountNinja_Script_Cache.SupportsCacheLocal()?(discountNinja_Script_Cache.LocalRemove(n),localStorage.setItem("limoniapps-discountninja-"+n,t)):discountNinja_Script_Cache.SessionSet(n,t)}catch(i){discountNinja.Logging.LogError("Cache.LocalSet",'For key "'+n+'". Attempting CacheSessionSet.',i,!0);discountNinja_Script_Cache.SessionSet(n,t)}},SessionRemove:function(n){try{discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.removeItem("limoniapps-discountninja-"+n):discountNinja_Script_Cache.FallbackRemove(n)}catch(t){discountNinja.Logging.LogError("Cache.SessionRemove",'For key "'+n+'". Attempting CacheFallbackRemove. '+t,!0);discountNinja_Script_Cache.FallbackRemove(n)}},SessionGet:function(n){try{return discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.getItem("limoniapps-discountninja-"+n):discountNinja_Script_Cache.FallbackGet(n)}catch(t){return discountNinja.Logging.LogError("Cache.SessionGet",'For key "'+n+'". Attempting CacheFallbackGet. '+t,!0),discountNinja_Script_Cache.FallbackGet(n)}},SessionSet:function(n,t){try{discountNinja_Script_Cache.SupportsCacheSession()?(discountNinja_Script_Cache.SessionRemove(n),sessionStorage.setItem("limoniapps-discountninja-"+n,t)):discountNinja_Script_Cache.FallbackSet(n,t)}catch(i){discountNinja.Logging.LogError("Cache.SessionSet",'For key "'+n+'". Attempting CacheFallbackSet. '+i,!0);discountNinja_Script_Cache.FallbackSet(n,t)}},FallbackRemove:function(n){try{delete discountNinja_Script_Cache.Fallback[n]}catch(t){discountNinja.Logging.LogError("Cache.FallbackRemove",t,!0)}},FallbackGet:function(n){try{return discountNinja_Script_Cache.Fallback.hasOwnProperty(n)?discountNinja_Script_Cache.Fallback[n]:null}catch(t){return discountNinja.Logging.LogError("Cache.FallbackGet",t,!0),null}},FallbackSet:function(n,t){try{discountNinja_Script_Cache.Fallback[n]=String(t)}catch(i){discountNinja.Logging.LogError("Cache.FallbackSet",i,!0)}},FallbackClear:function(){try{discountNinja_Script_Cache.Fallback={}}catch(n){discountNinja.Logging.LogError("Cache.FallbackClear",n,!0)}},LocalClear:function(){try{discountNinja_Script_Cache.SupportsCacheLocal()&&localStorage.clear()}catch(n){discountNinja.Logging.LogError("Cache.LocalClear",n,!0)}},SessionClear:function(){try{discountNinja_Script_Cache.SupportsCacheSession()&&sessionStorage.clear()}catch(n){discountNinja.Logging.LogError("Cache.SessionClear",n,!0)}},Clear:function(){try{discountNinja_Script_Cache.LocalClear();discountNinja_Script_Cache.SessionClear();discountNinja_Script_Cache.FallbackClear()}catch(n){discountNinja.Logging.LogError("Cache.ClearCache",n,!0)}}},discountNinja_Script_Cookie={GetCookie:function(n){return(document.cookie.match("(^|; )"+n+"=([^;]*)")||0)[2]},GetDiscountCodeCookie:function(){return discountNinja_Script_Cookie.GetCookie("discount_code")},AppendDiscountCodeToCookie:function(n){discountNinja_Script_Cookie.RemoveDiscountCodesFromCookie();var t="discount_code="+encodeURI(n)+"; path=/";discountNinja.Logging.LogVerbose("Adding/updating cookie: "+t,!1);document.cookie=t},RemoveDiscountCodesFromCookie:function(){document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}},discountNinja_Script_ErrorHandler={ServerUrl:function(){return"https://discountninjav2-loggingapi-prod.azurewebsites.net"},LogErrorToServer:function(n,t){function r(n){return n?/search|spider|crawl|Bot|Monitor|BrowserMob|BingPreview|PagePeeker|WebThumb|URL2PNG|ZooShot|GomezA|Google SketchUp|Read Later|KTXN|KHTE|Keynote|Pingdom|AlwaysOn|zao|borg|oegp|silk|Xenu|zeal|NING|htdig|lycos|slurp|teoma|voila|yahoo|Sogou|CiBra|Nutch|Java|JNLP|Daumoa|Genieo|ichiro|larbin|pompos|Scrapy|snappy|speedy|vortex|favicon|indexer|Riddler|scooter|scraper|scrubby|WhatWeb|WinHTTP|voyager|archiver|Icarus6j|mogimogi|Netvibes|altavista|charlotte|findlinks|Retreiver|TLSProber|WordPress|wsr-agent|http client|Python-urllib|AppEngine-Google|semanticdiscovery|facebookexternalhit|Google-HTTP-Java-Client/i.test(n):!1}function u(){try{var i={},u=discountNinja.Promotion.GetPromotionDiscountCode()||"No promotion title available",f=discountNinja.Token.GetToken(),e=discountNinja.Core.Shop,o=discountNinja_Script_ErrorHandler.ProductHandle,s=discountNinja.Environment.Shopify.CollectionHandle(),h=discountNinja.Environment.Shopify.VariantId();return i.errorContext=JSON.stringify(n),i.isBot=r(i.errorContext),i.level=t,e&&(i.shop=e),f&&(i.token=f),u&&(i.discountCode=u),o&&(i.productHandle=o),s&&(i.collectionHandle=s),h&&(i.variantId=h),i}catch(c){return console.error("ErrorHandler.BuildParameters failed: "+c),null}}try{discountNinja.Logging.LogVerbose("Logging error "+JSON.stringify(n));var i=u();if(i===null){discountNinja.Logging.LogVerbose("Could not log error to server due to an error while building parameters.");return}i.isBot&&discountNinja.Logging.LogVerbose("Not sending error message to server, browser is a bot")}catch(f){discountNinja.Logging.LogError("ErrorHandler.LogErrorToServer",f,!1)}}},discountNinja_Script_Events={GetFullQualifiedEventName:function(n){return"limoniApps:discountNinja:"+n},Publish:function(n,t){var i=discountNinja_Script_Events.GetFullQualifiedEventName(n);jQuery(document).trigger(i,t)},Subscribe:function(n,t,i){(typeof i=="undefined"||i===null)&&(i=!0);var r=discountNinja_Script_Events.GetFullQualifiedEventName(n);i&&jQuery(document).off(r);discountNinja.Logging.LogVerbose("Subscribing to event "+r);jQuery(document).on(r,function(){t&&t.apply(this,arguments)})}},discountNinja_Script_Logging={StartTime:null,WriteToConsole:!1,LogTimeElapsed:!1,LogWarningToServer:!0,StartTimer:function(){try{discountNinja_Script_Logging.StartTime=moment().utc()}catch(n){discountNinja_Script_Logging.LogError("Logging.StartTimer","Exception in StartTimer",n,!0)}},LogError:function(n,t,i){var r,u,f;try{r=discountNinja_Script_Logging.BuildErrorContext("Error occurred in "+n+" "+t);r!==null&&(u="Error occurred on page "+r.Page+" with browser "+r.Browser,discountNinja_Script_Logging.LogToConsole("error","Discount Ninja V2 - "+u+" - Error: "+decodeURIComponent(r.Message)),i&&discountNinja.ErrorHandler.LogErrorToServer(r,"error"))}catch(e){f=0}},LogWarning:function(n,t,i){try{(i===undefined||i===null)&&(i=!1);var r=discountNinja_Script_Logging.BuildErrorContext(n);r!==null&&(discountNinja_Script_Logging.LogWarningToServer&&i&&discountNinja.ErrorHandler.LogErrorToServer(r,"warning"),t&&discountNinja_Script_Logging.LogToConsole("warning","Discount Ninja V2 - "+decodeURIComponent(r.Message)))}catch(u){discountNinja_Script_Logging.LogError("Logging.LogWarning",u,!1)}},LogInformation:function(n,t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("information","Discount Ninja V2 - "+n,"blue")}catch(i){discountNinja_Script_Logging.LogError("Logging.LogInformation",i,t)}},LogVerbose:function(n,t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("debug","DEBUG - Discount Ninja V2 - "+n,"gray")}catch(i){discountNinja_Script_Logging.LogError("Logging.LogInformation",i,t)}},LogTestMode:function(n,t,i,r,u){var e,f;try{if(discountNinja.TestMode.TestMode===!0&&(u=!1),(r===!0||u===!0)&&discountNinja_Script_Logging.LogInformation(t||n,u),i===!0){for(e="- "+n+"<br/>",f=0;f<discountNinja.TestMode.TestModeOutput.length;f++)if(discountNinja.TestMode.TestModeOutput[f]===e)return;discountNinja.TestMode.TestModeOutput.push(e);discountNinja.TestMode.TestModeOutputIssue=!0}}catch(o){discountNinja_Script_Logging.LogError("Logging.LogTestMode",o,!0)}},LogToConsole:function(n,t,i,r){var f,u;try{f=n==="error"||n==="critical"?Function.prototype.bind.call(console.error,console):n==="warn"||n==="warning"?Function.prototype.bind.call(console.warn,console):n==="debug"||n==="verbose"?Function.prototype.bind.call(console.debug,console):Function.prototype.bind.call(console.log,console);i=i||"black";r=r||!1;u="";r===!0&&(u="font-weight: bold;");f.apply(console,["%c"+t,"color: "+i+";"+u])}catch(e){try{console&&console.log(t)}catch(e){discountNinja_Script_Logging.LogError("Logging.LogToConsole",e,!0)}}},BuildErrorContext:function(n){try{n!==undefined&&n!==null?(n=n.replace("Promotion would normally not be displayed","Promotion will not be displayed"),n=n.replace(/( Learn more)(.)*(<\/a>.)/g,""),n=encodeURIComponent(n)):n="";return{Version:discountNinja_Script_Logging.Version,Referrer:encodeURIComponent(discountNinja.Utilities.GetReferrer()),Page:window.location.href,Browser:navigator.userAgent,Message:n===undefined||n===null?"":n}}catch(i){return null}},ShowTimeElapsed:function(n){if(discountNinja_Script_Logging.LogTimeElapsed)try{discountNinja_Script_Logging.LogInformation("Time elapsed: "+moment().utc().diff(discountNinja_Script_Logging.StartTime,"milliseconds")+"ms - Currently at: "+n)}catch(t){discountNinja_Script_Logging.LogError("Logging.ShowTimeElapsed",t,!0)}},HandleQueryParameter:function(){discountNinja.QueryParameter.Get("discountninjalog")?(discountNinja_Script_Logging.WriteToConsole=!0,discountNinja.Cache.SessionSet("discountninjalog",!0),discountNinja.QueryParameter.Remove("discountninjalog")):discountNinja.Cache.SessionGet("discountninjalog")&&(discountNinja_Script_Logging.WriteToConsole=!0)}},discountNinja_Script_MultiCurrency={UpdateCurrency:function(){function n(){try{if(typeof Geolizr=="object"){var t=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,n=window.Geolizr.getCurrency();discountNinja.Logging.LogVerbose("Updating currency - Switching to "+n);window.Geolizr.moneyFormats[t]&&window.Geolizr.moneyFormats[n]?(window.Geolizr.switchCurrency(t),window.Geolizr.switchCurrency(n)):discountNinja.Logging.LogVerbose("Currency unavailable "+t+" or "+n)}}catch(i){discountNinja.Logging.LogError("UpdateCurrencyGeolizr",i,!0)}}function t(){try{typeof convertCurrencies=="function"&&(discountNinja.Logging.LogVerbose("Updating currency - Standard"),window.convertCurrencies())}catch(n){discountNinja.Logging.LogError("UpdateCurrencyStandard",n,!0)}}function i(){try{var n=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency;typeof window.DoublyGlobalCurrency.currentCurrency!="undefined"&&window.DoublyGlobalCurrency.currentCurrency!==null&&window.DoublyGlobalCurrency.currentCurrency!==""&&(n=window.DoublyGlobalCurrency.currentCurrency);typeof window.DoublyGlobalCurrency.convertAll=="function"&&(n!==discountNinja.Settings.Settings.CurrencySettings.BaseCurrency&&(discountNinja.Logging.LogVerbose("Updating currency - Doubly - Back to base currency: "+discountNinja.Settings.Settings.CurrencySettings.BaseCurrency),window.DoublyGlobalCurrency.convertAll(discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,".money")),discountNinja.Logging.LogVerbose("Updating currency - Doubly - To current currency: "+n),window.DoublyGlobalCurrency.convertAll(n,".money"))}catch(t){discountNinja.Logging.LogError("UpdateCurrencyDoubly",t,!0)}}function r(){try{var n=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,t=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency;typeof window.Currency.shopCurrency!="undefined"&&window.Currency.shopCurrency!==null&&window.Currency.shopCurrency!==""&&(n=window.Currency.shopCurrency);typeof window.Currency.currentCurrency!="undefined"&&window.Currency.currentCurrency!==null&&window.Currency.currentCurrency!==""&&(t=window.Currency.currentCurrency);n!==t&&typeof window.Currency.convertAll=="function"&&(discountNinja.Logging.LogVerbose("Updating currency - SECOMAPP - From base currency: "+n+" - To current currency: "+t),window.Currency.convertAll(n,t))}catch(i){discountNinja.Logging.LogError("UpdateCurrencySecomapp",i,!0)}}try{typeof DoublyGlobalCurrency=="object"?i():typeof Geolizr=="object"?n():typeof SECOMAPP=="object"&&typeof Currency=="object"?r():typeof convertCurrencies=="function"&&typeof Currency=="object"&&t()}catch(u){discountNinja.Logging.LogError("UpdateCurrency",u,!0)}}},discountNinja_Script_QueryParameter={GetQueryParameters:function(n){var i;try{var u=n===null||n===undefined?window.location.href.replace(window.location.hash,""):n.indexOf("#")>-1?n.substring(0,n.indexOf("#")):n,r=[],t,f=u.slice(u.indexOf("?")+1).split("&");for(i=0;i<f.length;i++)t=f[i].split("="),r.push(t[0]),r[t[0]]=t[1];return r}catch(e){return discountNinja.Logging.LogError("QueryParameter.GetQueryParameters",e,!0),[]}},Get:function(n,t){try{var r=discountNinja_Script_QueryParameter.GetQueryParameters(t),i=r[n];return i==="undefined"||i==="null"||i==="UNDEFINED"||i==="NULL"||i===null?null:i}catch(u){return discountNinja.Logging.LogError("QueryParameter.Get",u,!0),null}},Remove:function(n){var i,r,e,t,u,f;try{i=discountNinja_Script_QueryParameter.GetQueryParameters();r=[];for(e in Object.keys(i))t=i[e],u=i[t],typeof t!="undefined"&&t!==null&&typeof u!="undefined"&&u!==null&&t!==n&&r.push(t+"="+u);f=r.length<1?"":"?"+r.join("&");window.history&&window.history.replaceState?window.history.replaceState({},document.title,location.origin+location.pathname+f):document.location.search=f}catch(o){discountNinja.Logging.LogError("QueryParameter.Remove",o,!0)}},RemoveFromUrl:function(n,t,i){try{return n.replace(t+"="+i,"")}catch(r){discountNinja.Logging.LogError("QueryParameter.RemoveFromUrl",r,!0)}},AppendToUrl:function(n,t,i,r){var u,f;try{return(i=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(i),t=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(t),u=discountNinja_Script_QueryParameter.GetQueryParameters(n)[t],u!==undefined&&u===i)?n:(r&&u!==undefined&&(n=discountNinja_Script_QueryParameter.RemoveFromUrl(n,t,u)),f="",f=n.indexOf("?")>0?n+"&"+t+"="+i:n+"?"+t+"="+i,f.replace("?&","?"))}catch(e){discountNinja.Logging.LogError("QueryParameter.AppendToUrl",e,!0)}}},discountNinja_Script_TextSettings={GetText:function(n,t){function v(n,t){return t=t.replace(/display(\s)*:(\s)*block/g,""),n.replace("<\/span>","&nbsp;"+t+"<\/span>")}if(!n)return"";var y=discountNinja.Environment.Shopify.IsCartPage(),p=discountNinja.Utilities.IsMobilePhone(),w=t===null?!1:t.OfferType==="spendx_gety",r="-";if(w){var b=discountNinja.DiscountedCart.CartValue(t),s=t===null?0:discountNinja.DiscountLevel.GetCurrentDiscountLevelNumber(t,b),k=t===null?0:discountNinja.DiscountLevel.GetMaxDiscountLevelNumber(t.PriceRuleInfo);s===k?r="after":s>0?r="duringandafter":s>-1&&(r="during")}var o="",u="",a="",h=n.TextOnCartDuringGoal,c=n.TextOnCartAfterGoal,l=n.TextOnCart,f=n.TextDuringGoal,e=n.TextAfterGoal,i=n.Text;return p&&(h=n.MobileTextOnCartDuringGoal||h,c=n.MobileTextOnCartAfterGoal||c,l=n.MobileTextOnCart||l,f=n.MobileTextDuringGoal||f,e=n.MobileTextAfterGoal||e,i=n.MobileText||i),y&&(f=h||f,e=c||e,i=l||i),o=f||i||"",u=e||i||"",a=i||"",r==="duringandafter"?u===o?u:v(u,o):r==="during"?o:r==="after"?u:a}},discountNinja_Script_Utilities={EncodeUriComponent:function(n){var t,r,i;try{if(!n)return n;t=n;try{t=decodeURIComponent(n)}catch(u){r=0}i=t;try{i=encodeURIComponent(t)}catch(u){discountNinja.Logging.LogWarning("Could not encode: "+n,!0,!1)}return i}catch(u){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponent - Could not encode: "+n,!0,!1),n}},EncodeUriComponentComponentForQueryString:function(n){try{if(!n)return n;n=n.replace(/\+/g," ");var t=discountNinja_Script_Utilities.EncodeUriComponent(n);return t.replace(/%20/g,"+").replace(/ /g,"+")}catch(r){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponentComponentForQueryString - Could not encode: "+n,!0,!1),n}},GetNumberFromHtmlFragment:function(n){try{return n.match(/\d+/)[0]}catch(t){return n}},GetElementId:function(n){try{if(n==="body")return"body";var t=jQuery(n).attr("id");return t?t:n}catch(i){return n}},IsInViewport:function(n){var t=jQuery(n).offset().top,i=jQuery(n).offset().left,f=t+jQuery(n).outerHeight(),e=i+jQuery(n).outerWidth(),r=jQuery(window).scrollTop(),o=r+jQuery(window).height(),u=jQuery(window).scrollLeft(),s=u+jQuery(window).width();return f>r&&t<o&&i<s&&e>u},IsValidEmailAddress:function(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.toLowerCase())},GetMutationObserver:function(){try{var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return typeof n=="undefined"?discountNinja.Logging.LogWarning("MutationObserver not available, not supporting ListenForDynamicallyAddedElements",!0,!0):n}catch(t){return discountNinja.Logging.LogError("Utilities.GetMutationObserver",t,!0),null}},FormatPercentage:function(n,t){try{return n.toFixed(t)}catch(i){return discountNinja.Logging.LogError("Utilities.FormatPercentage",i,!0),n}},FormatMoney:function(n,t,i,r,u,f){function s(n,t,i,u){var f,e,o;return(i=i||",",u=u||".",isNaN(n)||n===null)?0:(n=(n/100).toFixed(t),f=n.split("."),e=f[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i),t===0?e:(o="",o=r?"<sup>"+(f[1]?f[1]:"")+"<\/sup>":f[1]?u+f[1]:"",e+o))}var o;try{if(n===0&&f===!0)return discountNinja.Settings.Settings.PriceUpdateSettings.FreeLabel;r=r||!1;u=u||!1;typeof n=="string"&&(n=n.replace(".",""));var e="",h=/\{\{\s*(\w+)\s*\}\}/,l=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency+" {{amount}}",c=t||l;switch(c.match(h)[1]){case"amount":e=s(n,2);break;case"amount_no_decimals":e=s(n,0);break;case"amount_with_comma_separator":e=s(n,2,".",",");break;case"amount_no_decimals_with_comma_separator":e=s(n,0,".",",");break;case"amount_no_decimals_with_space_separator":e=s(n,0," ")}return o=c.replace(h,e),u&&(o=o.indexOf("<span")===0?"<span style='text-decoration-line: line-through !important; -webkit-text-decoration-line: line-through !important; text-decoration: line-through !important;' "+o.substr(5):"<span style='text-decoration-line: line-through !important; -webkit-text-decoration-line: line-through !important; text-decoration: line-through !important;'>"+o+"<\/span>"),o}catch(a){return discountNinja.Logging.LogError("Utilities.FormatMoney",a,!0),n}},GetNoDecimalsCurrencyFormat:function(n){try{return n&&(n=n.replace("{{amount}}","{{amount_no_decimals}}"),n=n.replace("{{amount_with_comma_separator}}","{{amount_no_decimals_with_comma_separator}}")),n}catch(t){return discountNinja.Logging.LogError("Utilities.GetNoDecimalsCurrencyFormat",t,!0),""}},GetCurrencyFormatAmountComponent:function(n){try{if(n){var t=n.match(/({{){1}(.)*(}}){1}/);if(t!==null&&t.length>0)return t[0]}return n}catch(i){return discountNinja.Logging.LogError("Utilities.GetCurrencyFormatAmountComponent",i,!0),""}},StringIsIn:function(n,t,i){var o,s,f,e,r,u;try{if(typeof n=="undefined"||n===null||n===""||typeof t=="undefined"||t===null||t==="")return!1;for((i===undefined||i===null)&&(i=","),o=n.split(i),s=t.split(i),f=0;f<o.length;f++)for(e=0;e<s.length;e++)if(r=o[f],u=s[e],typeof r!="undefined"&&r!==null&&r.trim()!==""&&typeof u!="undefined"&&u!==null&&u.trim()!==""&&r.toLowerCase().trim()===u.toLowerCase().trim())return!0;return!1}catch(h){return discountNinja.Logging.LogError("Utilities.StringIsIn",h,!0),!1}},AppendToStyle:function(n,t,i){try{jQuery(n).attr("style",function(n,r){(typeof r!="string"||r===null||r===undefined)&&(r="");r!==""&&r.substr(r.length-1)!==";"&&(r=r+";");var u=new RegExp(t+"([s])*:([^;\n\r])*","g"),f=r.match(u),e=f!==null&&f.length>0;return e?r.replace(u,t+": "+i):r+t+": "+i+";"})}catch(r){discountNinja.Logging.LogError("Utilities.AppendToStyle",r,!0)}},IsMobilePhone:function(){try{var n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}catch(t){return discountNinja.Logging.LogError("Utilities.IsMobilePhone",t,!0),!1}},GetReferrer:function(){try{return document.referrer.indexOf(document.location.hostname)===-1&&discountNinja.Cache.SessionSet("original-referrer",document.referrer),discountNinja.Cache.SessionGet("original-referrer")}catch(n){return discountNinja.Logging.LogError("Utilities.GetReferrer",n,!0),null}},GetEmoji:function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10),56320+(n&1023))):String.fromCharCode(n)}},discountNinja_Script_VariantChange={UnRegisterEventHandlerForVariantChange:function(){try{jQuery("body").find("form").find("select").each(function(){jQuery(this).off("change.discountninja")})}catch(n){discountNinja.Logging.LogError("VariantChange.UnRegisterEventHandlerForVariantChange",n,!0)}},RegisterEventHandlerForVariantChange:function(){function n(){function n(){var t=discountNinja.Cache.SessionGet("last-known-variant"),n=discountNinja.Environment.Shopify.VariantId();t!==n&&(discountNinja.Cache.SessionSet("last-known-variant",n),discountNinja.VariantChangedEvent.Handle(n))}try{setTimeout(function(){n()},500)}catch(t){discountNinja.Logging.LogError("VariantChange.VariantChangeDetected",t,!0)}}try{discountNinja.Logging.LogVerbose("Registering event handler for variant change");discountNinja_Script_VariantChange.UnRegisterEventHandlerForVariantChange();jQuery("body").find("form").find("select").each(function(){jQuery(this).on("change.discountninja",function(){n()})});jQuery(document).on("variantChanged",function(t,i){discountNinja.Logging.LogVerbose("Received variantChanged event for variant: "+i?i.variant?i.variant.id:"":"");n()})}catch(t){discountNinja.Logging.LogError("VariantChange.RegisterEventHandlerForVariantChange",t,!0)}}},discountNinja_Script_XmlHttpRequest={ParseCartAddParameters:function(n,t){function r(n){var t,i;try{return(discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataAsString, parsing "+n),t=null,n.indexOf("id=")>-1&&(t=n.match(/id=(\d)*/)[0].split("=")[1]),i=1,n.indexOf("quantity=")>-1&&(i=n.match(/quantity=(\d)*/)[0].split("=")[1]),t)?{variant:t,quantity:i}:null}catch(r){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataAsString",r,!0),null}}function u(n){try{discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingJson, parsing "+n);var t=JSON.parse(n);return{variant:t.id,quantity:t.quantity}}catch(i){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingJson",i,!0),null}}function f(n){try{return discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingFormDataGetter, parsing "+n),{variant:n.get("id"),quantity:n.get("quantity")}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingFormDataGetter",t,!0),null}}function e(n){try{return typeof n.get=="function"?f(n):n[0]==="{"?u(n):r(n)}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormData",t,!0),null}}function o(n){var i,t,r;try{return(i=typeof n!="undefined"&&n!==undefined&&n!==null,i&&(t=discountNinja.QueryParameter.GetQueryParameters(n),r=typeof t!="undefined"&&t!==undefined&&t!==null&&t.id,r))?{variant:t.id,quantity:t.quantity||1}:(discountNinja.Logging.LogVerbose("ParseCartAddParametersFromUrl could not find id / quantity parameters"),null)}catch(u){return discountNinja.Logging.LogError("ParseCartAddParametersFromUrl",u,!0),null}}var i=o(n)||e(t);return i?discountNinja.Logging.LogVerbose("ParseCartAddParameters found variant: "+i.variant+" quantity: "+i.quantity):discountNinja.Logging.LogWarning("ParseCartAddParameters could not find variant and quantity in url: "+n+" and body "+t),i},HandleFetch:function(n,t){try{discountNinja.Logging.LogVerbose("HandleFetch called "+n);var i=null;try{i=t.body}catch(r){i=null}i?discountNinja_Script_XmlHttpRequest.HandleCartJsonRequest(n,i,!0):discountNinja.Logging.LogVerbose("HandleFetch received data it cannot handle: "+t+" for url "+n)}catch(r){discountNinja.Logging.LogError("XMLHttpRequest.HandleFetch",r,!0)}},HandleSend:function(n){try{if(this.readyState===4){if(this.responseType!=="text"&&this.responseType!==""){discountNinja.Logging.LogVerbose("HandleSend cannot handle response of type "+this.responseType);return}var t=this.responseURL||this._url;discountNinja_Script_XmlHttpRequest.HandleCartJsonRequest(t,n,!1)}}catch(i){discountNinja.Logging.LogError("XMLHttpRequest.HandleSend",i,!0)}},HandleCartJsonRequest:function(n,t){var r,i,u;try{r=typeof n!="undefined"&&n!==undefined&&n!==null;r?n.indexOf("/cart/add")>-1?(discountNinja.Logging.LogVerbose("Handling cart add post"),i=discountNinja_Script_XmlHttpRequest.ParseCartAddParameters(n,t),u=typeof i!="undefined"&&i!==undefined&&i!==null&&i.variant&&i.quantity,u?discountNinja.ServerCartItemsAddedEvent.Handle(i.variant,i.quantity):discountNinja.Logging.LogWarning("Invalid params in HandleCartJsonRequest",!0,!1)):n.indexOf("/cart/change")>-1?(discountNinja.Logging.LogVerbose("Handling cart change post"),discountNinja.ServerCartItemsChangedEvent.Handle()):n.indexOf("/cart/update")>-1&&(discountNinja.Logging.LogVerbose("Handling cart update post"),discountNinja.ServerCartItemsUpdatedEvent.Handle()):discountNinja.Logging.LogWarning("Invalid url in HandleCartJsonRequest",!0,!1)}catch(f){discountNinja.Logging.LogError("XMLHttpRequest.HandleCartJsonRequest",f,!0)}},CreateSendInterceptor:function(n,t,i){return function(r){try{return discountNinja.Logging.LogVerbose("Send interceptor called, executing custom handler"),this.addEventListener(n,t.bind(this,r)),discountNinja.Logging.LogVerbose("Send interceptor execute original request"),i.apply(this,arguments)}catch(u){discountNinja.Logging.LogError("XMLHttpRequest.CreateSendInterceptor",u,!0)}}},CreateFetchInterceptor:function(n,t){return function(){try{discountNinja.Logging.LogVerbose("Registering fetch interceptor");var i=typeof Promise!="undefined"&&Promise.toString().indexOf("[native code]")!==-1;if(i)window.fetch=function(i,r){return discountNinja.Logging.LogVerbose("Fetch interceptor called"),new Promise((u,f)=>{t.apply(this,arguments).then(function(t){discountNinja.Logging.LogVerbose("Original fetch succeeded");u(t);try{discountNinja.Logging.LogVerbose("Calling custom fetch handler");n(i,r)}catch(f){console.error("Error occurred inside promise while handling fetch")}},function(n){discountNinja.Logging.LogVerbose("Original fetch failed: "+n);f(n)})})};else return n.apply(this,arguments),t.apply(this,arguments)}catch(r){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",r,!0)}}},Send:function(n,t,i,r,u,f,e,o,s,h){function l(n,t,i){return n=n===""?"?":n+"&",n+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(t)+"="+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(i)}function v(n,t,r,u,f,e,o,s,h){function v(n){var e,t,r,u,i,o,f;if(n===undefined||n===null)return"";for(e=Object.getOwnPropertyNames(n),t="",r=0;r<e.length;r++)if(u=e[r],i=n[u],typeof i=="string"&&i!==null&&i!=="")for(o=i.split(","),f=0;f<o.length;f++)t=l(t,u,o[f]);else t=l(t,u,i);return t}function y(n){var t=null;try{t=u?n===undefined||n===null?null:JSON.parse(n):n}catch(i){}typeof e=="function"&&e!==null&&e(t)}function p(c){var l="Could not "+r+" data from "+a+" on attempt "+s+". Request status: "+c+" - Parameters: "+JSON.stringify(t);discountNinja.Logging.LogWarning(l,!0,f);setTimeout(function(){discountNinja_Script_XmlHttpRequest.Send(n,t,i,r,u,f,e,o,s+1,h)},500*s)}var w=v(t),a=n+w,c;discountNinja.Logging.LogVerbose("Sending request to "+a+" from SendXMLHttpRequest",!1);c=typeof XMLHttpRequest!="undefined"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open(r,a,!0);c.onreadystatechange=function(){var n;c.readyState===4&&(n=c.status,n===200?y(c.responseText):p(n))};i===null?c.send():(c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(i)))}var c,y,p;try{if((h===undefined||h===null)&&(h=5),(s===undefined||s===null)&&(s=1),s>=h){c="SendHttpRequest failed. Retry iterations ("+h+") exceeded for url "+n;discountNinja.Logging.LogError("XMLHttpRequest.Send",c,f);typeof o=="function"&&o!==null&&o(c);return}v(n,t,r,u,f,e,o,s,h)}catch(a){try{discountNinja.Logging.LogToConsole("error","Error occurred in Send for url "+n+". Error: "+a)}catch(w){y=0}try{typeof o=="function"&&o!==null&&o(a)}catch(b){p=0}}}},discountNinja_Script_VariantChangedEvent={Handle:function(n,t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Variant changed - Variant: "+t);discountNinja.PromotionFlow.StartFlow()}catch(i){discountNinja.Logging.LogError("VariantChangedEvent","Handle failed "+i,!0)}},Subscribe:function(){discountNinja.Events.Subscribe("VariantChanged",discountNinja_Script_VariantChangedEvent.Handle)}},discountNinja_Script_ServerCartItemsAddedEvent={Handle:function(n,t,i){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items added - Variant: "+t+" - Quantity: "+i);discountNinja.Cart.Shopify.OnAddToCart(n,t);discountNinja.Cart.Shopify.IsDirty=!0;discountNinja.DiscountedCart.IsDirty=!0;discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DynamicPricing.ReplacePricesInCart();discountNinja.PromotionFlow.StartFlow()})}catch(r){discountNinja.Logging.LogError("ServerCartItemsAddedEvent","Handle failed "+r,!0)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsAdded",discountNinja_Script_ServerCartItemsAddedEvent.Handle)}},discountNinja_Script_ServerCartItemsUpdatedEvent={Handle:function(){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items updated");discountNinja.Cart.Shopify.IsDirty=!0;discountNinja.DiscountedCart.IsDirty=!0;discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(n){discountNinja.Logging.LogError("ServerCartItemsUpdatedEvent","Handle failed "+n,!0)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsUpdated",discountNinja_Script_ServerCartItemsUpdatedEvent.Handle)}},discountNinja_Script_ServerCartItemsChangedEvent={Handle:function(){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items changed");discountNinja.Cart.Shopify.IsDirty=!0;discountNinja.DiscountedCart.IsDirty=!0;discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(n){discountNinja.Logging.LogError("ServerCartItemsChangedEvent","Handle failed "+n,!0)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsChanged",discountNinja_Script_ServerCartItemsChangedEvent.Handle)}},discountNinja_Script_LocalCartUpdatedEvent={Handle:function(n,t,i,r){try{if(discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated - IsUpdated: "+i+" - Handle using callback: "+r),r)return;i&&discountNinja.DiscountedCart.BuildDiscountedCart(null,!i)}catch(u){discountNinja.Logging.LogError("LocalCartUpdatedEvent","Handle failed "+u,!0)}},Subscribe:function(){discountNinja.Events.Subscribe("LocalCartUpdated",discountNinja_Script_LocalCartUpdatedEvent.Handle)}},discountNinja_Script_Checkout_Shopify={ProcessingCheckout:!1,LoadingCheckoutPopUpId:"LimoniApps-DiscountNinja-Checkout",LoadingCheckoutPopUpMessageId:"LimoniApps-DiscountNinja-Checkout-Message",LoadingCheckoutPopUpDotsId:"LimoniApps-DiscountNinja-Checkout-Dots",ServerUrl:function(){return"https://discountninjav2-draftorderapi-prod.azurewebsites.net"},UnRegisterEventHandlerForCheckout:function(){try{jQuery("body").find("a, button").each(function(){jQuery(this).off("click.discountNinja.checkout");jQuery(this).off("touch.discountNinja.checkout")});jQuery("body").find("form").each(function(){jQuery(this).off("submit.discountNinja.checkout")})}catch(n){discountNinja.Logging.LogError("Checkout.Shopify.UnRegisterEventHandlerForCheckout",n,!0)}},InjectLoadingCheckoutPopUp:function(){function r(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i}var t,n,i;jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId).length===0&&(t=discountNinja.Settings.Settings.CartSettings,n='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId+'" style="display:none;background-color:{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}};" class="limoniapps-popup limoniapps-size-small limoniapps-overlay-5 limoniapps-shape-square limoniapps-align-center limoniapps-content-bottom"><div class="limoniapps-popup-vertical-alignment-helper"><div class="limoniapps-popup-vertical-align-center" style="vertical-align: middle;"><div class="limoniapps-content" style="background-color:{{CHECKOUT_BACKGROUND_COLOR}};display:table;min-height:150px;width:300px;border:none;border-radius: 5px;"><div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId+'" class="limoniapps-body" style="padding-left:20%;padding-right:20%;display:table-cell;vertical-align: middle;"><\/div><\/div><\/div><\/div><\/div>',n=n.replace("{{CHECKOUT_BACKGROUND_COLOR}}",t.CheckoutLoadingBackground||"white"),n=n.replace("{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}}",t.CheckoutLoadingOverlay||"rgba(0,0,0,0.7)"),i=r(n),document.body.insertBefore(i,document.body.childNodes[0]))},RegisterEventHandlerForCheckout:function(){function l(n){return n===null||n.length===0?"":discountNinja.Utilities.EncodeUriComponentComponentForQueryString(n[0])}function a(){var n=null,t=jQuery('form[action="/cart"], form[action^="/cart?"]').attr("action");return t&&(n=discountNinja.QueryParameter.Get("locale",t)),n}function u(){var n="/checkout",t;try{n="/checkout?discount="+l(discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray())}catch(i){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link "+i,!0)}return t=a(),t&&(n=discountNinja.QueryParameter.AppendToUrl(n,"locale",t)),discountNinja.Logging.LogVerbose("Built classic checkout link: "+n),n}function f(n,t){if(t>40||discountNinja_Script_Checkout_Shopify.DiscountCodesReady(discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray())){discountNinja.Logging.LogVerbose("Redirecting to checkout url: "+n);discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1;var r=discountNinja.Settings.Settings.CartSettings;i(r.LoadingCheckoutMessage3);window.location.href=n}else setTimeout(function(){f(n,t+1)},500)}function t(n,t){try{discountNinja.Logging.LogVerbose("Redirecting to standard checkout, reason: "+n);var i=u();s(t);f(i,1)}catch(r){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Failed "+r,!0);window.location.href="/checkout"}}function v(r){try{if(r&&r!==""){discountNinja.Logging.LogVerbose("Redirecting to checkout url: "+r);var u=discountNinja.Settings.Settings.CartSettings;i(u.LoadingCheckoutMessage3);setTimeout(function(){window.location=r},500)}else discountNinja.Logging.LogVerbose("Checkout URL empty"),n=n+1,n<3?h():(discountNinja.Logging.LogVerbose("Attempts to get checkout URL exhausted"),t("No valid checkout url received"))}catch(f){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onSuccess","Could not redirect to new checkout url, attempting to redirect to standard url: "+f,!0);t("Error in processing onSuccess")}}function y(n){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onFailure","Call to DraftOrder Api failed, attempting to redirect to standard url: "+n,!0);t("Call to DraftOrder Api failed")}function e(){if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout){var t=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),n=discountNinja.Settings.Settings.CartSettings;jQuery(t).html()===""?i(n.LoadingCheckoutMessage1):jQuery(t).html()===n.LoadingCheckoutMessage1?i(n.LoadingCheckoutMessage2):jQuery(t).html()===n.LoadingCheckoutMessage2&&i(n.LoadingCheckoutMessage1);setTimeout(function(){e()},2500)}}function o(){if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout){var n=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpDotsId);jQuery(n).text()===""?jQuery(n).text("."):jQuery(n).text()==="."?jQuery(n).text(".."):jQuery(n).text()===".."?jQuery(n).text("..."):jQuery(n).text()==="..."&&jQuery(n).text("");setTimeout(function(){o()},400)}}function p(n,i){try{var r=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId);n&&o();n&&e();n?r.css("display",""):r.css("display","none")}catch(u){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.showLoadingCheckoutPopUp","Could not hide or show Loading Checkout pop-up: "+u,!0);t("Failure in showLoadingCheckoutPopUp",i)}}function i(n){var t=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),i='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpDotsId+'" style="position:absolute;font-size:50px;color:rgba(0,0,0,0.3);bottom:20px;left:130px;"><\/div>';t.html(n+i)}function s(n){try{typeof n!="undefined"&&n&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.returnValue=!1)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.cancelDefaultBehaviorCheckoutButton","Error occurred preventing bubble of event "+t,!0)}}function h(){n<3&&(discountNinja.Logging.LogVerbose("Getting checkout URL, attempt "+n),discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/GetCheckoutUrl",discountNinja_Script_Checkout_Shopify.BuildParameters(),discountNinja_Script_Checkout_Shopify.BuildPayLoad(),"post",!0,!0,v,y,1,3))}function w(i){var r,f;try{if(p(!0,i),discountNinja.Logging.LogVerbose("Checkout triggered"),r=discountNinja_Script_Checkout_Shopify.RequiresDraftOrderCheckout(),!r)return t("No draftorder required",i);s(i);f=u();discountNinja.Logging.LogVerbose("Not redirecting to checkout; fallback would have been "+f+".");setTimeout(function(){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutInner","Timed out, redirecting to standard checkout",!0);t("Timeout",i)},3e4);n=1;h()}catch(e){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutInner","Error occurred in onCheckoutInner "+e,!0);discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}function r(n){try{if(jQuery("input.limoniapps-discountninja-checkout-checkbox:checkbox:not(:checked)").length>0){discountNinja.Logging.LogVerbose("Abandon checkout because required checkbox(es) is not checked");return}if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout)return;discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0;discountNinja.Cart.Shopify.UpdateCart(discountNinja.DiscountedCart.BuildDiscountedCart(w(n)))}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckout","Error occurred in OnCheckout "+t,!0);discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}var n,c;try{n=1;discountNinja.Logging.LogVerbose("Registering event handler for checkout");discountNinja_Script_Checkout_Shopify.UnRegisterEventHandlerForCheckout();jQuery(':submit[name="checkout"], :submit[value="Checkout"], :submit[value="checkout"], :submit[value="CHECKOUT"], :submit[value="CheckOut"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(n){r(n)})});jQuery('a[href^="/checkout"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(n){r(n)})});jQuery('button[onclick*="/checkout"]').not(".limoniapps-discountninja-ignore").each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(n){r(n)})});c=".limoniapps-discountninja-cart-discountcode-apply";jQuery(c).click(function(){var n=jQuery("input.limoniapps-discountninja-cart-discountcode-input"),t=n.val();discountNinja.DiscountCode.AddDiscountCode(t)})}catch(b){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForAddToCart",b,!0)}},DiscountCodesReady:function(n){function i(n){try{var t={};return t.jobId=n,t}catch(i){return discountNinja.Logging.LogError("Checkout.Shopify.DiscountCodesReady..BuildParameters",i,!0),null}}function r(n){try{if(!n)return;discountNinja.Logging.LogVerbose("Retrieved discount code status from server for job: "+n.JobId);discountNinja.Cache.LocalSet("jobstatus-"+n.JobId,n.State)}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.DiscountCodesReady.DiscountCodeStatusReady",t,!0),null}}function u(n){var t,u,f;try{return(t=discountNinja.DiscountCode.GetPromotionForDiscountCode(n),!t)?!0:t.PriceRuleInfo.DiscountCodeSource==="generated"&&(u=t.PriceRuleInfo.JobId,u)?(f=discountNinja.Cache.LocalGet("jobstatus-"+u),f&&f.toLowerCase()==="succeeded")?!0:(discountNinja.Logging.LogVerbose("Getting discount code state from server for discount code: "+n),discountNinja.XmlHttpRequest.Send(discountNinja.Promotion.ServerUrl()+"/api/DiscountCodeStatus",i(u),null,"get",!0,!0,r),!1):!0}catch(e){return discountNinja.Logging.LogError("Checkout.Shopify.DiscountCodesReady.DiscountCodeReady",e,!0),!0}}try{if(!n)return!0;for(var t=0;t<n.length;t++)if(!u(n[t]))return!1;return!0}catch(f){discountNinja.Logging.LogError("Checkout.Shopify.DiscountCodesReady",f,!0)}},RequiresDraftOrderCheckout:function(){function u(){var u,t,n,f,i,r,e,o,s;try{if(u=discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),!u||u.length===0)return!1;for(t=0;t<discountNinja.Promotion.Promotions.length;t++)if(n=discountNinja.Promotion.Promotions[t],n.ExcludeCollectionHandles){for(f=!1,i=0;i<discountNinja.DiscountedCart.DiscountedCart.items.length;i++)if(discountNinja.DiscountedCart.DiscountedCart.items[i].Token===n.Token){f=!0;break}if(f&&window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items)for(r=0;r<window.limoniapps_discountninja_liquid.Cart.items.length;r++)if(e=window.limoniapps_discountninja_liquid.Cart.items[r],e&&(o=e.handle,s=discountNinja.ProductData.GetByProductHandle(o),discountNinja.Utilities.StringIsIn(s.Collections,n.ExcludeCollectionHandles)))return discountNinja.Logging.LogVerbose("Detected excluded product "+o+" for promotion "+n.Token+", using Draft Order checkout"),!0}return!1}catch(h){return discountNinja.Logging.LogVerbose("ActivePromotionRequiresDraftOrder failed "+h),!1}}var i,n,r,t;try{if(discountNinja.Settings===null||discountNinja.Settings.Settings===null)return;if(i=discountNinja.Settings.Settings.CartSettings,n=i.CheckoutMode,n==="standard")return discountNinja.Logging.LogVerbose("Configured to use standard checkout. Redirecting."),!1;if(n==="mixed"){if(r=u(),!r&&(t=discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),!t||t.length<2))return discountNinja.Logging.LogVerbose("Configured to use mixed checkout. Not using draftorder because zero or one discount code were detected."),!1}else n==="draftorder"&&discountNinja.Logging.LogVerbose("Configured to use draft order checkout.");return!0}catch(f){discountNinja.Logging.LogError("Checkout.Shopify.RequiresDraftOrderCheckout",f,!0)}},BuildParameters:function(){try{return{shop:discountNinja.Core.Shop}}catch(n){return discountNinja.Logging.LogError("Checkout.Shopify.BuildParameters",n,!0),null}},BuildPayLoad:function(){function n(){return discountNinja.DiscountCode.GetActiveDiscountCodes()}function t(){var i=[],n=window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items?window.limoniapps_discountninja_liquid.Cart.items:null,t;if(n&&n.length>0)for(t=0;t<n.length;t++)i.push({Quantity:n[t].quantity,VariantId:n[t].variant_id,ProductHandle:n[t].handle,Token:discountNinja.Promotion.GetTokenForProductFromCache(n[t].handle)});return i}function i(){var i=[],n=window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart?window.limoniapps_discountninja_liquid.Cart.attributes:null,t;if(n===null)return null;for(t in n)i.push({Name:t,Value:n[t]})}function r(){try{return{LineItems:t(),DiscountCodes:n(),Attributes:i()}}catch(r){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoad.BuildOrderDetailsJson",r,!0),null}}try{return{shop:discountNinja.Core.Shop,orderDetailsJson:JSON.stringify(r())}}catch(u){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoad",u,!0),null}},PrepareDraftOrder:function(){function n(n){discountNinja.Logging.LogVerbose("Prepared draft order: "+n)}function t(){discountNinja.Logging.LogVerbose("Failed to prepare draft order.")}function i(){discountNinja_Script_Checkout_Shopify.RequiresDraftOrderCheckout()?(discountNinja.Logging.LogVerbose("Preparing draft order"),discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/PrepareCheckoutUrl",discountNinja_Script_Checkout_Shopify.BuildParameters(),discountNinja_Script_Checkout_Shopify.BuildPayLoad(),"post",!0,!0,n,t,1,2)):discountNinja.Logging.LogVerbose("Draft order not required")}try{discountNinja.Cart.Shopify.UpdateCart(discountNinja.DiscountedCart.BuildDiscountedCart(i))}catch(r){discountNinja.Logging.LogError("Checkout.Shopify.PrepareDraftOrder",r,!0)}}},discountNinja_Script_Environment_Shopify={MyShopifyDomain:function(){var n="",t;try{n=Shopify.shop}catch(i){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain while reading Shopify.shop",i,!0)}try{return(n===undefined||n===null||n==="")&&(t="undefined",typeof Shopify!="undefined"&&Shopify!==undefined&&(t=JSON.stringify(Shopify)),n=window.top.location.hostname,discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain could not retrieve domain from Shopify.shop property. Shopify object is "+t+". Falling back to URL hostname ("+n+").",!0)),n}catch(i){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain while reading Shopify.shop",i,!0)}},UrlPath:function(){try{var n=discountNinja_Script_Environment_Shopify.TrimmedPathName();return n.toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.UrlPath",t,!0),""}},IsCartPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath()==="/cart"},IsProductPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/products/")>-1},IsCollectionPage:function(){var n=discountNinja_Script_Environment_Shopify.UrlPath();return n==="/collections"||n.indexOf("/products/")===-1&&n.indexOf("/collections/")>-1},IsHomePage:function(){var n=discountNinja_Script_Environment_Shopify.UrlPath();return n===""||n==="/"},IsBlogPost:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/blogs/")>-1},IsCustomPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/pages/")>-1},BlogHandle:function(){var n,i,t,r;try{return(n=discountNinja_Script_Environment_Shopify.TrimmedPathName(),i=n.indexOf("/blogs/"),i===-1)?null:(t=n.indexOf("/",i+1),t===-1)?null:(r=n.indexOf("/",t+1),r===-1?decodeURIComponent(n).substr(t+1):decodeURIComponent(n).substr(t+1,r-t-1))}catch(u){return discountNinja.Logging.LogError("Environment.Shopify.BlogHandle",u,!0),null}},BlogPostHandle:function(){var n,t,i,r;try{return(n=discountNinja_Script_Environment_Shopify.TrimmedPathName(),t=n.indexOf("/blogs/"),t===-1)?null:(i=n.indexOf("/",t+1),i===-1)?null:(r=n.indexOf("/",i+1),r===-1)?null:decodeURIComponent(n).substr(r+1)}catch(u){return discountNinja.Logging.LogError("Environment.Shopify.BlogPostHandle",u,!0),null}},CollectionHandle:function(){var n,i,t;try{return(n=discountNinja_Script_Environment_Shopify.UrlPath(),i=n.indexOf("/collections/"),i<0)?"":(n=n.replace("/collections/",""),t=n.indexOf("/"),t<0?n:n.substr(0,t))}catch(r){return discountNinja.Logging.LogError("Environment.Shopify.CollectionHandle",r,!0),""}},PageType:function(){if(discountNinja_Script_Environment_Shopify.IsProductPage())return"product";if(discountNinja_Script_Environment_Shopify.IsCollectionPage())return"collection";if(discountNinja_Script_Environment_Shopify.IsHomePage())return"home";if(discountNinja_Script_Environment_Shopify.IsCartPage())return"cart";if(discountNinja_Script_Environment_Shopify.IsBlogPost())return"blogpost";if(discountNinja_Script_Environment_Shopify.IsCustomPage())return"custom";"unknown"},VariantId:function(){function u(){return discountNinja.QueryParameter.Get("variant")}var n,t,i,r;if(!discountNinja_Script_Environment_Shopify.IsProductPage())return null;try{if(n=document.querySelector("form [name^='id']"),t=null,n!==null&&typeof n.options=="object"&&typeof n.selectedIndex=="number"&&n.options[n.selectedIndex]!==undefined?t=n.options[n.selectedIndex].value:n!==null&&typeof n.value=="string"&&(t=n.value),t!==undefined&&t!==null&&t!==""&&t!==0&&!isNaN(t))return discountNinja.Logging.LogVerbose("Returning variant from form: "+t),discountNinja.Utilities.GetNumberFromHtmlFragment(t)}catch(n){discountNinja.Logging.LogError("Environment.Shopify.VariantId",n,!1)}try{if(i=u(),i!==undefined&&i!==null&&i!=="")return discountNinja.Logging.LogVerbose("Returning variant from query parameter: "+i),i}catch(n){discountNinja.Logging.LogError("Environment.Shopify.VariantId",n,!1)}try{if(r=discountNinja.LiquidData.ProductDefaultVariantId(),r!==undefined&&r!==null&&r!=="")return discountNinja.Logging.LogVerbose("Returning variant from liquid: "+r),r}catch(n){discountNinja.Logging.LogError("Environment.Shopify.VariantId",n,!1)}return discountNinja.Logging.LogError("Environment.Shopify.VariantId","No variant information found",!1),null},TrimmedPathName:function(){var n,t;try{return(n=window.location.pathname,n===null||n==="")?n:(t=n.slice(-1),t==="/"&&(n=n.substr(0,n.length-1)),n)}catch(i){return discountNinja.Logging.LogError("Environment.Shopify.GetLastPartOfPathName",i,!0),null}},ProductHandle:function(){try{var n=discountNinja_Script_Environment_Shopify.TrimmedPathName();return n.indexOf("/products/")===-1?null:decodeURIComponent(n).substr(n.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.ProductHandle",t,!0),null}},CustomPageHandle:function(){try{var n=discountNinja_Script_Environment_Shopify.TrimmedPathName();return n.indexOf("/pages/")===-1?null:decodeURIComponent(n).substr(n.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CustomPageHandle",t,!0),null}},IsCustomer:function(){return typeof limoniapps_discountninja_liquid!="undefined"&&window.limoniapps_discountninja_liquid.Customer!==null},CustomerTags:function(){return window.limoniapps_discountninja_liquid.Customer!==null&&window.limoniapps_discountninja_liquid.Customer.Tags!==null?window.limoniapps_discountninja_liquid.Customer.Tags:null}},discountNinja_Script_DiscountCode={ServerUrl:function(){return"https://discountninjav2-draftorderapi-prod.azurewebsites.net"},InjectDiscountCodesInHtmlElements:function(n,t){function i(n,t){try{var i=discountNinja.QueryParameter.RemoveFromUrl(n,"discount",t);return i.replace(/attributes\[limoniapps\-discounturl\]\=(.)*(\&)?/g,"")}catch(r){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodeInUrl",r,!0)}}function r(n,t){try{return discountNinja.QueryParameter.AppendToUrl(n,"discount",t,!0)}catch(i){discountNinja.Logging.LogError("DiscountCode.AppendDiscountCodeToUrl",i,!0)}}try{jQuery('a[href^="/checkout"]').each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var u=jQuery(this).attr("href"),f=t?i(u,n):r(u,n);jQuery(this).attr("href",f)}});jQuery('form[action^="/checkout"]').each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var u=jQuery(this).attr("action"),f=t?i(u,n):r(u,n);jQuery(this).attr("action",f)}});jQuery('button[onclick*="/checkout"]').each(function(){var o,u,f,s,e,h;try{if(jQuery(this).hasClass("discountninja-ignore"))return;o=jQuery(this).attr("onclick");u=o.match(/(['"]){1}(.)*(['"])/g);u!==null&&u.length===1&&(f=u[0],s=f.length,s>2&&(e=f.substr(1,f.length-2),h=t?i(e,n):r(e,n),jQuery(this).attr("onclick",o.replace(e,h))))}catch(c){}});jQuery('form[action="/cart"], form[action^="/cart?"]').each(function(){var u,f,e;jQuery(this).hasClass("discountninja-ignore")||(u=jQuery(this).attr("method"),u&&u.toLowerCase()==="post"&&(f=jQuery(this).attr("action"),e=t?i(f,n):r(f,n),jQuery(this).attr("action",e)))});jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")}catch(u){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtmlElements",u,!0)}},UndoInjectDiscountCodesInHtml:function(){var n,t;try{if(n=discountNinja.Promotion.Promotions,!n)return;for(t=0;t<n.length;t++)discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(discountNinja_Script_DiscountCode.GetDiscountCode(n[t].Token),!0)}catch(i){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodesInHtml",i,!0)}},InjectDiscountCodesInHtml:function(){function t(n){var t,i;try{t=jQuery('form[action^="/checkout"]');t!==null&&t.length>0&&(i=0,t.each(function(){if(!jQuery(this).hasClass("discountninja-ignore")){var n=jQuery(this).find('input[name="discount"]');(n===null||n.length===0)&&(jQuery("<input>").attr("type","hidden").attr("name","discount").addClass("limoniapps-discountninja-discount-attribute").attr("id","limoniapps-discountninja-discount-attribute-"+i).appendTo(this),i++)}}));jQuery('form[action^="/checkout"], form[action^="/cart"] input[name="discount"], .limoniapps-discountninja-discount-attribute').each(function(){jQuery(this).hasClass("discountninja-ignore")||jQuery(this).attr("value",n)})}catch(r){discountNinja.Logging.LogError("UpdateFormInputDiscountCode",r,!0)}}try{var n=discountNinja_Script_DiscountCode.GetActiveDiscountCodesForCheckoutAsString();if(n==="")return;discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(n,!1);t(n);discountNinja.Logging.ShowTimeElapsed("Inject discount code in HTML complete")}catch(i){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtml",i,!0)}},GetFromCache:function(){try{var n=discountNinja.Cache.SessionGet("discountcode-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFromCache",t,!0),[]}},SaveToCache:function(n){try{discountNinja.Cache.SessionSet("discountcode-data",JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveToCache",t,!0)}},GetExternalDiscountCodesFromCache:function(){try{var n=discountNinja.Cache.SessionGet("discountcode-external-data");return n=n==="undefined"?[]:JSON.parse(n),n===null?[]:n}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetExternalDiscountCodesFromCache",t,!0),[]}},AddDiscountCode:function(n){function o(n,t,i){function f(n){try{discountNinja.Cache.SessionSet("discountcode-external-data",JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveExternalDiscountCodesToCache",t,!0)}}try{t===null&&discountNinja.Logging.LogWarning("DiscountCode.AddExternal - No discountcode provided",!0,!1,!1);for(var r=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache(),u=r.length;u--;)r[u]&&r[u].DiscountCode===t&&r.splice(u,1);r.push({Token:null,DiscountCode:t,PriceRuleId:n,TargetType:i});discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml();f(r)}catch(e){discountNinja.Logging.LogError("DiscountCode.AddExternal",e,!0)}}var i=".limoniapps-discountninja-cart-discountcode-searching",f=".limoniapps-discountninja-cart-discountcode-applied",r=".limoniapps-discountninja-cart-discountcode-notfound",t=jQuery("input.limoniapps-discountninja-cart-discountcode-input"),u=jQuery(".limoniapps-discountninja-cart-discountcode-apply"),e;try{if(!n||n==="")return;t.prop("disabled",!0);u.prop("disabled",!0);jQuery(i).show();jQuery(f).hide();jQuery(r).hide();e=discountNinja_Script_DiscountCode.ServerUrl()+"/api/GetDiscountDetails?shop="+discountNinja.Core.Shop+"&discountCode="+n;discountNinja.XmlHttpRequest.Send(e,null,null,"get",!0,!0,function(n){jQuery(i).hide();t.prop("disabled",!1);u.prop("disabled",!1);t.val("");n?(o(n.PriceRuleId,n.DiscountCode,n.TargetType),jQuery(f).show()):jQuery(r).show()},function(){t.prop("disabled",!1);u.prop("disabled",!1);jQuery(i).hide();jQuery(r).show()})}catch(s){discountNinja.Logging.LogError("DiscountCode.AddExternalDiscountCode",s,!0);t.prop("disabled",!1);u.prop("disabled",!1);jQuery(i).hide();jQuery(r).show()}},Add:function(n,t,i,r){try{(t===null||i===null)&&discountNinja.Logging.LogWarning("DiscountCode.Add - No discountcode or priceruleid available",!0,!1,!1);for(var u=discountNinja_Script_DiscountCode.GetFromCache(),f=u.length;f--;)u[f]&&u[f].Token===n&&u.splice(f,1);u.push({Token:n,DiscountCode:t,PriceRuleId:i,TargetType:r});discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml();discountNinja_Script_DiscountCode.SaveToCache(u)}catch(e){discountNinja.Logging.LogError("DiscountCode.Add",e,!0)}},Remove:function(n){var i,r,t;try{for(i=discountNinja_Script_DiscountCode.GetFromCache(),r=[],t=0;t<i.length;t++)i[t].Token!==n&&r.push(i[t]);discountNinja_Script_DiscountCode.SaveToCache(r)}catch(u){discountNinja.Logging.LogError("DiscountCode.Remove",u,!0)}},Clear:function(){discountNinja.Cache.SessionRemove("discountcode-data")},GetActiveDiscountCodesForCheckoutAsArray:function(){var t,i,n;try{for(t=discountNinja_Script_DiscountCode.GetActiveDiscountCodes(),i=[],n=0;n<t.length;n++)i.push(t[n].DiscountCode);return i}catch(r){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodesForCheckoutAsArray",r,!0),[]}},GetActiveDiscountCodes:function(){var o,n,s,i,e,h,c,f,l,w,b,y,a,v,r,t,p,u;try{for(o=discountNinja_Script_DiscountCode.GetFromCache(),discountNinja.Logging.LogVerbose(o.length+" codes found in cache"),n=[],s=0;s<o.length;s++)if(i=o[s],i!==null&&i.DiscountCode!=="")if(i.TargetType==="line_item"){if(e=discountNinja.DiscountedCart.DiscountedCart,e&&e.items.length>0)for(h=0;h<e.items.length;h++)if(e.items[h].Token===i.Token){discountNinja.Logging.LogVerbose("Discount code added to active list for token "+i.Token);n.push(i);break}}else discountNinja.Logging.LogVerbose("Shipping code added to active list"),n.push(i);if(discountNinja.Promotion.Promotions)for(c=0;c<discountNinja.Promotion.Promotions.length;c++)f=discountNinja.Promotion.Promotions[c],f.PriceRuleInfo.TargetType==="line_item"&&f.PriceRuleInfo.AllocationMethod==="across"&&(l=discountNinja.DiscountLevel.GetCurrentDiscountLevel(f),l&&(w=l.DiscountCode,b=l.PriceRuleId,n.push({Token:f.Token,DiscountCode:w,PriceRuleId:b,TargetType:f.PriceRuleInfo.TargetType})));if(y=discountNinja.Cookie.GetDiscountCodeCookie(),y&&(discountNinja.Logging.LogVerbose("Native shareable link code added to active list"),n.push({Token:null,DiscountCode:y,PriceRuleId:null,TargetType:null})),a=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache(),a)for(v=0;v<a.length;v++)discountNinja.Logging.LogVerbose("External code added to active list"),n.push(a[v]);for(r=[],t=0;t<n.length;t++)if(p=!0,n[t]&&n[t].DiscountCode){for(u=0;u<r.length;u++)if(r[u].DiscountCode===n[t].DiscountCode){r[u].Token===null&&n[t].Token;r[u].PriceRuleId===null&&n[t].PriceRuleId;r[u].TargetType===null&&n[t].TargetType;p=!1;break}p&&r.push(n[t])}return r}catch(k){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodes",k,!0),[]}},GetActiveDiscountCodesForCheckoutAsString:function(){try{var n=discountNinja_Script_DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),t=n.length===0?"":n.join(",");return discountNinja.Utilities.EncodeUriComponentComponentForQueryString(t)}catch(i){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodesForCheckoutAsString",i,!0),""}},GetActiveLineItemDiscountCodes:function(){var r,t,i,n;try{for(r=discountNinja_Script_DiscountCode.GetFromCache(),t=[],i=0;i<r.length;i++)n=r[i],n!==null&&n.DiscountCode!==""&&n.TargetType==="line_item"&&t.push(n.DiscountCode);return t.length===0?"":t.join(",")}catch(u){return discountNinja.Logging.LogError("DiscountCode.GetActiveLineItemDiscountCodes",u,!0),""}},GetDiscountCode:function(n){var i,t;try{for(i=discountNinja_Script_DiscountCode.GetFromCache(),t=0;t<i.length;t++)if(i[t].Token===n)return i[t].DiscountCode;return null}catch(r){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCode",r,!0),null}},GetPromotionForDiscountCode:function(n){var i,t;try{for(i=discountNinja.Promotion.Promotions,t=0;t<i.length;t++)if(i[t].PriceRuleInfo.DiscountLevel1&&i[t].PriceRuleInfo.DiscountLevel1.DiscountCode===n||i[t].PriceRuleInfo.DiscountLevel2&&i[t].PriceRuleInfo.DiscountLevel2.DiscountCode===n||i[t].PriceRuleInfo.DiscountLevel2&&i[t].PriceRuleInfo.DiscountLevel3.DiscountCode===n)return i[t];return null}catch(r){return discountNinja.Logging.LogError("DiscountCode.GetPromotionForDiscountCode",r,!0),null}}},discountNinja_Script_DiscountedCart={IsDirty:!0,DiscountedCart:null,BuildDiscountedCart:function(n){function c(n){try{discountNinja.Cache.LocalSet("discounted-cart",JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveDiscountedCartToCache",t,!0)}}function l(n){var t,i,r,u,f;try{if(!n)return;if(t=n.items,!t)return;for(i=0;i<t.length;i++)r=discountNinja.Promotion.GetTokenForProductFromCache(t[i].ProductHandle),r||(u=discountNinja.ProductData.GetByProductHandle(t[i].ProductHandle,!0),f=discountNinja.Promotion.GetPromotionForProduct(t[i].ProductHandle,u.Collections,u.Inventory,u.Price),f&&discountNinja.Promotion.SetTokenForProductInCache(t[i].ProductHandle,f.Token),r=discountNinja.Promotion.GetTokenForProductFromCache(t[i].ProductHandle)),t[i].Token=r}catch(e){discountNinja.Logging.LogError("DiscountedCart.EnsureTokensForCartProducts",e,!0)}}function a(n,t,i,r,u,f,e,o){var c,l,s,a,h;try{if(discountNinja.Logging.LogVerbose("Evaluating if item with variantid "+t+" and handle "+i+" must be added to discounted cart"),c=null,l=discountNinja.Promotion.GetPromotionForProduct(i,o,f,r),l&&(c=l.PriceRuleInfo),c&&c.TargetType!=="shipping_line"){for(discountNinja.Logging.LogVerbose("Adding item with variantid "+t+" and handle "+i+" to discounted cart"),s=discountNinja.DiscountedProduct.Get(t,i,r,u,f,l),a=-1,h=0;h<n.items.length;h++)if(n.items[h].VariantId===t){a=h;break}a===-1?(discountNinja.Logging.LogVerbose("Adding line in discounted cart"),n.items.push(s)):(discountNinja.Logging.LogVerbose("Updating line discounted cart"),n[a]=s);discountedPrice=s.DiscountedPrice;n.total_discounted_price+=discountedPrice;n.total_discount+=s.Amount*e}else n.total_discounted_price+=r*e;return n}catch(v){return discountNinja.Logging.LogError("DiscountedCart.AddDiscountedCartItem",v,!0),n}}var s,i,r,t,u,e,o,h,f;try{if(discountNinja.Logging.LogVerbose("Building discounted cart - START"),!discountNinja_Script_DiscountedCart.IsDirty)return discountNinja.Logging.LogVerbose("Building discounted cart - Assumed not dirty"),n!==undefined&&n!==null&&typeof n=="function"?n():null;if(s=discountNinja.Promotion.Promotions,s&&s.length!==0)if(discountNinja.Logging.LogVerbose("Building discounted cart - Promotions available, continuing"),i=window.limoniapps_discountninja_liquid.Cart,i!==undefined&&i.items!==undefined){for(r={items:[],total_discounted_price:0,total_discount:0},r.total_discounted_price=0,r.total_discount=0,t=0;t<i.items.length;t++)discountNinja.Logging.LogVerbose("Building discounted cart - Evaluating cart item "+t),u=discountNinja.ProductData.GetByProductHandle(i.items[t].handle,!0),u?(discountNinja.Logging.LogVerbose("Building discounted cart - Promotion data found for cart item "+t+" with variant id "+i.items[t].variant_id+" and handle "+i.items[t].handle),r=a(r,i.items[t].variant_id,i.items[t].handle,i.items[t].price/100,u.CompareAtPrice,u.Inventory,i.items[t].quantity,u.Collections)):discountNinja.Logging.LogVerbose("Building discounted cart - No promotion data found for cart item "+t+" with variant id "+i.items[t].variant_id+" and handle "+i.items[t].handle);if(discountNinja.Promotion.Promotions)for(e=0;e<discountNinja.Promotion.Promotions.length;e++)o=discountNinja.Promotion.Promotions[e],o.PriceRuleInfo.TargetType==="line_item"&&o.PriceRuleInfo.AllocationMethod==="across"&&(h=discountNinja.DiscountLevel.GetCurrentDiscountLevel(o),h&&(f=h.Amount,r.total_discounted_price<f&&(f=r.total_discounted_price),r.total_discounted_price-=f,r.total_discount+=f));l(r);c(r);discountNinja_Script_DiscountedCart.DiscountedCart=r}else discountNinja.Logging.LogVerbose("Building discounted cart - Cart empty, aborting");else discountNinja.Logging.LogVerbose("Building discounted cart - Promotions unavailable, aborting");return discountNinja_Script_DiscountedCart.IsDirty=!1,n!==undefined&&n!==null&&typeof n=="function"?n():null}catch(v){discountNinja.Logging.LogError("DiscountedCart.BuildDiscountedCart",v,!0)}n!==undefined&&n!==null&&typeof n=="function"&&n()},GetCartVariantIds:function(){function i(){try{var n=discountNinja.Cache.LocalGet("discounted-cart");return n==="undefined"?null:JSON.parse(n)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedCartFromCache",t,!0),null}}var n,t;try{if(discountNinja_Script_DiscountedCart.DiscountedCart=i(),discountNinja_Script_DiscountedCart.DiscountedCart&&discountNinja_Script_DiscountedCart.DiscountedCart.items){for(n="",t=0;t<discountNinja_Script_DiscountedCart.DiscountedCart.items.length;t++)n!==""&&(n=n+","),n=n+discountNinja_Script_DiscountedCart.DiscountedCart.items[t].VariantId;return n}return""}catch(r){discountNinja.Logging.LogError("DiscountedCart.GetCartVariantIds",r,!0)}},CartValue:function(n){var u,h,o,c;try{if(discountNinja.Logging.LogVerbose("Calculating cart value for products in promotion "+n.Token),!window.limoniapps_discountninja_liquid||!window.limoniapps_discountninja_liquid.Cart||!window.limoniapps_discountninja_liquid.Cart.items||window.limoniapps_discountninja_liquid.Cart.items.length===0)return 0;if(n.TargetType==="site")return discountNinja.Logging.LogVerbose("Returning full cart value"),discountNinja.LiquidData.CartValue();var i=0,f=n.TargetCollectionHandles,r=n.PriceRuleInfo.TargetProductHandles;for(u=0;u<window.limoniapps_discountninja_liquid.Cart.items.length;u++){var e=window.limoniapps_discountninja_liquid.Cart.items[u],t=e.handle,s=e.original_price*e.quantity;discountNinja.Logging.LogVerbose("Evaluating product: "+t);n.TargetType==="product"?(h=r==="*"||discountNinja.Utilities.StringIsIn(t,r),h?(discountNinja.Logging.LogVerbose("Product: "+t+" in list of products: "+r),i=i+s):discountNinja.Logging.LogVerbose("Product: "+t+" not in list of products: "+r)):n.TargetType==="collection"&&(o=discountNinja.ProductData.GetByProductHandle(t),o!==null?(c=discountNinja.Utilities.StringIsIn(o.Collections,f),c?(discountNinja.Logging.LogVerbose("Product: "+t+" in in list of collections: "+f),i=i+s):discountNinja.Logging.LogVerbose("Product: "+t+" not in in list of collections: "+f)):discountNinja.Logging.LogVerbose("No product data available for product: "+t))}return discountNinja.Logging.LogVerbose("Cart value for promotion "+n.Token+" is "+i),i}catch(l){return discountNinja.Logging.LogError("DiscountedCart.CartValue",l,!0),0}}},discountNinja_Script_DiscountedProduct={Get:function(n,t,i,r,u,f){var h,o,s;try{if(h=discountNinja.DiscountLevel.GetCurrentDiscountLevel(f),h===null)return null;var c=f.PriceRuleInfo,l=c.ValueType,a=c.DiscountPriceType,v=h.Amount,y=h.Percentage,p=discountNinja.Settings.Settings.CurrencySettings.RoundPrices,w=discountNinja.Settings.Settings.CurrencySettings.RoundToCents,e={VariantId:n,ProductHandle:t,OriginalPrice:i,OriginalCompareAtPrice:r,Amount:v,Percentage:y};return(e.OriginalCompareAtPrice===undefined||e.OriginalCompareAtPrice===null||e.OriginalCompareAtPrice===0||isNaN(e.OriginalCompareAtPrice)||e.OriginalCompareAtPrice<e.OriginalPrice)&&(e.OriginalCompareAtPrice=e.OriginalPrice),e.EffectiveCompareAtPrice=e.OriginalCompareAtPrice,a==="price"&&(e.EffectiveCompareAtPrice=e.OriginalPrice),o=e.EffectiveCompareAtPrice,o>0?(l==="fixed_amount"?(e.DiscountedPrice=o-e.Amount,e.Percentage=o===0?0:Math.abs(e.Amount/o*100)):l==="percentage"&&(e.DiscountedPrice=parseFloat((o-Math.floor(o*e.Percentage)/100).toFixed(4)),e.Amount=o-e.DiscountedPrice),e.DiscountedPrice<0&&(e.DiscountedPrice=0),e.DiscountedPriceRaw=e.DiscountedPrice,p&&(s=e.DiscountedPrice*100,s>0&&(s=Math.floor(s/100)*100+w),e.DiscountedPrice=Math.round(s)/100)):(e.DiscountedPrice=0,e.DiscountedPriceRaw=e.DiscountedPrice),e.DiscountedPrice=Math.round(e.DiscountedPrice*100)/100,e.InventoryLeft=u,e.Token=discountNinja.Promotion.GetTokenForProductFromCache(t),e.DiscountCode=discountNinja.DiscountCode.GetDiscountCode(e.Token),e}catch(b){return discountNinja.Logging.LogError("DiscountedProduct.Get",b,!0),null}},GetFromProductPage:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){var i=discountNinja.Environment.Shopify.ProductHandle(),n=discountNinja.Environment.Shopify.VariantId(),r=discountNinja.LiquidData.Price(n),f=discountNinja.LiquidData.CompareAtPrice(n),u=discountNinja.LiquidData.Inventory(n),t=discountNinja.Promotion.GetPromotionForProduct(i,null,u,r);return!t||!t.PriceRuleInfo?null:discountNinja_Script_DiscountedProduct.Get(n,i,r,f,u,t)}return null}catch(e){discountNinja.Logging.LogError("DiscountedProduct.GetFromProductPage",e,!0)}}},discountNinja_Script_DiscountLevel={GetPromotionDiscountLevelAmount:function(n){return n?n.DiscountLevel1.Amount:0},GetPromotionDiscountLevelPercentage:function(n){return n?n.DiscountLevel1.Percentage:0},GetCurrentDiscountLevelNumber:function(n,t){function i(n,t,i){var r,u;try{return!t||!n?!1:n.CartRuleSettings.MinimumAmount&&i<n.CartRuleSettings.MinimumAmount?!1:n.CartRuleSettings.MaximumAmount&&i>n.CartRuleSettings.MaximumAmount?!1:n.CartRuleSettings.MinimumItems>0&&(r=discountNinja.LiquidData.ItemsInCartFromCollections(discountNinja.Promotion.PrimaryPromotion.CartRuleSettings.MinimumItemCollections),r<n.CartRuleSettings.MinimumItems)?!1:n.CartRuleSettings.MaximumItems>0&&(u=discountNinja.LiquidData.ItemsInCartFromCollections(discountNinja.Promotion.PrimaryPromotion.CartRuleSettings.MaximumItemCollections),u>n.CartRuleSettings.MaximumItems)?!1:t.CartValueMinimum&&t.CartValueMinimum*100>i?!1:!0}catch(f){return discountNinja.Logging.LogError("DiscountLevel.DiscountLevelIsApplicable",f,!0),!1}}try{if(!discountNinja.Promotion.PromotionIsApplicable(n))return null;var r=n.PriceRuleInfo,u=i(n,r.DiscountLevel1,t),f=i(n,r.DiscountLevel2,t),e=i(n,r.DiscountLevel3,t),o=i(n,r.DiscountLevel4,t),s=i(n,r.DiscountLevel5,t);return s?5:o?4:e?3:f?2:u?1:t>0?0:-1}catch(h){return discountNinja.Logging.LogError("DiscountLevel.GetCurrentDiscountLevelNumber",h,!0),-1}},GetMaxDiscountLevelNumber:function(n){try{return typeof n.DiscountLevel5=="object"?5:typeof n.DiscountLevel4=="object"?4:typeof n.DiscountLevel3=="object"?3:typeof n.DiscountLevel2=="object"?2:1}catch(t){return discountNinja.Logging.LogError("DiscountLevel.GetMaxDiscountLevelNumber",t,!0),1}},GetCurrentDiscountLevel:function(n){var r,t,i;try{return(r=discountNinja.DiscountedCart.CartValue(n),t=discountNinja_Script_DiscountLevel.GetCurrentDiscountLevelNumber(n,r),t===null)?null:(i=n.PriceRuleInfo,t===5)?i.DiscountLevel5:t===4?i.DiscountLevel4:t===3?i.DiscountLevel3:t===2?i.DiscountLevel2:t===1?i.DiscountLevel1:null}catch(u){return discountNinja.Logging.LogError("DiscountLevel.GetCurrentDiscountLevel",u,!0),null}},GetGoalDiscountLevelNumber:function(n){var r,t,u,i;try{return(r=discountNinja.DiscountedCart.CartValue(n),t=discountNinja_Script_DiscountLevel.GetCurrentDiscountLevelNumber(n,r),t===null)?null:(u=n.PriceRuleInfo,i=discountNinja_Script_DiscountLevel.GetMaxDiscountLevelNumber(u),t===5)?-1:t===4?i<=4?-1:5:t===3?i<=3?-1:4:t===2?i<=2?-1:3:t===1?i<=1?-1:2:1}catch(f){return discountNinja.Logging.LogError("DiscountLevel.GetGoalDiscountLevel",f,!0),null}},GetGoalDiscountLevel:function(n){var t,i;try{return(t=discountNinja_Script_DiscountLevel.GetGoalDiscountLevelNumber(n),t===null||t===-1)?null:(i=n.PriceRuleInfo,t===5)?i.DiscountLevel5:t===4?i.DiscountLevel4:t===3?i.DiscountLevel3:t===2?i.DiscountLevel2:t===1?i.DiscountLevel1:null}catch(r){return discountNinja.Logging.LogError("DiscountLevel.GetGoalDiscountLevel",r,!0),null}},GetPercentageAmountFromDiscountLevel:function(n){try{return n?{Percentage:n.Percentage,Amount:n.Amount}:null}catch(t){discountNinja.Logging.LogError("DiscountedProduct.GetPercentageAmountFromDiscountLevel",t,!0)}},GoalAchieved:function(n){try{var i=discountNinja.DiscountedCart.CartValue(n),t=discountNinja_Script_DiscountLevel.GetCurrentDiscountLevelNumber(n,i);return t===null?!1:t>0}catch(r){return discountNinja.Logging.LogError("DiscountLevel.GoalAchieved",r,!0),!1}}},discountNinja_Script_DynamicPricing={ReplacingPricesInCart:!1,UpdatePrice:function(){function t(n){var t,i,r;try{return t=!1,discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(n,!1)?(discountNinja.Logging.LogInformation("FLOW: Updating price"),jQuery(".rc_price__onetime").addClass("limoniapps-discountninja-productprice"),i=jQuery(".limoniapps-discount-url-productprice,.limoniapps-discountninja-productprice"),i.length>0&&(discountNinja.Logging.LogVerbose("Replacing product price"),i.each(function(n,i){var r=h(i);r&&(t=!0)})),r=jQuery(".limoniapps-discountninja-variantprice"),r.length>0&&(discountNinja.Logging.LogVerbose("Replacing variant price"),r.each(function(n,i){var r=o(i);r&&(t=!0)}))):discountNinja.Logging.LogInformation("FLOW: Not updating price",!0,!1),discountNinja_Script_DynamicPricing.ReplacePricesInCart(),discountNinja_Script_DynamicPricing.Show(t),!0}catch(u){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",u,!0)}}function e(n,t){try{var i=jQuery(n).attr("data-limoniapps-discountninja-"+t);return i||(i=jQuery(n).attr("data-limoniapps-discounturl-"+t)),i}catch(r){discountNinja.Logging.LogError("DynamicPricing.GetDataFromCollectionAttribute",r,!0)}}function i(n,t){var i,r;try{i=jQuery(".afterpay-instalments,.afterpay_instalments,#afterpay-instalments,#afterpay_instalments");i&&i.length>0&&(discountNinja.Logging.LogVerbose("Replacing AfterPay instalments amount"),r=discountNinja.ShortCode.ReplaceAllPlaceHolders(n,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}",t),jQuery(i).html(r))}catch(u){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",u,!0),!1}}function o(n){var u,e,t,c,o,l;try{if(u=0,e=0,!discountNinja.Environment.Shopify.IsProductPage()){discountNinja.Logging.LogVerbose("Dynamic Pricing for variants only supported on product page");return}var s=discountNinja.Environment.Shopify.ProductHandle(),h=null,f=jQuery(n).attr("data-limoniapps-discountninja-variantid");if(f)u=discountNinja.LiquidData.Price(f),e=discountNinja.LiquidData.CompareAtPrice(f),h=discountNinja.LiquidData.Inventory(f),discountNinja.Logging.LogVerbose("Loading pricing for variant "+f+": price "+u+", compare at:"+e);else{discountNinja.Logging.LogVerbose("No product variant found for this element");return}return(t=discountNinja.Promotion.GetPromotionForProduct(s,null,h,u),!t)?(discountNinja.Logging.LogVerbose("The price will not be updated for the product with handle '"+s+"' since the product is not a target of the promotion(s)."),!1):(c=discountNinja.DiscountLevel.GetCurrentDiscountLevel(t),o=discountNinja.DiscountedProduct.Get(null,s,u,e,h,t,c),discountNinja.Logging.LogVerbose("Updating price for variant "+f+" ("+s+"), price is "+u+" and compare at is "+e+", discounting to "+o.DiscountedPrice),l=jQuery(n).find(".limoniapps-discountninja-shortcode").length===0,l?(discountNinja.Logging.LogVerbose("Replacing prices first time"),r(t,n,!0,o)):(discountNinja.Logging.LogVerbose("Replacing prices after first time"),discountNinja.ShortCode.RefreshResolvedPlaceholders(n,t,o)),i(t,o),!0)}catch(a){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForVariantWrapper",a,!0),!1}}function s(n){return n?"product":discountNinja.Environment.Shopify.IsCartPage()?"cart":"other"}function h(n){var c,p,l,h,k,d;try{var t=0,u=0,w=jQuery(n).parents(".limoniapps-discountninja-cart-root");if(w!==null&&w.length>0)return;var o=discountNinja.Environment.Shopify.ProductHandle(),y=jQuery(n).closest("[data-limoniapps-discountninja-product-handle],[data-limoniapps-discounturl-product-handle]"),a=!1,f=null,b=null;if(y===null||y.length!==1)if(discountNinja.Environment.Shopify.IsProductPage())if(a=!0,discountNinja.Logging.LogVerbose("No product handle found, assuming the product is the product on the current product page"),c=discountNinja.Environment.Shopify.VariantId(),c)t=discountNinja.LiquidData.Price(c),u=discountNinja.LiquidData.CompareAtPrice(c),f=discountNinja.LiquidData.Inventory(c),discountNinja.Logging.LogVerbose("Loading pricing for variant "+c+": price "+t+", compare at:"+u);else{discountNinja.Logging.LogVerbose("No product variant found on product page");return}else{discountNinja.Logging.LogVerbose("No product handle found on non-product page");return}else discountNinja.Logging.LogVerbose("Product handle found, assuming the product is not on the product page, reading price from data tags"),p=y[0],o=e(p,"product-handle"),l=discountNinja.ProductData.GetByProductHandle(o,!0,!0,p),l!==null?(t=l.Price,u=l.CompareAtPrice,f=l.Inventory,b=l.Collections,(f===undefined||isNaN(f))&&(f=null),(t===null||t===undefined||isNaN(t)||t===0)&&(t=0),(u===null||u===undefined||isNaN(u)||u===0)&&(u=t),u<t&&(u=t),t=t/100,u=u/100,discountNinja.Logging.LogVerbose("Derived price "+t+" and compare at price "+u+" and inventory level "+f+" from data tags")):discountNinja.Logging.LogWarning("Could not find product data for "+o,!0,!1);if(h=discountNinja.Promotion.GetPromotionForProduct(o,b,f,t),!h)return discountNinja.Logging.LogVerbose("The price will not be updated for the product with handle '"+o+"' since the product is not a target of the promotion(s)."),!1;var g=discountNinja.DiscountLevel.GetCurrentDiscountLevel(h),v=discountNinja.DiscountedProduct.Get(null,o,t,u,f,h,g),nt=a===!0?"current ":"";return discountNinja.Logging.LogVerbose("Updating price for "+nt+"product ("+o+"), price is "+t+" and compare at is "+u+", discounting to "+v.DiscountedPrice),k=jQuery(n).find(".limoniapps-discountninja-shortcode").length===0,k?(discountNinja.Logging.LogVerbose("Replacing prices first time"),d=s(a),r(h,n,a,v,d)):(discountNinja.Logging.LogVerbose("Replacing prices after first time"),discountNinja.ShortCode.RefreshResolvedPlaceholders(n,h,v)),i(h,v),!0}catch(tt){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",tt,!0),!1}}function r(n,t,i,r,u){try{discountNinja.Logging.LogVerbose("Replacing prices for product first time");var o=jQuery(t).html(),f=jQuery(t).find(".limoniapps-discountninja-productprice-inner"),e=f===null||f.length===0,s=e?o:jQuery(f).prop("outerHTML");e?discountNinja.Logging.LogVerbose("No limoniapps-discountninja-productprice-inner tag detected, using limoniapps-discountninja-productprice"):discountNinja.Logging.LogVerbose("Using limoniapps-discountninja-productprice-inner tag");var h='<span class="limoniapps-discountninja-productprice-original" style="display:none;">'+s+"<\/span>",v=discountNinja.Settings.GetPriceFormat("standard").Format,c=discountNinja.ShortCode.ReplaceAllPlaceHolders(n,v,r);discountNinja.Logging.LogVerbose("Replacing price with "+c);var y=discountNinja.Settings.GetPriceFormat("standard").Animation,p=i===!0?"limoniapps-discountninja-currentproduct ":"",w='<span style="display:inline-block;animation-iteration-count: '+discountNinja.Settings.GetPriceFormat("standard").AnimationIterations+' !important;" class="limoniapps-discountninja-discountedprice '+p+y+'">'+c+"<\/span>",l='<span class="limoniapps-discountninja-productprice-replaced limoniapps-discountninja-'+u+'page" style="display:none;">'+w+"<\/span>",a="";a=e?l+h:o.replace(s,l+h);jQuery(t).html(a)}catch(b){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",b,!0)}}function u(n,t){try{var i=jQuery("[data-limoniapps-discountninja-product-handle]").last().find(".limoniapps-discountninja-productprice,.limoniapps-discounturl-productprice").first(),r=i&&i.length===1&&jQuery(i).is(":visible");if(r||n===100)return n<100?(discountNinja.Logging.LogVerbose("Collection product cards are assumed to be ready"),t.apply(this,arguments)):(discountNinja.Logging.LogVerbose("Collection product cards may not be ready, timed out"),t.apply(this,arguments));setTimeout(function(){u(n+1,t)},50)}catch(f){discountNinja.Logging.LogError("DynamicPricing.WaitForPriceTag",f,!0)}}var n,f;try{n=discountNinja.Settings.Settings;discountNinja.Environment.Shopify.IsCollectionPage()?(f=t.bind(this,n),u(1,f)):t(n)}catch(c){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",c,!0)}},UnblockPrices:function(){discountNinja.Logging.LogVerbose("Unblocking prices");jQuery(".limoniapps-discountninja-dots-wrapper").removeClass("limoniapps-discountninja-dots-wrapper");jQuery(".limoniapps-discountninja-block-prices").removeClass("limoniapps-discountninja-block-prices")},UnblockButtons:function(){discountNinja.Logging.LogVerbose("Unblocking buttons");jQuery(".limoniapps-discountninja-spinner").removeClass("limoniapps-discountninja-spinner");jQuery(".limoniapps-discountninja-block").removeClass("limoniapps-discountninja-block");jQuery(".limoniapps-discountninja-block-buttons").removeClass("limoniapps-discountninja-block-buttons")},UnblockPricesAndButtons:function(){discountNinja_Script_DynamicPricing.UnblockButtons();discountNinja_Script_DynamicPricing.UnblockPrices()},Show:function(n){function r(n){return function(t,i){try{n?jQuery(i).show():jQuery(i).hide()}catch(r){discountNinja.Logging.LogError("DynamicPricing.SetDynamicPricingVisibility",r,!0)}}}var i,t;try{i=n===undefined?discountNinja_Script_DynamicPricing.HasActiveDiscountCode():n;discountNinja.Logging.LogVerbose("Setting visibility of Dynamic Pricing to "+i);discountNinja.MultiCurrency.UpdateCurrency();discountNinja_Script_DynamicPricing.UnblockPrices();t=jQuery(".limoniapps-discountninja-productprice-original");t.each(r(!i));t=jQuery(".limoniapps-discountninja-productprice-replaced");t.each(r(i));t=discountNinja.Environment.Shopify.IsProductPage()?jQuery(".limoniapps-discountninja-productprice-showafterreplace"):jQuery(".limoniapps-discountninja-productprice-replaced").closest(".limoniapps-discountninja-productprice-wrapper").find(".limoniapps-discountninja-productprice-showafterreplace");t.each(r(i));t=discountNinja.Environment.Shopify.IsProductPage()?jQuery(".limoniapps-discountninja-productprice-replaced").closest(".limoniapps-discountninja-productprice-wrapper").find(".limoniapps-discountninja-productprice-hideafterreplace"):jQuery(".limoniapps-discountninja-productprice-hideafterreplace");t.each(r(!i))}catch(u){return discountNinja.Logging.LogError("DynamicPricing.Show",u,!0),!1}},FindElementInCart:function(n,t,i){try{if(!n)return null;var r=jQuery(n).find(t);return r&&r.length!==0||(r=jQuery(n).parent().find(t)),r&&r.length!==0?r:(i&&discountNinja.Logging.LogVerbose("Could not find "+t+" in cart element"),null)}catch(u){discountNinja.Logging.LogError("DynamicPricing.FindElementInCart",u,!0)}},ReplacePricesInDrawerCart:function(n){try{if(n=n?n:discountNinja.Settings.Settings,!n)return;var t=discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(n,!0);t&&(discountNinja.Logging.LogVerbose("Replace prices in drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!0))}catch(i){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInDrawerCart",i,!0)}},ReplacePricesInClassicCart:function(n){try{if(n=n?n:discountNinja.Settings.Settings,!n)return;var t=(discountNinja.Environment.Shopify.IsCartPage()||jQuery(".limoniapps-discountninja-cart-root").length>0)&&discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(n,!1);t&&(discountNinja.Logging.LogVerbose("Replace prices in classic cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!1))}catch(i){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInClassicCart",i,!0)}},ReplacePricesInCartInner:function(n){function a(n){var t,i;try{return t=jQuery(n).find(".limoniapps-discountninja-cart-item-product-price, .limoniapps-discountninja-cart-item-line-price").attr("data-limoniapps-discountninja-cart-key"),t?(n=jQuery(n).parent(),t.split(":")[0]):(i=discountNinja_Script_DynamicPricing.FindElementInCart(n,".limoniapps-discountninja-cart-item-variant",!0),i?discountNinja.Utilities.GetNumberFromHtmlFragment(i.html()):null)}catch(r){return discountNinja.Logging.LogError("DynamicPricing.GetVariantHtmlFromCartItem",r,!0),null}}function v(n,t){var f;try{var i=t/100,r=n/100,u=Math.round((r-i)*100)/100;return u<0&&(u=0),f=i/r*100,{OriginalPrice:r,Amount:i,Percentage:f,DiscountedPrice:u}}catch(e){discountNinja.Logging.LogError("DynamicPricing.BuildProductInfoFromAmount",e,!0)}}function r(n,t,i){var f,o,r,e;try{if(discountNinja.Logging.LogVerbose("Replacing prices in cart for root"),discountNinja.DiscountedCart.DiscountedCart===null)return;if(f=discountNinja.DiscountedCart.DiscountedCart.total_discount*100,o=jQuery(n).find(".limoniapps-discountninja-cart-item"),o&&o.length>0)jQuery(n).find(".limoniapps-discountninja-cart-item").each(function(n,r){var u=a(r),f=s(null,u,r,t,i);discountNinja.Logging.LogVerbose("Calculated savings for item in cart: "+f+" cents")});else for(r=[],jQuery(n).find(".limoniapps-discountninja-cart-item-product-price, .limoniapps-discountninja-cart-item-line-price").each(function(n,t){for(var i=jQuery(t).attr("data-limoniapps-discountninja-cart-key"),f=!0,u=0;u<r.length;u++)if(r[u]===i){f=!1;break}f&&(discountNinja.Logging.LogVerbose("Adding key to cart variant keys to process: "+i),r.push(i))}),e=0;e<r.length;e++){var h=r[e],c=h.split(":")[0],l=s(h,c,null,t,i);discountNinja.Logging.LogVerbose("Calculated savings for item in cart: "+l+" cents")}if(f>0){discountNinja.Logging.LogVerbose("Replacing subtotal");var y=v(discountNinja.LiquidData.SubTotalPriceFromCart()*100,f),p=discountNinja.Environment.Shopify.IsCartPage()?discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage:discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart,w=discountNinja.Environment.Shopify.IsCartPage()?discountNinja.Settings.Settings.CartSettings.SubtotalSavingsLabel:discountNinja.Settings.Settings.DrawerCartSettings.SubtotalSavingsLabel;u(null,null,n,f>0,p,"subtotal",w,y)}else discountNinja.Logging.LogVerbose("No discounted products in cart, not updating subtotal")}catch(b){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1;discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRoot",b,!0)}}function s(n,t,i,r,f){var h,c,o,p,e,d;try{if(t!==null)for(h="Replacing prices in cart - Variant "+t,discountNinja.Logging.LogVerbose(h),c=0;c<r.length;c++)if(o=r[c],t===o){var v=discountNinja.Utilities.StringIsIn(o,f),l=discountNinja.LiquidData.QuantityFromCart(o),s=discountNinja.LiquidData.PriceFromCart(o)*100;discountNinja.Logging.LogVerbose(h+" - Price "+s+" and quantity "+l);var g=s/100,y=discountNinja.LiquidData.CompareAtPrice(o),a=discountNinja.ProductData.GetByVariant(o,!0);if(a){if(p=discountNinja.LiquidData.ProductHandleFromCart(o),e=discountNinja.Promotion.GetPromotionForProduct(p,a.Collections,a.Inventory,g),e&&e.PriceRuleInfo.TargetType==="line_item"&&e.PriceRuleInfo.AllocationMethod==="each"){var ut=e.PriceRuleInfo,w=discountNinja.DiscountLevel.GetCurrentDiscountLevel(e),b=discountNinja.DiscountedProduct.Get(o,null,s/100,y,discountNinja.LiquidData.Inventory(o),e,w),nt=discountNinja.DiscountedProduct.Get(o,null,s/100*l,y,discountNinja.LiquidData.Inventory(o),e,w),k=discountNinja.Environment.Shopify.IsCartPage()?discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage:discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart,tt=discountNinja.Environment.Shopify.IsCartPage()?e.CartSettings.ProductSavingsLabel:e.DrawerCartSettings.ProductSavingsLabel,it=discountNinja.Environment.Shopify.IsCartPage()?e.CartSettings.LineItemSavingsLabel:e.DrawerCartSettings.LineItemSavingsLabel;return u(n,e,i,v,k,"item-product",tt,b),u(n,e,i,v,k,"item-line",it,nt),d=b.DiscountedPriceRaw*100,(s-d)*l}return 0}}return discountNinja.Logging.LogVerbose(h+" - No match found in discounted cart"),0}catch(rt){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItem",rt,!0)}}function y(n,t){var r,o,u,f;try{var s="GetOriginalPriceHtmlFromCartItem - Level "+t+" - ",e="limoniapps-discountninja-productprice-original",h=".limoniapps-discountninja-cart-"+t+"-price",i=discountNinja_Script_DynamicPricing.FindElementInCart(n,h,!0);return i?(r=discountNinja_Script_DynamicPricing.FindElementInCart(i,"."+e,!1),o='<span class="'+e+'" style="display:none;">'+i.html()+"<\/span>",r===null?o:(u=r[0],f=u?jQuery(u).prop("outerHTML"):"",f?f:"")):(discountNinja.Logging.LogVerbose(s+"No match found for price element"),"")}catch(c){return discountNinja.Logging.LogError("DynamicPricing.GetOriginalPriceHtmlFromCartItem",c,!0),null}}function u(n,t,i,r,u,f,e,o){function w(n,t,i,r){var u,f;try{u=discountNinja_Script_DynamicPricing.FindElementInCart(n,".limoniapps-discountninja-cart-"+t+"-price",!0);u&&(f='<span class="limoniapps-discountninja-productprice-replaced" style="display:none;">'+r+"<\/span>",jQuery(u).html(f+i))}catch(e){return discountNinja.Logging.LogError("ReplacePriceInCart",e,!0),null}}var h,l,a,s,v,c;try{h="Replacing prices in cart - Level "+f+" - ";l=discountNinja.Settings.GetPriceFormat(f).Format;r?(discountNinja.Logging.LogVerbose(h+"Discounted"),u?(a=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,l||"{{DISCOUNTED_PRICE}} {{STRIKETHROUGH_ORIGINAL_PRICE}}",o,f),s=i,s===null&&(s=jQuery(".limoniapps-discountninja-cart-"+f+'-price[data-limoniapps-discountninja-cart-key="'+n+'"')),v=y(s,f),w(s,f,v,a)):discountNinja.Logging.LogVerbose(h+"Dynamic Pricing on cart not enabled for level "+f),c=i,c===null&&(c=jQuery(".limoniapps-discountninja-cart-"+f+'-comment[data-limoniapps-discountninja-cart-key="'+n+'"')),p(t,c,e,f,o)):discountNinja.Logging.LogVerbose(h+"Not discounted")}catch(b){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItemLevel",b,!0)}}function p(n,t,i,r,u){var e,f,o;try{e=".limoniapps-discountninja-cart-"+r+"-comment";f=discountNinja_Script_DynamicPricing.FindElementInCart(t,e,!0);i&&f?(discountNinja.Logging.LogVerbose("Adding comment for level: "+r),o='<span class="limoniapps-discountninja-productprice-replaced" style="display:none;">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(n,i,u)+"<\/span>",jQuery(f).html(o),f.show()):i||discountNinja.Logging.LogVerbose("No comment for level: "+r)}catch(s){return discountNinja.Logging.LogError("DynamicPricing.AddCartComment",s,!0),null}}function i(){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}function w(){jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-comment").hide();jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-discounted_price").text("0");jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-original_price").hide()}function h(n){var t=!1;return jQuery(n).each(function(){if(jQuery(this).is(":visible")){t=!0;return}}),t}function c(n){var t=!1;return jQuery(n).each(function(){if(discountNinja.Utilities.IsInViewport(this)){t=!0;return}}),t}function l(n,t,r){try{var u=h(t)&&c(t);if(u||n===200)return n<200?(discountNinja.Logging.LogVerbose("Drawer cart is ready"),r.apply(this,arguments)):(discountNinja.Logging.LogVerbose("Drawer cart not ready, timed out"),i());setTimeout(function(){l(n+1,t,r)},50)}catch(f){discountNinja.Logging.LogError("DynamicPricing.WaitForDrawerCart",f,!0)}}function b(n,t){try{discountNinja.Logging.LogVerbose("Replace prices in drawer cart - starting");jQuery(".limoniapps-discountninja-drawercart-root").each(function(){try{var i=h(this)&&c(this);i?(discountNinja.Logging.LogVerbose("Drawer cart is ready, replacing prices"),r(this,n,t),setTimeout(function(){r(this,n,t)},200)):discountNinja.Logging.LogVerbose("Drawer cart was expected to be ready, but it is not")}catch(u){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRootAfterWait.Inner",u,!0)}});discountNinja.Logging.LogVerbose("Replace prices in drawer cart - done");discountNinja_Script_DynamicPricing.UnblockPricesAndButtons();discountNinja_Script_DynamicPricing.Show(!0);discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}catch(i){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1;discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRootAfterWait",i,!0)}}var f,t,e,o;try{if(discountNinja.Settings.Settings===null)return;if(discountNinja.DiscountedCart.DiscountedCart===null)return;if(!discountNinja_Script_DynamicPricing.HasActiveDiscountCode()){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1;return}if(f=n?"drawer cart":"classic cart",discountNinja.Logging.LogVerbose("Replace prices in "+f+" (inner)"),window.limoniapps_discountninja_liquid.Cart.items.length===0){discountNinja.Logging.LogVerbose("Replace prices in "+f+" stopped: no items in cart");i();w();return}if(discountNinja.DiscountedCart.DiscountedCart.total_discount===0){discountNinja.Logging.LogVerbose("No discount in cart");i();return}if(t=n?jQuery(".limoniapps-discountninja-drawercart-root"):jQuery(".limoniapps-discountninja-cart-root"),t===undefined||t.length===0){discountNinja.Logging.LogVerbose(n?"Could not find limoniapps-discountninja-drawercart-root":"Could not find limoniapps-discountninja-cart-root");i();return}discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!0;e=discountNinja.DiscountedCart.GetCartVariantIds();o=discountNinja.LiquidData.VariantIdsFromCart();n?(discountNinja.Logging.LogVerbose("Found "+t.length+" drawer cart roots, waiting until they are rendered"),jQuery(t).each(function(){var n=b.bind(this,o,e);l(1,".limoniapps-discountninja-drawercart-root",n)})):(jQuery(t).each(function(){r(this,o,e)}),discountNinja_Script_DynamicPricing.Show(!0),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1)}catch(k){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1;discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartInner",k,!0)}},ReplacePricesInCart:function(){function n(){var n,t;try{n=discountNinja.Settings.Settings;discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart after update cart");discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(n);discountNinja_Script_DynamicPricing.ReplacePricesInClassicCart(n);discountNinja.Logging.LogVerbose("Hiding checkout buttons");t=discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString();t!==""&&discountNinja.PromotionFlow.HideAdditionalCheckoutButtons();discountNinja.Logging.LogVerbose("Inject in Html");discountNinja.DiscountCode.InjectDiscountCodesInHtml()}catch(i){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1;discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCart.Inner",i,!0)}discountNinja.Logging.LogVerbose("Unblock");discountNinja_Script_DynamicPricing.UnblockPricesAndButtons()}discountNinja.Logging.LogVerbose("Requested ReplacePricesInCart");discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){n()})})},IsDynamicPricingRequired:function(n,t){var i="";if(t)if(n.PriceUpdateSettings.EnableOnDrawerCart===!1)i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the drawer cart.";else return!0;return i===""&&discountNinja.Environment.Shopify.IsHomePage()&&n.PriceUpdateSettings.EnableOnHomePage===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the home page."),i===""&&discountNinja.Environment.Shopify.IsCollectionPage()&&n.PriceUpdateSettings.EnableOnCollectionPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on collection pages."),i===""&&discountNinja.Environment.Shopify.IsProductPage()&&n.PriceUpdateSettings.EnableOnProductPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on product pages."),i===""&&discountNinja.Environment.Shopify.IsBlogPost()&&n.PriceUpdateSettings.EnableOnBlogPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on blog pages."),i===""&&discountNinja.Environment.Shopify.IsCustomPage()&&n.PriceUpdateSettings.EnableOnCustomPages===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on custom pages."),i===""&&discountNinja.Environment.Shopify.IsCartPage()&&n.PriceUpdateSettings.EnableOnCartPage===!1&&(i="Dynamic Pricing is not required since the promotion configuration specifies not to dynamically replace prices on the cart page."),discountNinja.PromotionFlow.HandleFlowErrorMessage(i)},HasActiveDiscountCode:function(){var n=discountNinja.DiscountCode.GetActiveLineItemDiscountCodes();return n!==undefined&&n!==null&&n!==""}},discountNinja_Script_LiquidData={WaitForLiquidAsset:function(n){var t,i,r;try{t=typeof limoniapps_discountninja_liquid!="undefined";t?n&&n():(discountNinja.Logging.LogVerbose("Waiting for liquid asset to be returned"),i=0,r=function(){if(i++,t=typeof limoniapps_discountninja_liquid!="undefined",t||i===50){if(i===50)return discountNinja.Logging.LogTestMode("A Discount Ninja liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-app-liquid) is missing in your theme. Contact support@limoniapps.com to have the issue resolved.",!0,!0,!0,!0),discountNinja.Logging.LogError("Waiting for liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-app-liquid) to be returned timed out. Either the asset does not exist or it is not included in the theme.liquid file. Exiting.",!1);discountNinja.Logging.LogVerbose("LiquidData.WaitForLiquidAsset","Waiting for liquid asset to be available - DONE");n&&n()}else return setTimeout(r,100)},r())}catch(u){return discountNinja.Logging.LogError("LiquidData.WaitForLiquidAsset",u,!0),""}},Cart:function(){try{return typeof limoniapps_discountninja_liquid!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart.total_price!="undefined"?window.limoniapps_discountninja_liquid.Cart:null}catch(n){discountNinja.Logging.LogError("LiquidData.Cart",n,!0)}},CartValue:function(){try{var n=discountNinja_Script_LiquidData.Cart();return n===null?null:n.total_price}catch(t){discountNinja.Logging.LogError("LiquidData.CartValue",t,!0)}},VariantIdsFromCart:function(){var n,t,i;try{if(n="",t=discountNinja_Script_LiquidData.Cart(),t&&typeof t.items=="object")for(i=0;i<t.items.length;i++)n!==""&&(n=n+","),n=n+t.items[i].variant_id;return n.split(",")}catch(r){return discountNinja.Logging.LogError("LiquidData.VariantIdsFromCart",r,!0),null}},ProductCollections:function(){try{return window.limoniapps_discountninja_liquid.Product?window.limoniapps_discountninja_liquid.Product.Collections:null}catch(n){return discountNinja.Logging.LogError("LiquidData.ProductCollections",n,!0),null}},ProductDefaultVariantId:function(){try{return window.limoniapps_discountninja_liquid.Product?window.limoniapps_discountninja_liquid.Product.VariantId:null}catch(n){return discountNinja.Logging.LogError("LiquidData.ProductDefaultVariantId",n,!0),null}},VariantInfoFromLiquid:function(n){try{if(window.limoniapps_discountninja_liquid.ProductVariants)for(var t=0;t<window.limoniapps_discountninja_liquid.ProductVariants.length;t++)if(window.limoniapps_discountninja_liquid.ProductVariants[t].VariantId===parseInt(n))return window.limoniapps_discountninja_liquid.ProductVariants[t];return null}catch(i){return discountNinja.Logging.LogError("LiquidData.VariantInfoFromLiquid",i,!0),null}},CompareAtPrice:function(n){try{var t=discountNinja_Script_LiquidData.VariantInfoFromLiquid(n);return t===null?0:t.CompareAtPrice/100}catch(i){return discountNinja.Logging.LogError("LiquidData.CompareAtPrice",i,!0),null}},Price:function(n){try{var t=discountNinja_Script_LiquidData.VariantInfoFromLiquid(n);return t===null?0:t.Price/100}catch(i){return discountNinja.Logging.LogError("LiquidData.Price",i,!0),0}},Inventory:function(n){try{var t=discountNinja_Script_LiquidData.VariantInfoFromLiquid(n);return t===null?null:t.Inventory==="null"?null:t.Inventory}catch(i){return discountNinja.Logging.LogError("LiquidData.Inventory",i,!0),0}},CartItemByVariant:function(n){try{for(var t=0;t<window.limoniapps_discountninja_liquid.Cart.items.length;t++)if(window.limoniapps_discountninja_liquid.Cart.items[t].variant_id.toString()===n.toString())return window.limoniapps_discountninja_liquid.Cart.items[t];return null}catch(i){return discountNinja.Logging.LogError("LiquidData.CartItemByVariant",i,!0),null}},CartItemByProductHandle:function(n){try{for(var t=0;t<window.limoniapps_discountninja_liquid.Cart.items.length;t++)if(window.limoniapps_discountninja_liquid.Cart.items[t].handle===n)return window.limoniapps_discountninja_liquid.Cart.items[t];return null}catch(i){return discountNinja.Logging.LogError("LiquidData.CartItemByProductHandle",i,!0),null}},PriceFromCartByProductHandle:function(n){try{var t=discountNinja_Script_LiquidData.CartItemByProductHandle(n);return t===null?null:t.price/100}catch(i){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",i,!0),null}},PriceFromCart:function(n){try{var t=discountNinja_Script_LiquidData.CartItemByVariant(n);return t===null?null:t.price/100}catch(i){return discountNinja.Logging.LogError("LiquidData.PriceFromCart",i,!0),null}},ProductHandleFromCart:function(n){try{var t=discountNinja_Script_LiquidData.CartItemByVariant(n);return t===null?null:t.handle}catch(i){return discountNinja.Logging.LogError("LiquidData.ProductHandleFromCart",i,!0),null}},QuantityFromCart:function(n){try{var t=discountNinja_Script_LiquidData.CartItemByVariant(n);return t===null?null:t.quantity}catch(i){return discountNinja.Logging.LogError("LiquidData.QuantityFromCart",i,!0),null}},SubTotalPriceFromCart:function(){try{return typeof limoniapps_discountninja_liquid!="undefined"&&typeof window.limoniapps_discountninja_liquid.Cart=="object"?window.limoniapps_discountninja_liquid.Cart.total_price/100:null}catch(n){return discountNinja.Logging.LogError("LiquidData.SubTotalPriceFromCart",n,!0),null}},ItemsInCartFromCollections:function(n){var i,t,r,u;try{if(!n)return 0;for(i=0,t=0;t<window.limoniapps_discountninja_liquid.Cart.items.length;t++)r=discountNinja.ProductData.GetByProductHandle(window.limoniapps_discountninja_liquid.Cart.items[t].handle),r&&(u=r.Collections,discountNinja.Utilities.StringIsIn(n,u)&&i++);return i}catch(f){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromCollections",f,!0),0}}},discountNinja_Script_Promotion={Promotions:null,PrimaryPromotion:null,ServerUrl:function(){return"https://discountninjav2-promotionapi-prod.azurewebsites.net"},GetPromotionByToken:function(n){if(discountNinja_Script_Promotion.Promotions)for(var t=0;t<discountNinja_Script_Promotion.Promotions.length;t++)if(discountNinja_Script_Promotion.Promotions[t].Token===n)return discountNinja_Script_Promotion.Promotions[t];return null},PromotionCanTrigger:function(n){try{return discountNinja_Script_Promotion.PromotionIsApplicable(n)?n.ServePromotion!==!0?(discountNinja.Logging.LogInformation("The promotion cannot trigger because it is either inactive or scheduled (pending).",!1),!1):discountNinja.Trigger.PromotionTriggersOnPage(n)?!0:!1:!1}catch(t){discountNinja.Logging.LogError("Promotion.PromotionCanTrigger",t,!0)}},SetPrimaryPromotion:function(){var l,i,n,r,t,u,o,f,e;try{if(discountNinja_Script_Promotion.PrimaryPromotion=null,discountNinja.Environment.Shopify.IsProductPage()){var s=discountNinja.Environment.Shopify.ProductHandle(),h=discountNinja.Environment.Shopify.VariantId(),c=discountNinja.LiquidData.Inventory(h);discountNinja.Logging.LogVerbose("Selecting primary promotion based on product handle: "+s+" (inventory: "+c+")");l=discountNinja.LiquidData.Price(h);discountNinja_Script_Promotion.PrimaryPromotion=discountNinja_Script_Promotion.GetPromotionForProduct(s,null,c,l)}if(discountNinja_Script_Promotion.PrimaryPromotion===null){if(discountNinja.Logging.LogVerbose("Selecting primary promotion based on first applicable"),i=discountNinja_Script_Promotion.Promotions,i===null)return;for(n=[],r=0;r<i.length;r++)(discountNinja_Script_Promotion.PromotionCanTrigger(i[r])||discountNinja_Script_Promotion.IsPromotionAccepted(i[r].Token,i[r].Frequency))&&n.push(i[r]);if(n.length===0)discountNinja.Logging.LogInformation("No primary promotion detected");else if(n.length===1)discountNinja_Script_Promotion.PrimaryPromotion=n[0];else{for(t=[],u=0;u<n.length;u++)o=n[u],o.PopUpSettings.Enabled&&t.push(o);if(t.length===0)discountNinja_Script_Promotion.PrimaryPromotion=n[0];else if(t.length===1)discountNinja_Script_Promotion.PrimaryPromotion=t[0];else{for(f=0;f<t.length;f++)if(e=t[f],!discountNinja_Script_Promotion.IsPromotionAccepted(e.Token,e.Frequency)){discountNinja_Script_Promotion.PrimaryPromotion=e;return}discountNinja_Script_Promotion.PrimaryPromotion=t[0]}}}}catch(a){discountNinja.Logging.LogError("Promotion.SetPrimaryPromotion",a,!0)}},LoadApplicablePromotions:function(n,t){function v(n){try{var t=discountNinja.Cache.SessionGet("promotioninfo-"+n);return t==="undefined"?null:JSON.parse(t)}catch(i){return discountNinja.Logging.LogError("Promotion.GetPromotionInfoFromCache",i,!0),null}}function y(n){var t,i,r;try{if(!n)return null;for(discountNinja.Logging.LogVerbose("Before filter "+n.length+" promotions available"),t=[],i=0;i<n.length;i++)r=n[i],discountNinja_Script_Promotion.PromotionIsApplicable(r)&&t.push(r);return discountNinja.Logging.LogVerbose("After filter "+t.length+" promotions available"),t}catch(u){return discountNinja.Logging.LogError("Promotion.FilterPromotions",u,!0),null}}function p(n,t){try{discountNinja.Cache.SessionSet("promotioninfo-"+n,JSON.stringify(t))}catch(i){discountNinja.Logging.LogError("Promotion.SavePromotionInfoToCache",i,!0)}}function w(n,t){try{if(discountNinja_Script_Promotion.Promotions=null,discountNinja_Script_Promotion.PrimaryPromotion=null,discountNinja.Settings.Settings=n.Settings,!discountNinja.Settings.SettingsAreValid(discountNinja.Settings.Settings))return discountNinja.Logging.LogWarning("Settings invalid",!0,!1),null;discountNinja_Script_Promotion.Promotions=y(n.Promotions);var i=discountNinja_Script_Promotion.Promotions;if(!i)return discountNinja.Logging.LogInformation("No promotions available",!1),null;discountNinja.Trigger.TrackExitIntent();p(t,n)}catch(r){return discountNinja.Logging.LogError("Promotion.ProcessPromotionInfo",r,!0),null}}function h(r){try{if(r===!1||r==="false")return(discountNinja.Logging.LogInformation("No applicable promotion(s) detected",!1),t)?t():void 0;if(r===null||r===undefined||r.Settings===undefined||r.Settings===null||r.Promotions===undefined||r.Promotions===null)return(discountNinja.Logging.LogError("Promotion.PromotionInfoReady","Promotion Info null or no settings/promotions available",!0),t)?t():void 0;if(r===!1||r.Promotions.length===0)return(discountNinja.Logging.LogInformation("No applicable promotion(s) detected",!1),t)?t():void 0;discountNinja.Logging.LogVerbose("Valid Promotion Info received from server");w(r,i);var u=discountNinja.Token.GetTokenFromQueryParameter();return(u!==null&&u!==""&&discountNinja.Token.SetNonAutomaticTokenInSession(u),n)?n(r):void 0}catch(f){return(discountNinja.Logging.LogError("Promotion.PromotionInfoReady",f,!0),t)?t():void 0}}function b(){try{var n={};return o&&(n.shop=o),r&&(n.token=r),c&&(n.pageType=c),l&&(n.collectionHandle=l),u&&(n.productHandle=u),a&&(n.variantId=a),discountNinja.TestMode.TestMode!==null&&(n.testMode=discountNinja.TestMode.TestMode),e!==null&&(n.firstRequest=e),s&&(n.referrer=s),n.m=moment().format("x"),n}catch(t){return discountNinja.Logging.LogError("Promotion.LoadPromotionInfo.BuildParameters",t,!0),null}}function k(n){var t="";return t=n?"token-"+n:"anytoken",discountNinja.Logging.LogVerbose("Checking promotion info cache for key: "+t),t}var e,o,s;try{var r=discountNinja.Token.GetNonAutomaticToken(),c=discountNinja.Environment.Shopify.PageType(),l=discountNinja.Environment.Shopify.CollectionHandle(),u=discountNinja.Environment.Shopify.ProductHandle(),a=discountNinja.Environment.Shopify.VariantId(),i=k(r),f=v(i),d=f!==null&&f.Promotions.length!==0;if(d)return discountNinja.Logging.LogVerbose("Promotion info available in cache"),h(f);discountNinja.Logging.LogVerbose("Loading promotion info from server");e=discountNinja.Cache.SessionGet("promotioninfo-requested-"+i)===null;o=discountNinja.Core.Shop;discountNinja.Environment.Shopify.IsProductPage()||(u=null);s=discountNinja.Utilities.GetReferrer();discountNinja.XmlHttpRequest.Send(discountNinja_Script_Promotion.ServerUrl()+"/api/ApplicablePromotions",b(),null,"get",!0,!0,h);discountNinja.Cache.SessionSet("promotioninfo-requested-"+i,!0)}catch(g){discountNinja.Logging.LogError("Promotion.LoadPromotionInfo",g,!0);t()}},PromotionIsApplicable:function(n){function s(n,t){return t==="onceperdevice"?discountNinja.Cache.LocalGet("promotion-accepted-"+n)==="false":discountNinja.Cache.SessionGet("promotion-accepted-"+n)==="false"}var r,u,o,f,e;try{if(!n)return!1;var h=n.Token,t=n.PriceRuleInfo,i=n.FilterSettings;if(!t)return!1;if(t.StartsAt!==null&&t.StartsAt!==undefined&&t.StartsAt!==""&&moment().utc().diff(moment(t.StartsAt).utc(),"seconds")<0&&(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because the start date ("+t.StartsAt+") of the promotion is in the future, it is only shown because you are in test mode. Check the start date of your promotion and the start date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-promotion-automatically' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1)||t.EndsAt!==null&&t.EndsAt!==undefined&&t.EndsAt!==""&&moment().utc().diff(moment(t.EndsAt).utc(),"seconds")>=0&&(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because the expiration date ("+t.EndsAt+")  of the discount code "+t.DiscountLevel1.DiscountCode+" is in the past or the timer has expired. Check the end date of your promotion, the expiration date of your discount code and the end date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-promotion-automatically' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1))return discountNinja_Script_Promotion.Stop(n.Token),!1;if(s(n.Token,n.Frequency))return discountNinja.Logging.LogVerbose("Promotion with token "+h+" is not applicable because it was previously canceled"),discountNinja_Script_Promotion.Stop(n.Token),!1;if(i.CustomerType&&i.CustomerType==="customers_only"&&!discountNinja.Environment.Shopify.IsCustomer()){if(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because it is restricted to customers only and you are not logged in as a customer, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1)return discountNinja_Script_Promotion.Stop(n.Token),!1}else if(i.CustomerType==="prospects_only"&&discountNinja.Environment.Shopify.IsCustomer()&&(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed it is restricted to prospects only and you are logged in as a customer, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1))return discountNinja_Script_Promotion.Stop(n.Token),!1;if(i.CustomerType==="customers_only"&&i.CustomerTagType!=="all"){if(r=discountNinja.Environment.Shopify.CustomerTags(),u=!1,r&&i.CustomerTags)for(o=i.CustomerTags.split(","),f=0;f<r.length;f++)for(e=0;e<o.length;e++)r[f].toLowerCase().trim()===o[e].toLowerCase().trim()&&(u=!0);if(i.CustomerTagType==="include"&&u===!1&&(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because the logged in customer is not tagged with one of the following tags: "+i.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1)||i.CustomerTagType==="exclude"&&u===!0&&(discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because the logged in customer is tagged with one of the following tags: "+i.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-promotions-to-customers-or-prospects' target='_blank'>here<\/a>.",null,!0,!0,!1),discountNinja.TestMode.TestMode===!1))return discountNinja_Script_Promotion.Stop(n.Token),!1}return discountNinja.Logging.LogVerbose("The promotion is applicable"),!0}catch(c){return discountNinja.Logging.LogError("Promotion.PromotionIsApplicable",c,!0),null}},GetPromotionServedInSession:function(n,t){return discountNinja.Cache.SessionGet("promotion-served-session-"+n+"-"+t)},SetPromotionServedInSession:function(n,t,i){discountNinja.Cache.SessionSet("promotion-served-session-"+n+"-"+t,i)},GetPromotionServedOnDevice:function(n,t){return discountNinja.Cache.LocalGet("promotion-served-device-"+n+"-"+t)},SetPromotionServedOnDevice:function(n,t,i){discountNinja.Cache.LocalSet("promotion-served-device-"+n+"-"+t,i)},IsPromotionAccepted:function(n,t){var i,r;return t==="onceperdevice"?(i=discountNinja.Cache.LocalGet("promotion-accepted-"+n)==="true",discountNinja.Logging.LogVerbose("The promotion is accepted on device: "+i),i):(r=discountNinja.Cache.SessionGet("promotion-accepted-"+n)==="true",discountNinja.Logging.LogVerbose("The promotion is accepted in the session: "+r),r)},SetPromotionAccepted:function(n,t,i){t==="onceperdevice"?discountNinja.Cache.LocalSet("promotion-accepted-"+n,i):(discountNinja.Cache.LocalSet("promotion-accepted-"+n,""),discountNinja.Cache.SessionSet("promotion-accepted-"+n,i))},SetPromotionExpired:function(n){discountNinja.Cache.LocalSet("promotion-expired-"+n,"true")},ExpirePromotionsAccepted:function(){if(discountNinja_Script_Promotion.Promotions)for(var n=0;n<discountNinja_Script_Promotion.Promotions.length;n++)discountNinja_Script_Promotion.SetPromotionExpired(token)},GetPromotionPriceRule:function(n){n||(n=discountNinja_Script_Promotion.PrimaryPromotion);var t=n?discountNinja.DiscountLevel.GetCurrentDiscountLevel(n):null;return t?t.PriceRuleId:null},GetPromotionDiscountCode:function(n){n||(n=discountNinja_Script_Promotion.PrimaryPromotion);var t=n?discountNinja.DiscountLevel.GetCurrentDiscountLevel(n):null;return t?t.DiscountCode:null},GetPromotionForProduct:function(n,t,i,r){function a(n,t,i){try{if(n.PriceRuleInfo.TargetType!=="line_item")return discountNinja.Logging.LogVerbose("Promotion with token "+n.Token+" not valid for product "+t+" - Shipping only"),!1;if(n.PriceRuleInfo.AllocationMethod!=="each")return discountNinja.Logging.LogVerbose("Promotion with token "+n.Token+" not valid for product "+t+" - Cart level only"),!1;if(discountNinja.Utilities.StringIsIn(i,n.ExcludeCollectionHandles))return discountNinja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is in an exclude collection."),!1;if(n.TargetType==="collection"){if(!discountNinja.Utilities.StringIsIn(i,n.TargetCollectionHandles))return discountNinja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is not in the set of promoted collections."),discountNinja.Logging.LogVerbose("The promotion applies to products in the collections '"+n.TargetCollectionHandles+"' the product '"+t+" is in collections '"+i+"'."),!1}else if(n.TargetType==="product"){if(!discountNinja.Utilities.StringIsIn(n.PriceRuleInfo.TargetProductHandles,t))return discountNinja.Logging.LogVerbose("The promotion is not valid for product "+t+" because that product is not in the set of promoted products."),discountNinja.Logging.LogVerbose("The promotion applies to products '"+n.PriceRuleInfo.TargetProductHandles+"' the product '"+t+" is not in that list."),!1}else if(n.TargetType!=="site")return discountNinja.Logging.LogError("Promotion.PromotionIsValidForProduct","TargetType unknown",!0),!1;return discountNinja.Logging.LogVerbose("Promotion is valid for product"),!0}catch(r){return discountNinja.Logging.LogError("Promotion.PromotionIsValidForProduct",r,!0),!1}}function v(n,t,i){var u,e;try{var a=n.DiscountPriceType,f=n.ValueType,o=t.Amount,s=t.Percentage,h=discountNinja.Settings.Settings.CurrencySettings.RoundPrices,c=discountNinja.Settings.Settings.CurrencySettings.RoundToCents,r=0;return f==="fixed_amount"?r=i-o:f==="percentage"&&(r=parseFloat((i-Math.floor(i*s)/100).toFixed(4))),r<0&&(r=0),h&&(u=r*100,u>0&&(e=Math.floor(u/100)*100,u=e+c),r=Math.round(u)/100),Math.round(r*100)/100}catch(l){discountNinja.Logging.LogError("Promotion.TestDiscountedPrice",l,!0)}}var e,f,u,l,h,c;try{if(n===null||n===undefined)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;if(e=discountNinja_Script_Promotion.Promotions,!e)return discountNinja.Logging.LogInformation("No promotions available",!1),null;var o=null,s=null,y=t||discountNinja.LiquidData.ProductCollections();for(f=0;f<e.length;f++)u=e[f],discountNinja.Logging.LogVerbose("Checking promotion "+(f+1)+" with token "+u.Token),discountNinja_Script_Promotion.PromotionIsApplicable(u)&&a(u,n,y,i)&&discountNinja_Script_Promotion.IsPromotionAccepted(u.Token,u.Frequency)?(discountNinja.Logging.LogVerbose("Promotion "+(f+1)+" with token "+u.Token+" - Valid"),l=u.PriceRuleInfo,h=discountNinja.DiscountLevel.GetCurrentDiscountLevel(u),h&&(c=v(l,discountNinja.DiscountLevel.GetPercentageAmountFromDiscountLevel(h),r),(s===null||c<s)&&(o=f,s=c))):discountNinja.Logging.LogVerbose("Promotion "+(f+1)+" with token "+u.Token+" - Not valid");return o===null?(discountNinja.Logging.LogInformation("No applicable promotion available for product "+n,!1),null):(discountNinja.Logging.LogVerbose("Using promotion "+e[o].Token+" for product "+n),e[o])}catch(p){return discountNinja.Logging.LogError("Promotion.GetPromotionForProduct",p,!0),!1}},GetTokenForProductFromCache:function(n){return discountNinja.Cache.SessionGet("token-forproduct-"+n)},SetTokenForProductInCache:function(n,t){discountNinja.Cache.SessionSet("token-forproduct-"+n,t)},GetFromCache:function(n){try{var t=discountNinja.Cache.SessionGet("promotion-data-"+n);return t==="undefined"?[]:JSON.parse(t)}catch(i){return discountNinja.Logging.LogError("Promotion.GetFromCache",i,!0),null}},SaveToCache:function(n){try{discountNinja.Cache.SessionSet("promotion-data-"+n.Token,JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("Promotion.SaveToCache",t,!0)}},RemoveFromCache:function(n){try{discountNinja.Cache.SessionRemove("promotion-data-"+n)}catch(t){return discountNinja.Logging.LogError("Promotion.RemoveFromCache",t,!0),null}},Stop:function(n){try{discountNinja.Logging.LogVerbose("Stopping promotion.");discountNinja.DiscountCode.Remove(n);discountNinja.Notification.Remove(n);discountNinja.PopUp.Hide(n);discountNinja.StickyBar.Remove(n);discountNinja.DynamicPricing.Show(!1);discountNinja_Script_Promotion.SetPromotionExpired(n)}catch(t){discountNinja.Logging.LogError("Promotion.Stop",t,!0)}},UnApply:function(n){try{discountNinja.Logging.LogVerbose("Unapplying promotion.");discountNinja.DiscountCode.Remove(n);discountNinja.Notification.Remove(n)}catch(t){discountNinja.Logging.LogError("Promotion.UnApply",t,!0)}},ExpireAll:function(){try{discountNinja.Logging.LogVerbose("Expired. Stopping all promotions with timers. Undoing all side effects");discountNinja.Checkout.Shopify.UnRegisterEventHandlerForCheckout();discountNinja.DiscountCode.Clear();discountNinja.ShortCode.HideShortcodePlaceholders();discountNinja.Notification.Clear();discountNinja.Notification.Hide();discountNinja.StickyBar.Clear();discountNinja.StickyBar.Hide();var n=discountNinja_Script_Promotion.PrimaryPromotion;n&&discountNinja.PopUp.Hide(n.Token);discountNinja.DynamicPricing.Show(!1);discountNinja_Script_Promotion.ExpirePromotionsAccepted();discountNinja.PromotionFlow.StartFlow()}catch(t){discountNinja.Logging.LogError("Promotion.ExpireAll",t,!0)}}},discountNinja_Script_ProductData={CachePrefix:function(){return"productdatav3-"},ServerUrl:function(){return"https://discountninjav2-promotionapi-prod.azurewebsites.net"},SaveProductDataToCache:function(n,t,i,r,u,f,e){try{discountNinja.Logging.LogVerbose("Saving product data for handle: "+n);var o={CompareAtPrice:t,Price:i,Inventory:f,Collections:r,CollectionsComplete:u,Source:e},s=discountNinja_Script_ProductData.GetByProductHandle(n,!1);if(!s){discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+n,JSON.stringify(o));return}if(e==="product"){discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+n,JSON.stringify(o));return}if(s.Source==="product")discountNinja.Logging.LogVerbose("Current cached product data is from product page and new data is not, skipping save for handle: "+n);else{if(e==="server"){discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+n,JSON.stringify(o));return}if(e==="collection"){s.CollectionsComplete&&!o.CollectionsComplete?o.Collections=s.Collections:s.CollectionsComplete===null&&(o.CollectionsComplete||o.Collections!==null||discountNinja.Environment.Shopify.IsCollectionPage()&&(o.Collections=discountNinja.Environment.Shopify.CollectionHandle(),o.CollectionsComplete=!1,discountNinja.Logging.LogVerbose("No collections data, setting current collection for: "+n)));discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+n,JSON.stringify(o));return}if(s.Source==="product"||s.Source==="collection"||s.Source==="server"){discountNinja.Logging.LogVerbose("Current cached product data is from "+s.Source+" and new data is from a less trustworthy source "+o.Source+" , skipping save for handle: "+n);return}discountNinja.Cache.LocalSet(n,JSON.stringify(o));return}}catch(h){return discountNinja.Logging.LogError("ProductData.SaveProductDataToCache",h,!0),null}},SaveProductDataForCollectionProduct:function(n){try{var i=!0,r=jQuery(n).attr("data-limoniapps-discountninja-product-handle"),u=jQuery(n).attr("data-limoniapps-discountninja-product-price"),f=jQuery(n).attr("data-limoniapps-discountninja-product-compareatprice"),t=jQuery(n).attr("data-limoniapps-discountninja-product-collections");!t&&discountNinja.Environment.Shopify.IsCollectionPage()&&(t=discountNinja.Environment.Shopify.CollectionHandle(),i=!1);discountNinja.Logging.LogVerbose("Saving product data for collection product with handle: "+r);discountNinja_Script_ProductData.SaveProductDataToCache(r,f,u,t,i,null,"collection")}catch(e){return discountNinja.Logging.LogError("ProductData.SaveProductDataForCollectionProduct",e,!0),null}},Save:function(){var u,t,n,i,r,f;try{for(discountNinja.Logging.LogVerbose("Saving product data for products on page"),u=jQuery("[data-limoniapps-discountninja-product-handle]"),t=0;t<u.length;t++)discountNinja.ProductData.SaveProductDataForCollectionProduct(u[t]);if(discountNinja.Environment.Shopify.IsProductPage()&&(handle=discountNinja.Environment.Shopify.ProductHandle(),n=discountNinja.LiquidData.ProductDefaultVariantId(handle),n&&(i=discountNinja.LiquidData.Inventory(n),price=discountNinja.LiquidData.Price(n)*100,compareAtPrice=discountNinja.LiquidData.CompareAtPrice(n)*100,collections=discountNinja.LiquidData.ProductCollections(),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected product page product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,collections,!0,i,"product"))),window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.Cart.items&&window.limoniapps_discountninja_liquid.Cart.length>0)for(r=0;r<window.limoniapps_discountninja_liquid.Cart.length;r++)(handle=window.limoniapps_discountninja_liquid.Cart.items[r].handle,f=discountNinja_Script_ProductData.GetByProductHandle(handle,!0),f)||(n=discountNinja.LiquidData.ProductDefaultVariantId(handle),i=discountNinja.LiquidData.Inventory(n),price=discountNinja.LiquidData.Price(n)*100,compareAtPrice=discountNinja.LiquidData.CompareAtPrice(n)*100,discountNinja.Logging.LogVerbose("Saving product data for products on page - detected cart product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,null,!1,i,"cart"))}catch(e){return discountNinja.Logging.LogError("ProductData.Save",e,!0),null}},SaveOnAddToCart:function(n){try{var t=discountNinja.LiquidData.PriceFromCartByProductHandle(n)*100;discountNinja_Script_ProductData.SaveProductDataToCache(n,null,t,null,!1,null,"addtocart")}catch(i){return discountNinja.Logging.LogError("ProductData.Save",i,!0),null}},GetByVariant:function(n,t){try{var i=discountNinja.LiquidData.ProductHandleFromCart(n);return discountNinja_Script_ProductData.GetByProductHandle(i,t)}catch(r){return discountNinja.Logging.LogError("ProductData.Get",r,!0),null}},GetProductDataFromServer:function(n){function r(){try{var n={};return i&&(n.shop=i),t&&(n.handle=t),n}catch(r){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.GetProductDataFromServer",r,!0),null}}function u(n){try{if(!n)return;discountNinja.Logging.LogVerbose("Retrieved product data from server for product with handle: "+n.Handle);discountNinja_Script_ProductData.SaveProductDataToCache(n.Handle,n.CompareAtPrice,n.Price,n.Collections,!0,0,"server")}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.ProductDataReady",t,!0),null}}try{var i=discountNinja.Core.Shop,t=n;discountNinja.Logging.LogVerbose("Getting product data from server for product with handle: "+t);discountNinja.XmlHttpRequest.Send(discountNinja_Script_ProductData.ServerUrl()+"/api/ProductData",r(),null,"get",!0,!0,u)}catch(f){discountNinja.Logging.LogError("ProductData.GetProductDataFromServer",f,!0)}},GetByProductHandle:function(n,t,i,r){function o(n){try{if(n===null)return!1;var t=n.Source==="product",i=n.Source==="collection"&&n.CollectionsComplete;return t||i}catch(r){discountNinja.Logging.LogError("ProductData.GetByProductHandle.IsComplete",r,!0)}}var u,f,e;try{return u=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+n),f=u==="undefined"?null:JSON.parse(u),t===null&&(t=!1),e=o(f),!e&&i&&r&&(discountNinja.ProductData.SaveProductDataForCollectionProduct(r),u=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+n),f=u==="undefined"?null:JSON.parse(u),e=o(f)),t&&!e&&discountNinja_Script_ProductData.GetProductDataFromServer(n),f}catch(s){return discountNinja.Logging.LogError("ProductData.GetByProductHandle",s,!0),null}}},discountNinja_Script_PromotionEvent={ServerUrl:function(){return"https://discountninjav2-loggingapi-prod.azurewebsites.net"},PromotionEventKey:function(n,t,i){return"promotionevent-sent-"+n+"-"+t+"-"+i},GetPromotionEventSentInSession:function(n,t,i){return discountNinja.Cache.SessionGet(discountNinja_Script_PromotionEvent.PromotionEventKey(n,t,i))},SetPromotionEventSentInSession:function(n,t,i,r){discountNinja.Cache.SessionSet(discountNinja_Script_PromotionEvent.PromotionEventKey(n,t,i),r)},LogPromotionEvent:function(n,t){try{if(discountNinja.TestMode.TestMode)return;var i=n.Token,u=n.PriceRuleInfo.DiscountLevel1,r=u.DiscountCode,f=u.PriceRuleId,e=discountNinja_Script_PromotionEvent.GetPromotionEventSentInSession(i,r,t)==="sent";if(e){discountNinja.Logging.LogVerbose("Event of type "+t+" already sent for promotion with token "+i+" and discount code "+r);return}discountNinja_Script_PromotionEvent.SetPromotionEventSentInSession(i,r,t,"sent");discountNinja.Logging.LogVerbose("Logging event of type "+t)}catch(o){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent",o,!0)}}},discountNinja_Script_PromotionFlow={HandlingDrawerCartTimeoutHandle:null,HandlingDrawerCartTimeout:!1,ShowStickyBar:function(){function r(){var n="",t=discountNinja.Settings.Settings.StickyBarSettings;return t.Enabled||(n="Sticky bar is not required because that building block is disabled"),t.DisplayOnDevices!=="mobileonly"||discountNinja.Utilities.IsMobilePhone()?t.DisplayOnDevices==="desktoponly"&&discountNinja.Utilities.IsMobilePhone()&&(n="Sticky bar is not displayed on mobile phones"):n="Sticky bar is only displayed on mobile phones",discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(n,!1)}var t,i,n;if(r()){if(discountNinja.StickyBar.Clear(),t=discountNinja.Promotion.Promotions,t){for(i=0;i<t.length;i++)n=t[i],discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(discountNinja.Settings.Settings.StickyBarSettings,"","Sticky bar")===""?n.StickyBarSettings.Body||n.StickyBarSettings.TimerFooter?(discountNinja.Logging.LogVerbose("Adding sticky bar message for promotion with token "+n.Token),discountNinja.StickyBar.Add(n.Token)):discountNinja.Logging.LogVerbose("No sticky bar message for promotion with token "+n.Token):discountNinja.Logging.LogVerbose("Sticky bar message for promotion with token "+n.Token+" not added");discountNinja.StickyBar.Show()}}else discountNinja.Logging.LogVerbose("Sticky bar not added")},HideAdditionalCheckoutButtons:function(){function i(t){discountNinja.Logging.LogVerbose("Adding css :"+t);var i=document.createElement("style");i.type="text/css";i.id=n;i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t));document.getElementsByTagName("head")[0].appendChild(i)}function r(n,t){return n+" "+t}function u(n){return n+" { display: none !important; }"}function f(){return jQuery("#"+n).length===0}function e(n,t){for(var e="",o=0;o<n.length;o++)e=r(e,u(n[o]));t&&f()&&i(e)}var n="limoniapps-additionalcheckoutbuttons-style",t;discountNinja.Settings.Settings.PriceUpdateSettings.HideAdditionalCheckoutButtons&&(t=[".additional-checkout-buttons",".additional-checkout-button",".shopify-payment-button"],e(t,!0,!1));jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")},StartFlow:function(){function s(){try{var n=discountNinja.Utilities.GetMutationObserver(),t=new n(function(n){var u,f,t;try{for(u=0;u<n.length;u++)for(f=0;f<n[u].addedNodes.length;f++)if(t=n[u].addedNodes[f],t!==undefined&&t!==null&&t.nodeName!==null&&t.nodeName!==undefined&&t.nodeName.indexOf("text")===-1){var r=t.nodeName.toLowerCase(),i=jQuery(t).html(),e=jQuery("body").css("margin-top");if(r==="form"&&(discountNinja.Logging.LogVerbose("Form added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()),i!==undefined&&i!==null&&typeof i.indexOf=="function"&&(i.indexOf("<a")>-1||i.indexOf("<button")>-1)&&(i.indexOf("/checkout")>-1||i.indexOf("/cart")>-1)&&(discountNinja.Logging.LogVerbose("Anchor or button with link to checkout added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()),r==="div"&&typeof t.getAttribute=="function"&&t.getAttribute("id")==="spurit-occ-popup"&&(discountNinja.Logging.LogVerbose("Div spurit-occ-popup added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()),r==="div"&&typeof t.getAttribute=="function"&&t.getAttribute("id")==="qab_bar"&&(discountNinja.Logging.LogVerbose("Div qab_bar added"),jQuery("#qab_bar").css("top",e)),r==="div"&&typeof t.getAttribute=="function"&&t.getAttribute("id")==="fsb_background"&&(discountNinja.Logging.LogVerbose("Div fsb_background added"),discountNinja.Utilities.IsMobilePhone()||jQuery("#fsb_background").css("top",e)),r==="div"&&typeof t.getAttribute=="function"&&t.getAttribute("id")==="spb-information-bar"&&(discountNinja.Logging.LogVerbose("Div spb-information-bar added"),jQuery("#spb-information-bar").css("top",e)),r==="div"&&typeof t.getAttribute=="function"&&t.getAttribute("class")==="wheelio_holder"){discountNinja.Logging.LogVerbose("Wheelio popup added, registering hook");jQuery(".wheelio_holder .wlo_btn.wlo_copy_code").on("click",function(){discountNinja.Logging.LogVerbose("Promotion triggered via wheelio apply button");var n=jQuery(".wheelio_holder .wlo_input_code").val();discountNinja_Script_PromotionFlow.TriggerPromotion(n)})}typeof t.getAttribute=="function"&&t.getAttribute("class")&&t.getAttribute("class").indexOf("limoniapps-discountninja-cart-root")>0&&(discountNinja.Logging.LogVerbose("Cart added"),setTimeout(discountNinja.DynamicPricing.ReplacePricesInCart(),1e3));typeof t.getAttribute=="function"&&t.getAttribute("class")&&t.getAttribute("class").indexOf("limoniapps-discountninja-cart-root")>0&&(discountNinja.Logging.LogVerbose("Cart added"),setTimeout(discountNinja.DynamicPricing.ReplacePricesInCart(),1e3))}}catch(o){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements.mutationObserver",o,!0)}});t.observe(document.body,{attributes:!1,childList:!0,subtree:!0,characterData:!1})}catch(i){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements",i,!0)}}function h(n){try{discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null;discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout||(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!0,discountNinja.Logging.LogVerbose("Drawer cart modified"),n?(discountNinja.Logging.LogVerbose("Drawer cart visible, hiding sticky bar, minimizing notification and replacing prices"),discountNinja.Notification.Minimize(),discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.DynamicPricing.ReplacePricesInDrawerCart()):discountNinja.Logging.LogVerbose("Drawer cart hidden, showing sticky bar if available"),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HandleDrawerCartChange",t,!0);discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null;discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1}}function c(){var n,t;try{n=jQuery(".limoniapps-discountninja-drawercart-anchor");n.length>0&&(targetNode=n.get()[0],t=new MutationObserver(function(){var n=jQuery(targetNode).is(":visible");discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle!==null&&clearTimeout(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle);discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=setTimeout(function(){h(n)},500)}),t.observe(targetNode,{attributes:!0}))}catch(i){discountNinja.Logging.LogError("PromotionFlow.ListenForDrawerCartChanges",i,!0)}}function l(n){var t="";return t=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(n.PopUpSettings,t,"Pop-up"),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(t,!1)}function f(n){var t="",i=n.PopUpSettings;return i.Enabled||(t="Pop-up is not displayed for promotion with token "+n.Token+" because that building block is disabled for this promotion"),i.DisplayOnDevices!=="mobileonly"||discountNinja.Utilities.IsMobilePhone()?i.DisplayOnDevices==="desktoponly"&&discountNinja.Utilities.IsMobilePhone()&&(t="Pop-up is not displayed on mobile phones"):t="Pop-up is only displayed on mobile phones",discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(t,!1)}function a(n,t){try{var i=!1;if(discountNinja.Timer.ShouldStartOnDisplay(n)&&discountNinja.Timer.Start(),f(n))if(l(n))if(discountNinja_Script_PromotionFlow.HasPopUpBeenShownForLevel(n))discountNinja.Promotion.IsPromotionAccepted(n.Token,n.Frequency)?(discountNinja.Logging.LogInformation("FLOW: Skipping pop-up, pop-up already shown and accepted"),i=!0):discountNinja.Logging.LogInformation("FLOW: Stopping execution because pop-up was shown before and not accepted",!0,!1);else return discountNinja.Logging.LogInformation("FLOW: Showing pop-up"),discountNinja.PopUp.Show(n,t);else discountNinja.Logging.LogInformation("FLOW: Skipping pop-up, display not required"),i=!0;else discountNinja.Logging.LogInformation("FLOW: Skipping pop-up, not enabled"),i=!0;return i&&(discountNinja.PromotionEvent.LogPromotionEvent(n,0),discountNinja.Promotion.SetPromotionAccepted(n.Token,n.Frequency,"true"),discountNinja_Script_PromotionFlow.AcceptPromotion(n,t)),discountNinja_Script_PromotionFlow.ShowNotifications(),discountNinja_Script_PromotionFlow.StopFlow()}catch(r){discountNinja.Logging.LogError("PromotionFlow.StartFlow",r,!0)}}function v(){var t=discountNinja.Promotion.Promotions,n,i;if(t)for(n=0;n<t.length;n++)if(i=t[n],discountNinja.Promotion.PromotionIsApplicable(i)){var r=discountNinja.DiscountedCart.CartValue(i),u=discountNinja.DiscountLevel.GetCurrentDiscountLevelNumber(i,r),f=discountNinja.DiscountLevel.GetMaxDiscountLevelNumber(i.PriceRuleInfo);u!==f&&discountNinja.Promotion.UnApply(t[n].Token)}else discountNinja.Promotion.Stop(t[n].Token)}function e(){discountNinja.Logging.LogInformation("FLOW: Waiting for trigger conditions to be met");discountNinja.Trigger.PromotionTriggerConditionsMet(n)?(discountNinja.Logging.LogInformation("FLOW: Trigger conditions met, displaying promotion"),u!==null&&clearTimeout(u),a(n,t)):(discountNinja.DynamicPricing.UnblockPricesAndButtons(),u=setTimeout(function(){e()},500))}var y,n,o,t,i,r,u;try{if(y=!1,!discountNinja.Settings.Settings){discountNinja.Logging.LogInformation("FLOW: Canceling since no settings are available");return}if(discountNinja.Logging.LogInformation("FLOW: Starting flow"),discountNinja.Environment.Shopify.IsCartPage()||discountNinja.VariantChange.RegisterEventHandlerForVariantChange(),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),discountNinja.Cart.Shopify.RegisterEventHandlerForAddToCart(),v(),discountNinja.DynamicPricing.UpdatePrice(),s(),c(),discountNinja.Trigger.MarkPageAsVisited(),discountNinja_Script_PromotionFlow.ShowStickyBar(),discountNinja.Promotion.SetPrimaryPromotion(),n=discountNinja.Promotion.PrimaryPromotion,n===null)return discountNinja.Logging.LogInformation("No valid applicable promotion",!1),discountNinja.Timer.IsTimerStarted()&&discountNinja.Timer.Start(),o=discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString(),o!==""&&discountNinja_Script_PromotionFlow.HideAdditionalCheckoutButtons(),discountNinja_Script_PromotionFlow.ShowNotifications(),discountNinja_Script_PromotionFlow.StopFlow();for(discountNinja_Script_PromotionFlow.ViewPromotion(n),discountNinja_Script_PromotionFlow.HideAdditionalCheckoutButtons(),discountNinja.Timer.ShouldNotStart(n)&&discountNinja.Timer.Stop(),n!==null&&f(n)&&discountNinja.PopUp.InjectHtml(n,t),t=discountNinja.DiscountedProduct.GetFromProductPage(),i=0;i<discountNinja.Promotion.Promotions.length;i++)r=discountNinja.Promotion.Promotions[i],r.Token!==discountNinja.Promotion.PrimaryPromotion.Token&&(discountNinja_Script_PromotionFlow.ViewPromotion(r),discountNinja_Script_PromotionFlow.AcceptPromotion(r,t));discountNinja.DiscountCode.InjectDiscountCodesInHtml();u=null;e()}catch(p){discountNinja.Logging.LogError("PromotionFlow.StartFlow",p,!0)}},IsNotificationRequired:function(){var n="",t=discountNinja.Settings.Settings.NotificationSettings;return t.Enabled||(n="Notification is not required because that building block is disabled"),t.DisplayOnDevices!=="mobileonly"||discountNinja.Utilities.IsMobilePhone()?t.DisplayOnDevices==="desktoponly"&&discountNinja.Utilities.IsMobilePhone()&&(n="Notification is not displayed on mobile phones"):n="Notification is only displayed on mobile phones",n===""&&(n=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(t,n,"Notification")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(n,!1)},ViewPromotion:function(n){discountNinja.Logging.LogInformation("FLOW: Viewing promotion");discountNinja.PromotionEvent.LogPromotionEvent(n,0)},AcceptPromotion:function(n,t){var r,u,f,i;try{discountNinja.Logging.LogInformation("FLOW: Accepting promotion");r=discountNinja.Promotion.GetPromotionDiscountCode(n);u=discountNinja.Promotion.GetPromotionPriceRule(n);discountNinja.Promotion.SetPromotionAccepted(n.Token,n.Frequency,"true");discountNinja.Promotion.SaveToCache(n);f=discountNinja.DiscountedCart.CartValue(n);i=discountNinja.DiscountLevel.GetCurrentDiscountLevelNumber(n,f);i!==null&&i>0&&discountNinja_Script_PromotionFlow.ApplyPromotion(n,t,r,u)}catch(e){discountNinja.Logging.LogError("PromotionFlow.AcceptPromotion",e,!0)}},ApplyPromotion:function(n,t,i,r){try{discountNinja.Logging.LogInformation("FLOW: Applying promotion");discountNinja.DiscountCode.Add(n.Token,i,r,n.PriceRuleInfo.TargetType);var u=discountNinja.DiscountLevel.GoalAchieved(n);discountNinja.Timer.ShouldStartOnAccept(n)?discountNinja.Timer.Start():discountNinja.Timer.ShouldStartOnGoalAchieved(n)&&u&&discountNinja.Timer.Start();u&&discountNinja.Promotion.PrimaryPromotion&&discountNinja.Promotion.PrimaryPromotion.BogoSettings&&discountNinja.Promotion.PrimaryPromotion.BogoSettings.AddToCartAutomatically&&discountNinja.Cart.Shopify.AddToCart(20506900463719,discountNinja.Promotion.PrimaryPromotion.BogoSettings.EntitledQuantity,discountNinja.Promotion.PrimaryPromotion.BogoSettings.AllocationLimit);n.NotificationSettings.Body?(discountNinja.Logging.LogVerbose("Adding notification message for promotion with token "+n.Token),discountNinja.Notification.Add(n.Token,t)):discountNinja.Logging.LogVerbose("No notification message for promotion with token "+n.Token);discountNinja.DynamicPricing.UpdatePrice();jQuery("body .mega-menu-price").length>0&&(discountNinja.Logging.LogVerbose("Mega menu prices detected"),setTimeout(function(){discountNinja.Logging.LogVerbose("Updating price for mega menu");discountNinja.DynamicPricing.UpdatePrice()},2e3));discountNinja.ShortCode.ShowShortcodePlaceholders();discountNinja_Script_PromotionFlow.ShowStickyBar();discountNinja.PromotionEvent.LogPromotionEvent(n,1)}catch(f){discountNinja.Logging.LogError("PromotionFlow.ApplyPromotion",f,!0)}},ShowNotifications:function(){try{if(discountNinja.Promotion.Promotions===null||discountNinja.Promotion.Promotions.length<1)return;discountNinja_Script_PromotionFlow.IsNotificationRequired()&&discountNinja.Notification.Show();discountNinja.TestMode.ShowTestModeOutput()}catch(n){discountNinja.Logging.LogError("PromotionFlow.ShowNotifications",n,!0)}},StopFlow:function(){discountNinja.Logging.LogInformation("FLOW: Stopped",!0,!1);discountNinja.DiscountCode.InjectDiscountCodesInHtml();discountNinja.DynamicPricing.ReplacePricesInCart();discountNinja.DynamicPricing.UnblockPricesAndButtons();discountNinja.Checkout.Shopify.PrepareDraftOrder()},IsBuildingBlockEnabledForPage:function(n,t,i){return t!==""||n.Enabled||(t=i+" is disabled"),t===""&&discountNinja.Environment.Shopify.IsProductPage()&&!n.ShowOn.ShowOnProductPages&&(t=i+" is not displayed because it is disabled for product pages"),t===""&&discountNinja.Environment.Shopify.IsHomePage()&&!n.ShowOn.ShowOnHomePage&&(t=i+" is not displayed because it is disabled for the home page"),t===""&&discountNinja.Environment.Shopify.IsBlogPost()&&!n.ShowOn.ShowOnBlogPosts&&(t=i+" is not displayed because it is disabled for blog posts"),t===""&&discountNinja.Environment.Shopify.IsCollectionPage()&&!n.ShowOn.ShowOnCollectionPages&&(t=i+" is not displayed because it is disabled for collection pages"),t===""&&discountNinja.Environment.Shopify.IsCustomPage()&&!n.ShowOn.ShowOnCustomPages&&(t=i+" is not displayed because it is disabled for custom pages"),t===""&&discountNinja.Environment.Shopify.IsCartPage()&&!n.ShowOn.ShowOnCartPage&&(t=i+" is not displayed because it is disabled for cart page"),t},HandleFlowErrorMessage:function(n,t){return n&&n!==""?(t?discountNinja.Logging.LogTestMode(n,null,!0,!1,!1):discountNinja.Logging.LogVerbose(n),!1):!0},HasPopUpBeenShownForLevel:function(n){function i(n){return discountNinja.Cache.LocalGet("popup-displayed-"+n)}function r(n){return discountNinja.Cache.SessionGet("popup-displayed-"+n)}var t=n.Token;return i(t)==="shown"&&n.PopUpSettings.Frequency==="onceperdevice"?(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for promotion with token "+t+", because it has already been shown on this device. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here<\/a>."),!0):r(t)==="shown"&&n.PopUpSettings.Frequency==="oncepersession"?(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for promotion with token "+t+", because it has already been shown during this session. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here<\/a>."),!0):!1}},discountNinja_Script_Settings={Settings:null,GetCurrencyFormat:function(){try{return discountNinja_Script_Settings.Settings.CurrencySettings.MoneyFormat===null?'<span class="money">{{amount}}<\/span>':discountNinja_Script_Settings.Settings.CurrencySettings.MoneyFormat}catch(n){return discountNinja.Logging.LogError("DiscountedCart.GetCurrencyFormat",n,!0),""}},GetPriceFormat:function(n){return n==="item-product"?discountNinja.Environment.Shopify.IsCartPage()?discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartProductPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartProductPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:n==="item-line"?discountNinja.Environment.Shopify.IsCartPage()?discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartLinePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartLinePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:n==="subtotal"?discountNinja.Environment.Shopify.IsCartPage()?discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartSubtotalPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartSubtotalPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:n==="standard"?discountNinja.Environment.Shopify.IsProductPage()?discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.NonProductPagePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.OtherPagePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat},SettingsAreValid:function(n){try{return n===null||typeof n=="undefined"?(discountNinja.Logging.LogWarning("No settings available",!0,!0),!1):(discountNinja.Logging.LogVerbose("Settings valid"),!0)}catch(t){discountNinja.Logging.LogError("Settings.SettingsAreValid",t,!0)}}},discountNinja_Script_ShortCode={HideShortcodePlaceholders:function(){try{jQuery(".limoniapps-discountninja-shortcodeplaceholder").css("display","none")}catch(n){discountNinja.Logging.LogError("ShortCode.HideShortcodePlaceholders",n,!0)}},ShowShortcodePlaceholders:function(){try{jQuery(".limoniapps-discountninja-shortcodeplaceholder").each(function(){jQuery(this).html(discountNinja_Script_ShortCode.ReplaceAllPlaceHolders(jQuery(this).html()))});jQuery(".limoniapps-discountninja-shortcodeplaceholder").css("display","block")}catch(n){discountNinja.Logging.LogError("ShortCode.ShowShortcodePlaceholders",n,!0)}},RefreshResolvedPlaceholders:function(n,t,i){try{discountNinja.Logging.LogVerbose("Refreshing all resolved placeholders");jQuery(n).find("[data-limoniapps-discountninja-shortcode-product]").each(function(){var n="{{"+jQuery(this).attr("data-limoniapps-discountninja-shortcode-product")+"}}";discountNinja.Logging.LogVerbose("Refreshing shortcode "+n);jQuery(this).html(discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(n,i,!1))});jQuery(n).find("[data-limoniapps-discountninja-shortcode-promotion]").each(function(){var n="{{"+jQuery(this).attr("data-limoniapps-discountninja-shortcode-promotion")+"}}";discountNinja.Logging.LogVerbose("Refreshing shortcode "+n);jQuery(this).html(discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(t,n,!1))});discountNinja.MultiCurrency.UpdateCurrency()}catch(r){discountNinja.Logging.LogError("ShortCode.RefreshResolvedPlaceholders",r,!0)}},BuildResolvedPlaceHolderAmount:function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function w(n,t){return t?"{{"+n.replace("{{","").replace("}}","")+","+t+"}}":n}function p(n,t,i,r,u,f,e,o,s,h,c,l,v,y,p,b){var k=w(i,r);return discountNinja_Script_ShortCode.ContainsPlaceHolder(n,k)&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,k,f,e,discountNinja.Utilities.FormatMoney(o,s,v,y,u,b),a,p,!0,u),u||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,"<del>"+k+"<\/del>",f,e,discountNinja.Utilities.FormatMoney(o,h,v,y,!0,b),a,p,!0,u)),u||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,"<strike>"+k+"<\/strike>",e,f,discountNinja.Utilities.FormatMoney(o,h,v,y,!0,b),a,p,!0,u)),u||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,"<s>"+k+"<\/s>",e,f,discountNinja.Utilities.FormatMoney(o,h,v,y,!0,b),a,p,!0,u))),n}try{return discountNinja_Script_ShortCode.ContainsPlaceHolder(n,i)&&(n=p(n,t,i,"",!1,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"NO_DECIMALS",!1,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"NO_CURRENCY",!1,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"NO_DECIMALS,NO_CURRENCY",!1,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"STRIKETHROUGH",!0,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"STRIKETHROUGH,NO_DECIMALS",!0,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"STRIKETHROUGH,NO_CURRENCY",!0,r,u,f,e,o,s,h,c,l,v,y),n=p(n,t,i,"STRIKETHROUGH,NO_DECIMALS,NO_CURRENCY",!0,r,u,f,e,o,s,h,c,l,v,y)),n}catch(b){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderAmount",b,!0),n}},BuildResolvedPlaceHolder:function(n,t,i,r,u,f,e,o,s,h){var c="",l;if(e){var a=s?" money":"",v=h?" limoniapps-discountninja-strikethrough":"",y=u===undefined||u===null?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+u+a+v+'" ',p=e===undefined||e===null?"":e+" ";c=t?"<span "+y+p+"data-limoniapps-discountninja-shortcode-"+r+'="'+i.replace("{{","").replace("}}","")+'">'+f+"<\/span>":f}else{var w=s?" money":"",b=h?" limoniapps-discountninja-strikethrough":"",k=o===undefined||o===null?"":" "+o,d=u===undefined||u===null?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+u+w+b+k+'" ';c=t?"<span "+d+"data-limoniapps-discountninja-shortcode-"+r+'="'+i.replace("{{","").replace("}}","")+'">'+f+"<\/span>":f}return l=c.replace("$","$$$"),discountNinja.Logging.LogVerbose("--- SHORTCODE --- Replacing shortcode "+i+" with "+l),n.replace(new RegExp(i,"g"),l)},ReplacePromotionLevelPlaceHolders:function(n,t,i){var p,w,c,b,a,f,r,l,v,ft;try{if(typeof t=="undefined"||t===""||t===null)return t;discountNinja.Logging.LogVerbose("Replacing promotion level placeholders");var y=discountNinja.Settings.Settings.TimerSettings,et=discountNinja.Settings.Settings.HereLabel||"here",u=discountNinja.Settings.GetCurrencyFormat(),e=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(u),o=discountNinja.Utilities.GetCurrencyFormatAmountComponent(u),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(e),h=2,k=y.FormattingTemplateOnDate,d=y.FormattingTemplateOnTime,g="",nt="",tt=n.ScheduleSettings.EndsOnDate;tt&&(p=moment(tt).utc(),g=discountNinja.Timer.FormatDate(p,k),nt=discountNinja.Timer.FormatDate(p,d));var it="",rt="",ut=n.PriceRuleInfo.EndsAt;return ut&&(w=moment(ut).utc(),it=discountNinja.Timer.FormatDate(w,k),rt=discountNinja.Timer.FormatDate(w,d)),c=0,discountNinja.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.total_discount&&(c=discountNinja.DiscountedCart.DiscountedCart.total_discount*100),b=0,a=0,window.limoniapps_discountninja_liquid&&window.limoniapps_discountninja_liquid.Cart&&window.limoniapps_discountninja_liquid.total_price&&(a=window.limoniapps_discountninja_liquid.total_price),c>0&&a>0&&(b=c/a),f=discountNinja.DiscountLevel.GetCurrentDiscountLevel(n),f===null&&(f=n.PriceRuleInfo.DiscountLevel1),r=discountNinja.DiscountLevel.GetGoalDiscountLevel(n),r===null&&(f=n.PriceRuleInfo.DiscountLevel1),l=0,v=0,r&&r.CartValueMinimum>0&&(v=r.CartValueMinimum,ft=discountNinja.DiscountedCart.CartValue(n),l=(v*100-ft)/100,l<0&&(l=0)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{MINIMUM_CART_VALUE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{MINIMUM_CART_VALUE}}","promotion","minimum_cart_value",v*100,u,e,o,s,h,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"AMOUNT_LEFT_BEFORE_DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{AMOUNT_LEFT_BEFORE_DISCOUNT}}","promotion","amountleft_before_discount",l*100,u,e,o,s,h,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{DISCOUNT_CODE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{DISCOUNT_CODE}}","promotion","code",discountNinja.Promotion.GetPromotionDiscountCode(n))),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{ENDS_AT_DATE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{ENDS_AT_DATE}}","promotion","ends_at_date",g)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{ENDS_AT_TIME}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{ENDS_AT_TIME}}","promotion","ends_at_time",nt)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{EXPIRES_AT_DATE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{EXPIRES_AT_DATE}}","promotion","expires_at_date",it)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{EXPIRES_AT_TIME}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{EXPIRES_AT_TIME}}","promotion","expires_at_time",rt)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{TARGET_LINK}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{TARGET_LINK}}","promotion","target_link","<a class='limoniapps-targetlink' href='"+n.TargetLink+"'>"+et+"<\/a>")),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"TOTAL_DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{TOTAL_DISCOUNT_AMOUNT}}","promotion","total_discount_amount",c,u,e,o,s,h,!1,null,null,!0)),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"TOTAL_DISCOUNT_PERCENTAGE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{TOTAL_DISCOUNT_PERCENTAGE}}","promotion","total_discount_percentage",discountNinja.Utilities.FormatPercentage(b,0)+"%")),f&&(discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{DISCOUNT_PERCENTAGE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{DISCOUNT_PERCENTAGE}}","promotion","discount_percentage",discountNinja.Utilities.FormatPercentage(f.Percentage,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{DISCOUNT_AMOUNT}}","promotion","discount_amount",f.Amount*100,u,e,o,s,h,!1,null,null,!0)),n&&n.PriceRuleInfo.ValueType==="percentage"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{DISCOUNT}}","promotion","discount",discountNinja.Utilities.FormatPercentage(f.Percentage,0)+"%")),n&&n.PriceRuleInfo.ValueType==="fixed_amount"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{DISCOUNT}}","promotion","discount",f.Amount*100,u,e,o,s,h,!1,null,null,!0))),r&&(discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}","promotion","next_goal_discount_percentage",discountNinja.Utilities.FormatPercentage(r.Percentage,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"NEXT_GOAL_DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{NEXT_GOAL_DISCOUNT_AMOUNT}}","promotion","next_goal_discount_amount",r.Amount*100,u,e,o,s,h,!1,null,null,!0)),n&&n.PriceRuleInfo.ValueType==="percentage"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"NEXT_GOAL_DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,"{{NEXT_GOAL_DISCOUNT}}","promotion","next_goal_discount",discountNinja.Utilities.FormatPercentage(r.Percentage,0)+"%")),n&&n.PriceRuleInfo.ValueType==="fixed_amount"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"NEXT_GOAL_DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,"{{NEXT_GOAL_DISCOUNT}}","promotion","next_goal_discount",r.Amount*100,u,e,o,s,h,!1,null,null,!0))),y.Enabled===!0&&(t=t.replace(/{{TIMER}}/g,'<span class="limoniapps-discountninja-timer"><\/span>')),t}catch(ot){return discountNinja.Logging.LogError("ShortCode.ReplacePromotionLevelPlaceHolders",ot,!0),t}},ReplaceProductLevelPlaceHolders:function(n,t,i,r){function h(n,t,i,r){var u=n?"color: "+n+" !important;":"",f=t?"font-size: "+t+"px !important;":"",e=i?"font-weight: "+i+" !important;":"",o=r?r+";":"";return' style="'+u+f+e+o+'" '}function y(n){return h(discountNinja.Settings.GetPriceFormat(n).DiscountedPriceColor,discountNinja.Settings.GetPriceFormat(n).DiscountedPriceFontSize,discountNinja.Settings.GetPriceFormat(n).DiscountedPriceFontWeight,discountNinja.Settings.GetPriceFormat(n).DiscountedPriceCustomCss)}function p(n){return h(discountNinja.Settings.GetPriceFormat(n).OriginalPriceColor,discountNinja.Settings.GetPriceFormat(n).OriginalPriceFontSize,discountNinja.Settings.GetPriceFormat(n).OriginalPriceFontWeight,discountNinja.Settings.GetPriceFormat(n).OriginalPriceCustomCss)}try{if(r||(r="standard"),typeof n=="undefined"||n===""||n===null)return n;discountNinja.Logging.LogVerbose("Replacing product level placeholders");var u=discountNinja.Settings.GetCurrencyFormat(),f=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(u),e=discountNinja.Utilities.GetCurrencyFormatAmountComponent(u),o=discountNinja.Utilities.GetCurrencyFormatAmountComponent(f),s=2,c=y(r),l=p(r),a=discountNinja.Settings.GetPriceFormat(r).DiscountedPriceCssClasses,v=discountNinja.Settings.GetPriceFormat(r).OriginalPriceCssClasses;return t&&typeof t.CompareAtAmount!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"AMOUNT_COMPAREAT")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{AMOUNT_COMPAREAT}}","product","amount_compareat",t.CompareAtAmount*100,u,f,e,o,s,!1,null,null,!0)),t&&typeof t.DiscountedPrice!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNTED_PRICE")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{DISCOUNTED_PRICE}}","product","discounted_price",t.DiscountedPrice*100,u,f,e,o,s,!1,c,a,!0)),t&&typeof t.OriginalPrice!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"ORIGINAL_PRICE")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{ORIGINAL_PRICE}}","product","original_price",t.OriginalPrice*100,u,f,e,o,s,!1,l,v,!0)),t&&typeof t.OriginalCompareAtPrice!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"ORIGINAL_COMPAREAT_PRICE")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{ORIGINAL_COMPAREAT_PRICE}}","original_compareat_price","amount",t.OriginalCompareAtPrice*100,u,f,e,o,s,!1,l,v,!0)),t&&typeof t.DiscountedPrice!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}","product","discounted_price_afterpay_installment",t.DiscountedPrice*25,u,f,e,o,s,!1,c,a,!0)),t&&typeof t.Amount!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNT_AMOUNT")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{DISCOUNT_AMOUNT}}","product","discount_amount",t.Amount*100,u,f,e,o,s,!1,null,null,!0)),t&&typeof t.Percentage!="undefined"&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNT_PERCENTAGE")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,i,"{{DISCOUNT_PERCENTAGE}}","product","discount_percentage",discountNinja.Utilities.FormatPercentage(t.Percentage,0)+"%")),t&&typeof t.Percentage!="undefined"&&t.Percentage>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNT")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,i,"{{DISCOUNT}}","product","discount",discountNinja.Utilities.FormatPercentage(t.Percentage,0)+"%")),t&&typeof t.Amount!="undefined"&&t.Amount>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"DISCOUNT")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(n,i,"{{DISCOUNT}}","product","discount",t.Amount*100,u,f,e,o,s,!1,null,null,!0)),n}catch(w){discountNinja.Logging.LogError("ShortCode.ReplaceProductLevelPlaceHolders",w,!0)}},ContainsPlaceHolder:function(n,t){try{return n===""||n===null||n===undefined?!1:n.indexOf(t.replace("{{","").replace("}}",""))>-1}catch(i){return!1}},ReplaceAllPlaceHolders:function(n,t,i,r){function u(n,t){try{if(n===""||n===null||n===undefined)return n;if(discountNinja.Logging.LogVerbose("Replacing settings level placeholders"),discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"{{CURRENCY}}")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,"{{CURRENCY}}","promotion","currency",discountNinja.Settings.Settings.CurrencySettings.BaseCurrency)),discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"{{CURRENCY_SYMBOL}}")&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,t,"{{CURRENCY_SYMBOL}}","promotion","currency_symbol",discountNinja.Settings.Settings.CurrencySettings.BaseCurrencySymbol)),n=n.replace(/{{NEW_LINE}}/g,"<br>"),discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"{{OFFER_COUNT}}")){var i=discountNinja.Notification.GetFromCache()||[];n=n.replace(/{{OFFER_COUNT}}/g,i.length)}return n}catch(r){return discountNinja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",r,!0),n}}return t=u(t,!0),i&&(t=discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(t,i,!0,r)),n&&(t=discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(n,t,!0)),t}},discountNinja_Script_TabReminder={Set:function(){function n(){try{if(!discountNinja.DynamicPricing.HasActiveDiscountCode())return;var t=discountNinja.Cache.SessionGet("tabtitle");t===null&&(t=document.title,discountNinja.Cache.SessionSet("tabtitle",t));document.visibilityState==="visible"&&discountNinja.Cache.SessionSet("toggletabtitle","off");discountNinja.Cache.SessionGet("toggletabtitle")==="on-state1"?(document.title="âœ‹ Promotion active! "+t,discountNinja.Cache.SessionSet("toggletabtitle","on-state2"),setTimeout(function(){n()},2500)):discountNinja.Cache.SessionGet("toggletabtitle")==="on-state2"?(document.title="â˜ž Don't forget! "+t,discountNinja.Cache.SessionSet("toggletabtitle","on-state3"),setTimeout(function(){n()},2500)):discountNinja.Cache.SessionGet("toggletabtitle")==="on-state3"?(document.title="â˜Ÿ Collect discount! "+t,discountNinja.Cache.SessionSet("toggletabtitle","on-state4"),setTimeout(function(){n()},2500)):discountNinja.Cache.SessionGet("toggletabtitle")==="on-state4"&&(document.title=t,discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),setTimeout(function(){n()},5e3))}catch(i){discountNinja.Logging.LogError("TabReminder.ToggleTabReminder",i,!0)}}try{var t=discountNinja.Cache.SessionGet("toggletabtitle");(t===null||t==="off")&&(discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),n())}catch(i){discountNinja.Logging.LogError("TabReminder.Set",i,!0)}},Remove:function(){try{discountNinja.Cache.SessionSet("toggletabtitle","off");var n=discountNinja.Cache.SessionGet("tabtitle");n!==null&&(document.title=n)}catch(t){discountNinja.Logging.LogError("TabReminder.Remove",t,!0)}}},discountNinja_Script_TestMode={TestModeDynamicStylesAdded:!1,TestMode:!1,TestModeOutput:[],TestModeOutputIssue:!1,ShowTestModeOutput:function(){function n(n){try{LimoniAppsLoadJQueryNotify(function(){jQuery(".alert-limoniapps-notification-testmodeoutput").remove();var t=jQuery.notify({icon:"fa fa-info-circle",title:"Discount Ninja<br>Test mode output",message:n},{type:"limoniapps-notification-testmodeoutput",placement:{from:"top",align:"left"},delay:0,animate:{enter:"animate fadeInBottom",exit:"animate fadeOutBottom"}}),i=jQuery(t)[0].$ele;i!==undefined||discountNinja.Logging.LogVerbose("Cannot show test output, Bootstrap Notify may not be registered correctly")})}catch(t){discountNinja.Logging.LogError("TestMode.ShowTestModeNotificationMessage",t,!0)}}function t(n,t){var i="",r;if(n===null||t===!1)i=i+"<br/><span style='color:green;'><i class='fa fa-thumbs-o-up' aria-hidden='true'><\/i> No issues found<\/span>";else for(i="<br/><strong>Remarks:<\/strong><br>",r=0;r<n.length;r++)i=i+n[r];return i+"<br/><span style='font-size:14px;'><strong>Note<\/strong> This message is not visible for your visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/test-mode-output' target='_blank'>here<\/a>.<\/span>"}try{if(discountNinja_Script_TestMode.TestMode===!1)return;var i=t(discountNinja_Script_TestMode.TestModeOutput,discountNinja_Script_TestMode.TestModeOutputIssue);discountNinja_Script_TestMode.TestModeOutput=[];n(i)}catch(r){discountNinja.Logging.LogError("TestMode.ShowTestModeOutput",r,!0)}},HandleQueryParameter:function(){discountNinja.QueryParameter.Get("discountninjatestmode")?(discountNinja_Script_TestMode.TestMode=!0,discountNinja.Cache.Clear(),discountNinja.Cache.SessionSet("discountninjatestmode",!0),discountNinja.QueryParameter.Remove("discountninjatestmode")):discountNinja_Script_TestMode.TestMode=discountNinja.Cache.SessionGet("discountninjatestmode")?!0:!1}},discountNinja_Script_Token={GetTokenFromQueryParameter:function(){try{var n=discountNinja.QueryParameter.Get("token");return n?n.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromQueryParameter",t,!0),""}},GetTokenFromPromotionOrQueryParameter:function(n){try{var t=null;return n=n||discountNinja.Promotion.PrimaryPromotion,n&&(t=n?n.Token:null),t===null&&(t=discountNinja_Script_Token.GetTokenFromQueryParameter()),t?t.toUpperCase():""}catch(i){return discountNinja.Logging.LogError("Token.GetTokenFromPromotionOrQueryParameter ",i,!1),""}},GetCartToken:function(n){try{var t=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(n);return(t===null||t==="")&&(t=discountNinja_Script_Token.GetCartTokenFromLocalStorage()),t?t.toUpperCase():""}catch(i){return discountNinja.Logging.LogError("Token.GetCartToken ",i,!1),""}},GetNonAutomaticToken:function(n){try{var t=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(n);return(t===null||t==="")&&(t=discountNinja_Script_Token.GetNonAutomaticTokenFromSession()),t?t.toUpperCase():""}catch(i){return discountNinja.Logging.LogError("Token.GetNonAutomaticToken ",i,!1),""}},GetToken:function(n){try{var t=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(n);return(t===null||t==="")&&(t=discountNinja_Script_Token.GetTokenFromLocalStorage()),t?t.toUpperCase():""}catch(i){return discountNinja.Logging.LogError("Token.GetToken ",i,!1),""}},GetTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-device")},SetTokenInLocalStorage:function(n){discountNinja.Cache.LocalSet("token-device",n)},RemoveCartTokenFromLocalStorage:function(){discountNinja.Cache.LocalRemove("token-cart-device")},GetCartTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-cart-device")},SetCartTokenInLocalStorage:function(n){discountNinja.Cache.LocalSet("token-cart-device",n)},GetNonAutomaticTokenFromSession:function(){return discountNinja.Cache.SessionGet("token-non-automatic-session")},SetNonAutomaticTokenInSession:function(n){discountNinja.Cache.SessionSet("token-non-automatic-session",n)}},discountNinja_Script_Trigger={IntializeTimeOnPageCounter:function(){try{discountNinja.Cache.SessionSet("trigger-time-on-page",0);discountNinja_Script_Trigger.TimeOnPageCounterIntervalId!==null&&discountNinja_Script_Trigger.TimeOnPageCounterIntervalId!==0&&clearInterval(discountNinja_Script_Trigger.TimeOnPageCounterIntervalId);discountNinja_Script_Trigger.TimeOnPageCounterIntervalId=window.setInterval(function(){var n=discountNinja.Cache.SessionGet("trigger-time-on-page");n=!n||isNaN(n)?0:parseInt(n);discountNinja.Cache.SessionSet("trigger-time-on-page",n+1)},1e3)}catch(n){discountNinja.Logging.LogError("Trigger.IntializeTimeOnPageCounter",n,!0)}},TrackExitIntent:function(){var n,t;try{discountNinja.Cache.SessionSet("trigger-exit-intent","false");n=discountNinja.Settings.Settings.GeneralSettings.ExitIntentMode;n||(n="default");t=ouibounce(!1,{aggressive:!0,timer:n==="aggressive"?0:1e3,delay:n==="aggressive"?150:0,sensitivity:n==="aggressive"?80:20,callback:function(){discountNinja.Logging.LogVerbose("Exit intent detected");discountNinja.Cache.SessionSet("trigger-exit-intent","true")}})}catch(i){discountNinja.Logging.LogError("Trigger.TrackExitIntent",i,!0)}},TrackScrollPercentage:function(){function n(){var n;try{if(n=discountNinja.Cache.SessionGet("trigger-scroll-percentage"),n===100)return;var i=jQuery(window).height(),r=jQuery(document).height(),u=jQuery(window).scrollTop(),f=r-i,t=Math.floor(u/f*100);t>n&&discountNinja.Cache.SessionSet("trigger-scroll-percentage",t)}catch(e){return 0}}try{discountNinja.Cache.SessionSet("trigger-scroll-percentage",0);jQuery(window).on("scroll",function(){n()});n()}catch(t){discountNinja.Logging.LogError("Trigger.TrackScrollPercentage",t,!0)}},MarkPageAsVisited:function(){var n,t;try{n=discountNinja.Cache.SessionGet("trigger-pages-visited-list");n=n===null?[]:n.split(",");jQuery.inArray(window.location.pathname,n)===-1&&n.push(window.location.pathname);t=n.length;discountNinja.Cache.SessionSet("trigger-pages-visited",t);discountNinja.Logging.LogVerbose("Pages visited: "+t)}catch(i){discountNinja.Logging.LogError("Trigger.MarkPageAsVisited",i,!0)}},PromotionTriggersOnPage:function(n){try{if(!n.PopUpSettings.Enabled)return!0;var t=discountNinja.PromotionFlow.IsBuildingBlockEnabledForPage(n.PopUpSettings,"","Pop-up"),i=discountNinja.PromotionFlow.HandleFlowErrorMessage(t);if(!i)return!1;if(discountNinja.Environment.Shopify.IsCustomPage()&&n.PopUpSettings.Enabled)return n.PopUpSettings.ShowOn.ShowOnCustomPages?n.TriggerSettings.CustomPagesIncluded==="custom"&&!discountNinja.Utilities.StringIsIn(n.TriggerSettings.CustomPageContains,discountNinja.Environment.Shopify.CustomPageHandle())?(discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current custom page is not in the set of pages to include",null,!0,!0,!1),!1):!0:!1;if(discountNinja.Environment.Shopify.IsBlogPost()&&n.PopUpSettings.Enabled){if(!n.PopUpSettings.ShowOn.ShowOnBlogPosts)return!1;if(n.TriggerSettings.BlogPostsIncluded!=="blogequals"||discountNinja.Utilities.StringIsIn(n.TriggerSettings.BlogEquals,discountNinja.Environment.Shopify.BlogHandle()))if(n.TriggerSettings.BlogPostsIncluded!=="postcontains"||discountNinja.Utilities.StringIsIn(n.TriggerSettings.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle())){if(n.TriggerSettings.BlogPostsIncluded==="blogandpostcontains"&&!discountNinja.Utilities.StringIsIn(n.TriggerSettings.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle())&&!discountNinja.Utilities.StringIsIn(n.TriggerSettings.BlogEquals,discountNinja.Environment.Shopify.BlogHandle()))return discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1}else return discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1;else return discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current blog is not in the set of blogs to include",null,!0,!0,!1),!1;return!0}if(discountNinja.Environment.Shopify.IsCollectionPage()&&n.PopUpSettings.Enabled){if(!n.PopUpSettings.ShowOn.ShowOnCollectionPages)return!1;if(n.TriggerSettings.TargetCollectionHandleMode!=="overrideinclude"||discountNinja.Utilities.StringIsIn(n.TriggerSettings.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())){if(n.TriggerSettings.TargetCollectionHandleMode==="overrideexclude"&&discountNinja.Utilities.StringIsIn(n.TriggerSettings.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle()))return discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current collection page is in the set of overriden collections to exclude",null,!0,!0,!1),!1}else return discountNinja.Logging.LogTestMode("Promotion will not be displayed because the current collection page is not in the set of overriden collections to include",null,!0,!0,!1),!1;return!0}return!0}catch(r){discountNinja.Logging.LogError("Promotion.PromotionTriggersOnPage",r,!0)}},PromotionTriggerConditionsMet:function(n){function s(n){var i=n.TriggerSettings.TimeOnPageInSeconds,t=discountNinja.Cache.SessionGet("trigger-time-on-page");if(t&&!isNaN(t))return t>=i}function h(n){var i=n.TriggerSettings.ScrollPercentage,t=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(t&&!isNaN(t))return t>=i}function c(n){var i=n.TriggerSettings.PagesVisited,t=discountNinja.Cache.SessionGet("trigger-pages-visited");if(t&&!isNaN(t))return t>=i}function l(){if(discountNinja.Utilities.IsMobilePhone())return!0;var n=discountNinja.Cache.SessionGet("trigger-exit-intent");return n==="true"}var r,t,i;try{if((r=discountNinja.Cache.SessionGet("trigger-conditions-met-"+n.Token),r==="true")||discountNinja.PromotionFlow.HasPopUpBeenShownForLevel(n)||(t=n.TriggerSettings,!t))return!0;var u=t.ScrollPercentage!==null&&t.ScrollPercentage!==undefined&&t.ScrollPercentage!==!1,f=t.PagesVisited!==null&&t.PagesVisited!==undefined&&t.PagesVisited!==!1,e=t.OnExitIntent!==null&&t.OnExitIntent!==undefined&&t.OnExitIntent!==!1,o=t.TimeOnPageInSeconds!==null&&t.TimeOnPageInSeconds!==undefined&&t.TimeOnPageInSeconds!==!1;return!u&&!f&&!e&&!o?!0:(i=!1,o&&s(n)&&(i=!0),!i&&u&&h(n)&&(i=!0),!i&&f&&c(n)&&(i=!0),!i&&e&&l(n)&&(i=!0),discountNinja.Cache.SessionSet("trigger-conditions-met-"+n.Token,i),i)}catch(a){discountNinja.Logging.LogError("Trigger.PromotionTriggerConditionsMet",a,!0)}}},discountNinja_Script_Cart_Shopify={IsDirty:!0,UpdateCart:function(n){function i(n){var i=discountNinja.LiquidData.Cart(),t;if(!i||!n||i.total_price!==n.total_price||i.items.length!==n.items.length)return!0;for(t=0;t<n.items.length;t++)if(i.items[t].key!==n.items[t].key)return!0;return!1}function r(r,u){discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated - Cart: "+u);var f=i(u);f?(discountNinja.Logging.LogVerbose("Local cart updated"),typeof limoniapps_discountninja_liquid=="object"?window.limoniapps_discountninja_liquid.Cart=u:discountNinja.Logging.LogError("Cart","Liquid cart object not available",!0)):discountNinja.Logging.LogVerbose("Local cart not updated");t(u,f,n)}function t(n,t,i){discountNinja.LocalCartUpdatedEvent.Handle(n,t,i!==null);i&&discountNinja.DiscountedCart.BuildDiscountedCart(i,!t)}try{var u="https://"+location.hostname;discountNinja_Script_Cart_Shopify.IsDirty?(discountNinja.Logging.LogVerbose("Updating cart"),discountNinja.XmlHttpRequest.Send(u+"/cart.js?m="+moment().format("x"),null,null,"get",!0,!0,function(t){discountNinja_Script_Cart_Shopify.IsDirty=!1;r(null,t,n)})):(discountNinja.Logging.LogVerbose("Not updating cart - not assumed dirty"),t(discountNinja.LiquidData.Cart(),!1,n))}catch(f){discountNinja.Logging.LogError("Cart.Shopify.UpdateCart",f,!0)}},AddToCart:function(n,t,i,r){var u,f,e,o;try{if(u=t,i&&(f=discountNinja.LiquidData.CartItemByVariant(n),f!==null&&(e=i-f.quantity,u>e&&(u=e))),u<=0){discountNinja.Logging.LogVerbose("Not adding variant "+n+" to cart because it is already in the cart");return}o="https://"+location.hostname;discountNinja.XmlHttpRequest.Send(o+"/cart/add.js",null,{quantity:u,id:n},"post",!0,!0,function(){discountNinja.Logging.LogVerbose("Variant "+n+" successfully added to the cart");r&&r()})}catch(s){discountNinja.Logging.LogError("Cart.Shopify.AddToCart",s,!0)}},OnAddToCart:function(n,t){var i,u,f,r;try{return discountNinja.Logging.LogVerbose("Handling add to cart"),i=discountNinja.Environment.Shopify.IsProductPage()?discountNinja.Environment.Shopify.ProductHandle():discountNinja.LiquidData.ProductHandleFromCart(t),i===null&&typeof n!="undefined"&&n!==null&&(u=jQuery(n.target).closest("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle")||jQuery(n.target).find("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle"),typeof u=="undefined"?(f=jQuery(n.target).find('input[name="variantid"]').val()||jQuery(n.target).closest(".remodal-wrapper [data-id]").attr("data-id")||jQuery(n.target).find('input[name="id"]').val()||jQuery(n.target).find("button[data-variant-id]").attr("data-variant-id")||jQuery(n.target).find("button[data-variantid]").attr("data-variantid")||jQuery(n.target).find("button[data-id]").attr("data-id")||jQuery(n.target).find("a[data-variant-id]").attr("data-variant-id")||jQuery(n.target).find("a[data-variantid]").attr("data-variantid")||jQuery(n.target).find("a[data-id]").attr("data-id"),typeof f!="undefined"&&(discountNinja.Logging.LogVerbose("OnAddToCart found variant: "+f+" in the form"),i=discountNinja.LiquidData.ProductHandleFromCart(f))):(discountNinja.Logging.LogVerbose("OnAddToCart found product handle from data attribute: "+u),i=u)),i===null?discountNinja.Logging.LogVerbose("OnAddToCart could not find a product handle"):discountNinja.Logging.LogVerbose("OnAddToCart found product handle "+i),r=null,i!==null&&(r=discountNinja.Promotion.GetPromotionForProduct(i,null,null,null),discountNinja.ProductData.SaveOnAddToCart(i)),r?(discountNinja.PromotionEvent.LogPromotionEvent(r,2),discountNinja.Promotion.SetTokenForProductInCache(i,r.Token),discountNinja.Logging.LogVerbose("OnAddToCart tracked product with handle "+i+" is in promotion with token "+r.Token)):discountNinja.Logging.LogVerbose("OnAddToCart could not find a promotion for product with handle "+i),!0}catch(e){return discountNinja.Logging.LogError("Cart.Shopify.OnAddToCart",e,!0),!0}},OnUpdateCart:function(){try{discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Logging.LogVerbose("Handling update to cart");discountNinja.PromotionFlow.StartFlow();discountNinja.DynamicPricing.ReplacePricesInCart()})}catch(n){discountNinja.Logging.LogError("Cart.Shopify.OnUpdateCart",n,!0)}},UnRegisterEventHandlerForAddToCart:function(){try{jQuery("body").find("a, button").each(function(){jQuery(this).off("click.discountNinja.cart");jQuery(this).off("touch.discountNinja.cart")});jQuery("body").find("form").each(function(){jQuery(this).off("submit.discountNinja.cart")})}catch(n){discountNinja.Logging.LogError("Cart.Shopify.UnRegisterEventHandlerForAddToCart",n,!0)}},RegisterEventHandlerForAddToCart:function(){try{discountNinja.Logging.LogVerbose("Registering event handler for atc");discountNinja_Script_Cart_Shopify.UnRegisterEventHandlerForAddToCart();jQuery('form[action^="/cart/add"]').each(function(){jQuery(this).on("submit.discountNinja.cart",function(){discountNinja.Logging.LogVerbose("Add to cart event triggered from submit button on form with action /cart/add")})});jQuery('a[href^="/cart/"]').each(function(){jQuery(this).on("click.discountNinja.cart touch.discountNinja.cart",function(){discountNinja.Logging.LogVerbose("Add to cart event triggered from link with href /cart/")})});jQuery('button[onclick*="/cart/"]').each(function(){jQuery(this).on("click.discountNinja.cart touch.discountNinja.cart",function(){discountNinja.Logging.LogVerbose("Add to cart event triggered from button with onclick /cart/")})})}catch(n){discountNinja.Logging.LogError("Cart.Shopify.RegisterEventHandlerForAddToCart",n,!0)}}};typeof discountNinja=="undefined"&&(discountNinja={Cache:discountNinja_Script_Cache,Cart:{Shopify:discountNinja_Script_Cart_Shopify},Checkout:{Shopify:discountNinja_Script_Checkout_Shopify},Cookie:discountNinja_Script_Cookie,Core:discountNinja_Script_Core,DiscountCode:discountNinja_Script_DiscountCode,DiscountedCart:discountNinja_Script_DiscountedCart,DiscountedProduct:discountNinja_Script_DiscountedProduct,DiscountLevel:discountNinja_Script_DiscountLevel,DynamicPricing:discountNinja_Script_DynamicPricing,Environment:{Shopify:discountNinja_Script_Environment_Shopify},ErrorHandler:discountNinja_Script_ErrorHandler,LiquidData:discountNinja_Script_LiquidData,Logging:discountNinja_Script_Logging,MultiCurrency:discountNinja_Script_MultiCurrency,Notification:discountNinja_Script_Notification,PopUp:discountNinja_Script_PopUp,ProductData:discountNinja_Script_ProductData,Promotion:discountNinja_Script_Promotion,PromotionEvent:discountNinja_Script_PromotionEvent,PromotionFlow:discountNinja_Script_PromotionFlow,QueryParameter:discountNinja_Script_QueryParameter,Settings:discountNinja_Script_Settings,ShortCode:discountNinja_Script_ShortCode,StickyBar:discountNinja_Script_StickyBar,TabReminder:discountNinja_Script_TabReminder,TestMode:discountNinja_Script_TestMode,TextSettings:discountNinja_Script_TextSettings,Timer:discountNinja_Script_Timer,Token:discountNinja_Script_Token,Trigger:discountNinja_Script_Trigger,Utilities:discountNinja_Script_Utilities,VariantChange:discountNinja_Script_VariantChange,XmlHttpRequest:discountNinja_Script_XmlHttpRequest,Events:discountNinja_Script_Events,VariantChangedEvent:discountNinja_Script_VariantChangedEvent,ServerCartItemsAddedEvent:discountNinja_Script_ServerCartItemsAddedEvent,ServerCartItemsChangedEvent:discountNinja_Script_ServerCartItemsChangedEvent,ServerCartItemsUpdatedEvent:discountNinja_Script_ServerCartItemsUpdatedEvent,LocalCartUpdatedEvent:discountNinja_Script_LocalCartUpdatedEvent});discountNinja.DOMHasLoaded=!1;discountNinja.Core.Start(!0);jQuery(document).ready(function(){discountNinja.DOMHasLoaded=!0;discountNinja.Logging.LogVerbose("JQuery Document Ready")})}